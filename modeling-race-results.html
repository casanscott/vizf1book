<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Modeling Race Results | Visualizing Formula 1 Data in R</title>
  <meta name="description" content="This is a book documenting data visualizations of Formula 1 data." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Modeling Race Results | Visualizing Formula 1 Data in R" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/F1_book_cover.PNG" />
  <meta property="og:description" content="This is a book documenting data visualizations of Formula 1 data." />
  <meta name="github-repo" content="casanscott/vizf1book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Modeling Race Results | Visualizing Formula 1 Data in R" />
  
  <meta name="twitter:description" content="This is a book documenting data visualizations of Formula 1 data." />
  <meta name="twitter:image" content="/F1_book_cover.PNG" />

<meta name="author" content="Casan Scott, Ph.D." />


<meta name="date" content="2024-02-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="drivers.html"/>
<link rel="next" href="dnf-did-not-finish.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Visualizing Formula 1 Data in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About the book</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#cover-art"><i class="fa fa-check"></i><b>1.1</b> Cover Art</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#about-me"><i class="fa fa-check"></i><b>1.2</b> About me</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#why-did-i-write-this-book"><i class="fa fa-check"></i><b>1.3</b> Why did I write this book?</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#organization-of-this-book"><i class="fa fa-check"></i><b>1.4</b> Organization of this book</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#r"><i class="fa fa-check"></i><b>1.5</b> R</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#ggplot2"><i class="fa fa-check"></i><b>1.6</b> ggplot2</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#the-tidyverse"><i class="fa fa-check"></i><b>1.7</b> The <em>tidyverse</em></a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#data"><i class="fa fa-check"></i><b>1.8</b> Data</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#data-visualization"><i class="fa fa-check"></i><b>1.9</b> Data Visualization</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-formula-1.html"><a href="introduction-to-formula-1.html"><i class="fa fa-check"></i><b>2</b> Introduction to Formula 1</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-formula-1.html"><a href="introduction-to-formula-1.html#data-1"><i class="fa fa-check"></i><b>2.1</b> Data</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-formula-1.html"><a href="introduction-to-formula-1.html#a-formula-1-weekend"><i class="fa fa-check"></i><b>2.2</b> A Formula 1 Weekend</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-formula-1.html"><a href="introduction-to-formula-1.html#practice-sessions"><i class="fa fa-check"></i><b>2.3</b> Practice Sessions</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-formula-1.html"><a href="introduction-to-formula-1.html#practice-times-by-driver"><i class="fa fa-check"></i><b>2.4</b> Practice Times by Driver</a></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-formula-1.html"><a href="introduction-to-formula-1.html#next-chapter"><i class="fa fa-check"></i><b>2.5</b> Next Chapter</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="qualifying.html"><a href="qualifying.html"><i class="fa fa-check"></i><b>3</b> Qualifying</a>
<ul>
<li class="chapter" data-level="3.1" data-path="qualifying.html"><a href="qualifying.html#distribution-of-qualifying-times-by-session"><i class="fa fa-check"></i><b>3.1</b> Distribution of Qualifying Times by Session</a></li>
<li class="chapter" data-level="3.2" data-path="qualifying.html"><a href="qualifying.html#distribution-of-qualifying-times-by-year"><i class="fa fa-check"></i><b>3.2</b> Distribution of Qualifying Times by Year</a></li>
<li class="chapter" data-level="3.3" data-path="qualifying.html"><a href="qualifying.html#qualifying-times-by-grand-prix"><i class="fa fa-check"></i><b>3.3</b> Qualifying Times by Grand Prix</a></li>
<li class="chapter" data-level="3.4" data-path="qualifying.html"><a href="qualifying.html#car-progression-over-time"><i class="fa fa-check"></i><b>3.4</b> Car Progression Over Time</a></li>
<li class="chapter" data-level="3.5" data-path="qualifying.html"><a href="qualifying.html#next-chapter-1"><i class="fa fa-check"></i><b>3.5</b> Next Chapter</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="modeling-practice-and-qualifying-times.html"><a href="modeling-practice-and-qualifying-times.html"><i class="fa fa-check"></i><b>4</b> Modeling Practice and Qualifying Times</a>
<ul>
<li class="chapter" data-level="4.1" data-path="modeling-practice-and-qualifying-times.html"><a href="modeling-practice-and-qualifying-times.html#models"><i class="fa fa-check"></i><b>4.1</b> Models</a></li>
<li class="chapter" data-level="4.2" data-path="modeling-practice-and-qualifying-times.html"><a href="modeling-practice-and-qualifying-times.html#simple-linear-regression-model-practice-vs-qualifying-times"><i class="fa fa-check"></i><b>4.2</b> Simple Linear Regression Model: Practice vs Qualifying Times</a></li>
<li class="chapter" data-level="4.3" data-path="modeling-practice-and-qualifying-times.html"><a href="modeling-practice-and-qualifying-times.html#simple-linear-regression-model-qualifying-time-vs-year"><i class="fa fa-check"></i><b>4.3</b> Simple Linear Regression Model: Qualifying time vs Year</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="modeling-practice-and-qualifying-times.html"><a href="modeling-practice-and-qualifying-times.html#uncertainty-in-model-estimates"><i class="fa fa-check"></i><b>4.3.1</b> Uncertainty in model estimates</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="modeling-practice-and-qualifying-times.html"><a href="modeling-practice-and-qualifying-times.html#interaction-model"><i class="fa fa-check"></i><b>4.4</b> Interaction Model</a></li>
<li class="chapter" data-level="4.5" data-path="modeling-practice-and-qualifying-times.html"><a href="modeling-practice-and-qualifying-times.html#next-chapter-2"><i class="fa fa-check"></i><b>4.5</b> Next Chapter</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="drivers.html"><a href="drivers.html"><i class="fa fa-check"></i><b>5</b> Drivers</a>
<ul>
<li class="chapter" data-level="5.1" data-path="drivers.html"><a href="drivers.html#race-performance"><i class="fa fa-check"></i><b>5.1</b> Race Performance</a></li>
<li class="chapter" data-level="5.2" data-path="drivers.html"><a href="drivers.html#qualifying-pace"><i class="fa fa-check"></i><b>5.2</b> Qualifying Pace</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="drivers.html"><a href="drivers.html#section"><i class="fa fa-check"></i><b>5.2.1</b> 2023</a></li>
<li class="chapter" data-level="5.2.2" data-path="drivers.html"><a href="drivers.html#section-1"><i class="fa fa-check"></i><b>5.2.2</b> 2022</a></li>
<li class="chapter" data-level="5.2.3" data-path="drivers.html"><a href="drivers.html#section-2"><i class="fa fa-check"></i><b>5.2.3</b> 2021</a></li>
<li class="chapter" data-level="5.2.4" data-path="drivers.html"><a href="drivers.html#section-3"><i class="fa fa-check"></i><b>5.2.4</b> 2020</a></li>
<li class="chapter" data-level="5.2.5" data-path="drivers.html"><a href="drivers.html#section-4"><i class="fa fa-check"></i><b>5.2.5</b> 2019</a></li>
<li class="chapter" data-level="5.2.6" data-path="drivers.html"><a href="drivers.html#section-5"><i class="fa fa-check"></i><b>5.2.6</b> 2018</a></li>
<li class="chapter" data-level="5.2.7" data-path="drivers.html"><a href="drivers.html#section-6"><i class="fa fa-check"></i><b>5.2.7</b> 2017</a></li>
<li class="chapter" data-level="5.2.8" data-path="drivers.html"><a href="drivers.html#section-7"><i class="fa fa-check"></i><b>5.2.8</b> 2016</a></li>
<li class="chapter" data-level="5.2.9" data-path="drivers.html"><a href="drivers.html#section-8"><i class="fa fa-check"></i><b>5.2.9</b> 2015</a></li>
<li class="chapter" data-level="5.2.10" data-path="drivers.html"><a href="drivers.html#section-9"><i class="fa fa-check"></i><b>5.2.10</b> 2014</a></li>
<li class="chapter" data-level="5.2.11" data-path="drivers.html"><a href="drivers.html#next-chapter-3"><i class="fa fa-check"></i><b>5.2.11</b> Next Chapter</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="modeling-race-results.html"><a href="modeling-race-results.html"><i class="fa fa-check"></i><b>6</b> Modeling Race Results</a>
<ul>
<li class="chapter" data-level="6.1" data-path="modeling-race-results.html"><a href="modeling-race-results.html#starting-position-vs-finish-position"><i class="fa fa-check"></i><b>6.1</b> Starting Position vs Finish Position</a></li>
<li class="chapter" data-level="6.2" data-path="modeling-race-results.html"><a href="modeling-race-results.html#shortcomings-of-a-simple-linear-regression-model"><i class="fa fa-check"></i><b>6.2</b> Shortcomings of a simple linear regression model</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="modeling-race-results.html"><a href="modeling-race-results.html#linearity"><i class="fa fa-check"></i><b>6.2.1</b> Linearity</a></li>
<li class="chapter" data-level="6.2.2" data-path="modeling-race-results.html"><a href="modeling-race-results.html#homoscedasticity"><i class="fa fa-check"></i><b>6.2.2</b> Homoscedasticity</a></li>
<li class="chapter" data-level="6.2.3" data-path="modeling-race-results.html"><a href="modeling-race-results.html#independence"><i class="fa fa-check"></i><b>6.2.3</b> Independence</a></li>
<li class="chapter" data-level="6.2.4" data-path="modeling-race-results.html"><a href="modeling-race-results.html#normality"><i class="fa fa-check"></i><b>6.2.4</b> Normality</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="modeling-race-results.html"><a href="modeling-race-results.html#ordinal-regression-model"><i class="fa fa-check"></i><b>6.3</b> Ordinal regression model</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="modeling-race-results.html"><a href="modeling-race-results.html#prediction-grid"><i class="fa fa-check"></i><b>6.3.1</b> Prediction Grid</a></li>
<li class="chapter" data-level="6.3.2" data-path="modeling-race-results.html"><a href="modeling-race-results.html#yearly-differences-in-ordinal-regression-results"><i class="fa fa-check"></i><b>6.3.2</b> Yearly Differences in Ordinal Regression Results</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="modeling-race-results.html"><a href="modeling-race-results.html#explore-circuit-specific-models"><i class="fa fa-check"></i><b>6.4</b> Explore Circuit Specific Models</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="modeling-race-results.html"><a href="modeling-race-results.html#bahrain"><i class="fa fa-check"></i><b>6.4.1</b> Bahrain</a></li>
<li class="chapter" data-level="6.4.2" data-path="modeling-race-results.html"><a href="modeling-race-results.html#saudi-arabia"><i class="fa fa-check"></i><b>6.4.2</b> Saudi Arabia</a></li>
<li class="chapter" data-level="6.4.3" data-path="modeling-race-results.html"><a href="modeling-race-results.html#monaco"><i class="fa fa-check"></i><b>6.4.3</b> Monaco</a></li>
<li class="chapter" data-level="6.4.4" data-path="modeling-race-results.html"><a href="modeling-race-results.html#brazil"><i class="fa fa-check"></i><b>6.4.4</b> Brazil</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="modeling-race-results.html"><a href="modeling-race-results.html#appendix-probability-distributions-for-every-grand-prix"><i class="fa fa-check"></i><b>6.5</b> Appendix: Probability distributions for every Grand Prix</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="modeling-race-results.html"><a href="modeling-race-results.html#bahrain-1"><i class="fa fa-check"></i><b>6.5.1</b> Bahrain</a></li>
<li class="chapter" data-level="6.5.2" data-path="modeling-race-results.html"><a href="modeling-race-results.html#saudi-arabia-1"><i class="fa fa-check"></i><b>6.5.2</b> Saudi Arabia</a></li>
<li class="chapter" data-level="6.5.3" data-path="modeling-race-results.html"><a href="modeling-race-results.html#australia"><i class="fa fa-check"></i><b>6.5.3</b> Australia</a></li>
<li class="chapter" data-level="6.5.4" data-path="modeling-race-results.html"><a href="modeling-race-results.html#azerbaijan"><i class="fa fa-check"></i><b>6.5.4</b> Azerbaijan</a></li>
<li class="chapter" data-level="6.5.5" data-path="modeling-race-results.html"><a href="modeling-race-results.html#miami"><i class="fa fa-check"></i><b>6.5.5</b> Miami</a></li>
<li class="chapter" data-level="6.5.6" data-path="modeling-race-results.html"><a href="modeling-race-results.html#emilia-romagna"><i class="fa fa-check"></i><b>6.5.6</b> Emilia Romagna</a></li>
<li class="chapter" data-level="6.5.7" data-path="modeling-race-results.html"><a href="modeling-race-results.html#monaco-1"><i class="fa fa-check"></i><b>6.5.7</b> Monaco</a></li>
<li class="chapter" data-level="6.5.8" data-path="modeling-race-results.html"><a href="modeling-race-results.html#spain"><i class="fa fa-check"></i><b>6.5.8</b> Spain</a></li>
<li class="chapter" data-level="6.5.9" data-path="modeling-race-results.html"><a href="modeling-race-results.html#canada"><i class="fa fa-check"></i><b>6.5.9</b> Canada</a></li>
<li class="chapter" data-level="6.5.10" data-path="modeling-race-results.html"><a href="modeling-race-results.html#austria"><i class="fa fa-check"></i><b>6.5.10</b> Austria</a></li>
<li class="chapter" data-level="6.5.11" data-path="modeling-race-results.html"><a href="modeling-race-results.html#great-britain"><i class="fa fa-check"></i><b>6.5.11</b> Great Britain</a></li>
<li class="chapter" data-level="6.5.12" data-path="modeling-race-results.html"><a href="modeling-race-results.html#hungary"><i class="fa fa-check"></i><b>6.5.12</b> Hungary</a></li>
<li class="chapter" data-level="6.5.13" data-path="modeling-race-results.html"><a href="modeling-race-results.html#belgium"><i class="fa fa-check"></i><b>6.5.13</b> Belgium</a></li>
<li class="chapter" data-level="6.5.14" data-path="modeling-race-results.html"><a href="modeling-race-results.html#netherlands"><i class="fa fa-check"></i><b>6.5.14</b> Netherlands</a></li>
<li class="chapter" data-level="6.5.15" data-path="modeling-race-results.html"><a href="modeling-race-results.html#monza"><i class="fa fa-check"></i><b>6.5.15</b> Monza</a></li>
<li class="chapter" data-level="6.5.16" data-path="modeling-race-results.html"><a href="modeling-race-results.html#singapore"><i class="fa fa-check"></i><b>6.5.16</b> Singapore</a></li>
<li class="chapter" data-level="6.5.17" data-path="modeling-race-results.html"><a href="modeling-race-results.html#japan"><i class="fa fa-check"></i><b>6.5.17</b> Japan</a></li>
<li class="chapter" data-level="6.5.18" data-path="modeling-race-results.html"><a href="modeling-race-results.html#qatar"><i class="fa fa-check"></i><b>6.5.18</b> Qatar</a></li>
<li class="chapter" data-level="6.5.19" data-path="modeling-race-results.html"><a href="modeling-race-results.html#united-states-circuit-of-the-americas-in-austin-texas"><i class="fa fa-check"></i><b>6.5.19</b> United States (Circuit of the Americas in Austin, Texas)</a></li>
<li class="chapter" data-level="6.5.20" data-path="modeling-race-results.html"><a href="modeling-race-results.html#mexico"><i class="fa fa-check"></i><b>6.5.20</b> Mexico</a></li>
<li class="chapter" data-level="6.5.21" data-path="modeling-race-results.html"><a href="modeling-race-results.html#brazil-1"><i class="fa fa-check"></i><b>6.5.21</b> Brazil</a></li>
<li class="chapter" data-level="6.5.22" data-path="modeling-race-results.html"><a href="modeling-race-results.html#abu-dhabi"><i class="fa fa-check"></i><b>6.5.22</b> Abu Dhabi</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="modeling-race-results.html"><a href="modeling-race-results.html#next-chapter-4"><i class="fa fa-check"></i><b>6.6</b> Next Chapter</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="dnf-did-not-finish.html"><a href="dnf-did-not-finish.html"><i class="fa fa-check"></i><b>7</b> DNF (Did Not Finish)</a>
<ul>
<li class="chapter" data-level="7.1" data-path="dnf-did-not-finish.html"><a href="dnf-did-not-finish.html#logistic-regression"><i class="fa fa-check"></i><b>7.1</b> Logistic Regression</a></li>
<li class="chapter" data-level="7.2" data-path="dnf-did-not-finish.html"><a href="dnf-did-not-finish.html#yearly-differences"><i class="fa fa-check"></i><b>7.2</b> Yearly Differences</a></li>
<li class="chapter" data-level="7.3" data-path="dnf-did-not-finish.html"><a href="dnf-did-not-finish.html#differences-by-constructor"><i class="fa fa-check"></i><b>7.3</b> Differences by constructor</a></li>
<li class="chapter" data-level="7.4" data-path="dnf-did-not-finish.html"><a href="dnf-did-not-finish.html#dnfs-by-race-of-the-season"><i class="fa fa-check"></i><b>7.4</b> DNFs by race of the season</a></li>
<li class="chapter" data-level="7.5" data-path="dnf-did-not-finish.html"><a href="dnf-did-not-finish.html#next-chapter-5"><i class="fa fa-check"></i><b>7.5</b> Next Chapter</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="the-wdc-world-drivers-championship.html"><a href="the-wdc-world-drivers-championship.html"><i class="fa fa-check"></i><b>8</b> The WDC (World Drivers Championship)</a></li>
<li class="chapter" data-level="9" data-path="conclusions.html"><a href="conclusions.html"><i class="fa fa-check"></i><b>9</b> Conclusions</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualizing Formula 1 Data in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modeling-race-results" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Modeling Race Results<a href="modeling-race-results.html#modeling-race-results" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>What determines success in a Grand Prix? Obviously, a multitude of factors do, but which ones specifically? And how much? These type of questions were essentially the motivation behind me writing this book. I was new to this sport, and had lots of questions. As a casual fan of Daily Fantasy Sports (DFS), I was curious to know what variables determine final placing in a race. Assuming something measurable does influence final placing, I wanted to build a model to describe the relationship (inferential model)and make predictions (predictive model). This chapter documents my modeling approach.</p>
<div id="starting-position-vs-finish-position" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Starting Position vs Finish Position<a href="modeling-race-results.html#starting-position-vs-finish-position" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s begin with a mostly uncontroversial statement:</p>
<p>All other factors held constant, <strong>it is best to start the race in first place</strong>!</p>
<p>How much does starting position influence a driver’s finishing place? Throughout this chapter, we will explore data and build models to answer this question.</p>
<div style="page-break-after: always;"></div>
<p><br>
<br></p>
<p>Using the <strong>drs</strong> package, we can pull all starting grid positions and Grand Prix finishing places for each race from 2014 to 2023.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="modeling-race-results.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull Race Data</span></span>
<span id="cb1-2"><a href="modeling-race-results.html#cb1-2" aria-hidden="true" tabindex="-1"></a>races2023 <span class="ot">&lt;-</span> <span class="fu">race_result_scraper</span>(<span class="dv">2023</span>)</span>
<span id="cb1-3"><a href="modeling-race-results.html#cb1-3" aria-hidden="true" tabindex="-1"></a>races2022 <span class="ot">&lt;-</span> <span class="fu">race_result_scraper</span>(<span class="dv">2022</span>)</span>
<span id="cb1-4"><a href="modeling-race-results.html#cb1-4" aria-hidden="true" tabindex="-1"></a>races2021 <span class="ot">&lt;-</span> <span class="fu">race_result_scraper</span>(<span class="dv">2021</span>)</span>
<span id="cb1-5"><a href="modeling-race-results.html#cb1-5" aria-hidden="true" tabindex="-1"></a>races2020 <span class="ot">&lt;-</span> <span class="fu">race_result_scraper</span>(<span class="dv">2020</span>)</span>
<span id="cb1-6"><a href="modeling-race-results.html#cb1-6" aria-hidden="true" tabindex="-1"></a>races2019 <span class="ot">&lt;-</span> <span class="fu">race_result_scraper</span>(<span class="dv">2019</span>)</span>
<span id="cb1-7"><a href="modeling-race-results.html#cb1-7" aria-hidden="true" tabindex="-1"></a>races2018 <span class="ot">&lt;-</span> <span class="fu">race_result_scraper</span>(<span class="dv">2018</span>)</span>
<span id="cb1-8"><a href="modeling-race-results.html#cb1-8" aria-hidden="true" tabindex="-1"></a>races2017 <span class="ot">&lt;-</span> <span class="fu">race_result_scraper</span>(<span class="dv">2017</span>)</span>
<span id="cb1-9"><a href="modeling-race-results.html#cb1-9" aria-hidden="true" tabindex="-1"></a>races2016 <span class="ot">&lt;-</span> <span class="fu">race_result_scraper</span>(<span class="dv">2016</span>)</span>
<span id="cb1-10"><a href="modeling-race-results.html#cb1-10" aria-hidden="true" tabindex="-1"></a>races2015 <span class="ot">&lt;-</span> <span class="fu">race_result_scraper</span>(<span class="dv">2015</span>)</span>
<span id="cb1-11"><a href="modeling-race-results.html#cb1-11" aria-hidden="true" tabindex="-1"></a>races2014 <span class="ot">&lt;-</span> <span class="fu">race_result_scraper</span>(<span class="dv">2014</span>)</span>
<span id="cb1-12"><a href="modeling-race-results.html#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="modeling-race-results.html#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all race data</span></span>
<span id="cb1-14"><a href="modeling-race-results.html#cb1-14" aria-hidden="true" tabindex="-1"></a>races_allyears <span class="ot">&lt;-</span> <span class="fu">rbind</span>(races2023,</span>
<span id="cb1-15"><a href="modeling-race-results.html#cb1-15" aria-hidden="true" tabindex="-1"></a>                             races2022,</span>
<span id="cb1-16"><a href="modeling-race-results.html#cb1-16" aria-hidden="true" tabindex="-1"></a>                             races2021, </span>
<span id="cb1-17"><a href="modeling-race-results.html#cb1-17" aria-hidden="true" tabindex="-1"></a>                             races2020,</span>
<span id="cb1-18"><a href="modeling-race-results.html#cb1-18" aria-hidden="true" tabindex="-1"></a>                             races2019,</span>
<span id="cb1-19"><a href="modeling-race-results.html#cb1-19" aria-hidden="true" tabindex="-1"></a>                             races2018,</span>
<span id="cb1-20"><a href="modeling-race-results.html#cb1-20" aria-hidden="true" tabindex="-1"></a>                             races2017,</span>
<span id="cb1-21"><a href="modeling-race-results.html#cb1-21" aria-hidden="true" tabindex="-1"></a>                             races2016,</span>
<span id="cb1-22"><a href="modeling-race-results.html#cb1-22" aria-hidden="true" tabindex="-1"></a>                             races2015,</span>
<span id="cb1-23"><a href="modeling-race-results.html#cb1-23" aria-hidden="true" tabindex="-1"></a>                             races2014)</span>
<span id="cb1-24"><a href="modeling-race-results.html#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="modeling-race-results.html#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull Starting Grid Data</span></span>
<span id="cb1-26"><a href="modeling-race-results.html#cb1-26" aria-hidden="true" tabindex="-1"></a>grid2023 <span class="ot">&lt;-</span> <span class="fu">starting_grid_scraper</span>(<span class="dv">2023</span>)</span>
<span id="cb1-27"><a href="modeling-race-results.html#cb1-27" aria-hidden="true" tabindex="-1"></a>grid2022 <span class="ot">&lt;-</span> <span class="fu">starting_grid_scraper</span>(<span class="dv">2022</span>)</span>
<span id="cb1-28"><a href="modeling-race-results.html#cb1-28" aria-hidden="true" tabindex="-1"></a>grid2021 <span class="ot">&lt;-</span> <span class="fu">starting_grid_scraper</span>(<span class="dv">2021</span>)</span>
<span id="cb1-29"><a href="modeling-race-results.html#cb1-29" aria-hidden="true" tabindex="-1"></a>grid2020 <span class="ot">&lt;-</span> <span class="fu">starting_grid_scraper</span>(<span class="dv">2020</span>)</span>
<span id="cb1-30"><a href="modeling-race-results.html#cb1-30" aria-hidden="true" tabindex="-1"></a>grid2019 <span class="ot">&lt;-</span> <span class="fu">starting_grid_scraper</span>(<span class="dv">2019</span>)</span>
<span id="cb1-31"><a href="modeling-race-results.html#cb1-31" aria-hidden="true" tabindex="-1"></a>grid2018 <span class="ot">&lt;-</span> <span class="fu">starting_grid_scraper</span>(<span class="dv">2018</span>)</span>
<span id="cb1-32"><a href="modeling-race-results.html#cb1-32" aria-hidden="true" tabindex="-1"></a>grid2017 <span class="ot">&lt;-</span> <span class="fu">starting_grid_scraper</span>(<span class="dv">2017</span>)</span>
<span id="cb1-33"><a href="modeling-race-results.html#cb1-33" aria-hidden="true" tabindex="-1"></a>grid2016 <span class="ot">&lt;-</span> <span class="fu">starting_grid_scraper</span>(<span class="dv">2016</span>)</span>
<span id="cb1-34"><a href="modeling-race-results.html#cb1-34" aria-hidden="true" tabindex="-1"></a>grid2015 <span class="ot">&lt;-</span> <span class="fu">starting_grid_scraper</span>(<span class="dv">2015</span>)</span>
<span id="cb1-35"><a href="modeling-race-results.html#cb1-35" aria-hidden="true" tabindex="-1"></a>grid2014 <span class="ot">&lt;-</span> <span class="fu">starting_grid_scraper</span>(<span class="dv">2014</span>)</span>
<span id="cb1-36"><a href="modeling-race-results.html#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="modeling-race-results.html#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all starting grid data</span></span>
<span id="cb1-38"><a href="modeling-race-results.html#cb1-38" aria-hidden="true" tabindex="-1"></a>grid_allyears <span class="ot">&lt;-</span> <span class="fu">rbind</span>(grid2023,</span>
<span id="cb1-39"><a href="modeling-race-results.html#cb1-39" aria-hidden="true" tabindex="-1"></a>                             grid2022,</span>
<span id="cb1-40"><a href="modeling-race-results.html#cb1-40" aria-hidden="true" tabindex="-1"></a>                             grid2021, </span>
<span id="cb1-41"><a href="modeling-race-results.html#cb1-41" aria-hidden="true" tabindex="-1"></a>                             grid2020,</span>
<span id="cb1-42"><a href="modeling-race-results.html#cb1-42" aria-hidden="true" tabindex="-1"></a>                             grid2019,</span>
<span id="cb1-43"><a href="modeling-race-results.html#cb1-43" aria-hidden="true" tabindex="-1"></a>                             grid2018,</span>
<span id="cb1-44"><a href="modeling-race-results.html#cb1-44" aria-hidden="true" tabindex="-1"></a>                             grid2017,</span>
<span id="cb1-45"><a href="modeling-race-results.html#cb1-45" aria-hidden="true" tabindex="-1"></a>                             grid2016,</span>
<span id="cb1-46"><a href="modeling-race-results.html#cb1-46" aria-hidden="true" tabindex="-1"></a>                             grid2015,</span>
<span id="cb1-47"><a href="modeling-race-results.html#cb1-47" aria-hidden="true" tabindex="-1"></a>                             grid2014)</span></code></pre></div>
<p>In the code above, I scrape results by year and bind all years together. Next, I’ll merge the starting grid positions with the race results for all Grands Prix from 2014 to 2023.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="modeling-race-results.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Merge practice and qualifying data</span></span>
<span id="cb2-2"><a href="modeling-race-results.html#cb2-2" aria-hidden="true" tabindex="-1"></a>grids_and_races <span class="ot">&lt;-</span> races_allyears <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="modeling-race-results.html#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(grid_allyears <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Driver, Race, Circuit, Year, Position, Time_secs),</span>
<span id="cb2-4"><a href="modeling-race-results.html#cb2-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;Driver&#39;</span>, <span class="st">&#39;Race&#39;</span>, <span class="st">&#39;Circuit&#39;</span>, <span class="st">&#39;Year&#39;</span>),</span>
<span id="cb2-5"><a href="modeling-race-results.html#cb2-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_race&quot;</span>, <span class="st">&quot;_grid&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="modeling-race-results.html#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>Position_race <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;NC&quot;</span>, <span class="st">&quot;DQ&quot;</span>),</span>
<span id="cb2-7"><a href="modeling-race-results.html#cb2-7" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(Position_race),</span>
<span id="cb2-8"><a href="modeling-race-results.html#cb2-8" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(Position_grid)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-9"><a href="modeling-race-results.html#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Position_race =</span> <span class="fu">as.numeric</span>(Position_race), </span>
<span id="cb2-10"><a href="modeling-race-results.html#cb2-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">Position_grid =</span> <span class="fu">as.numeric</span>(Position_grid)) </span></code></pre></div>
<p>As a sanity check, let’s take an initial look at our data. Does the data <em>appear</em> to support our hypothesis?</p>
<p>Recall our hypothesis:</p>
<p><em>It is best to start the race in 1st place.</em></p>
<p>Or, we can use perhaps a more versatile version of our hypothesis:</p>
<p><em>Starting grid position is positively correlated to finishing position.</em></p>
<p>Below, I’ll plot starting grid position vs finishing position for each driver over this ten year period. I’ll include a best-fit line to highlight the overall relationship.</p>
<p><em>Note: I jitter the data using <code>position_jitter()</code>.</em></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="modeling-race-results.html#cb3-1" aria-hidden="true" tabindex="-1"></a>grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="modeling-race-results.html#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Position_grid, Position_race)) <span class="sc">+</span></span>
<span id="cb3-3"><a href="modeling-race-results.html#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(), <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb3-4"><a href="modeling-race-results.html#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">&#39;smooth&#39;</span>, <span class="at">se =</span> F, <span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>,</span>
<span id="cb3-5"><a href="modeling-race-results.html#cb3-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> x, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb3-6"><a href="modeling-race-results.html#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb3-7"><a href="modeling-race-results.html#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x  =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb3-8"><a href="modeling-race-results.html#cb3-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Finishing Position&#39;</span>,</span>
<span id="cb3-9"><a href="modeling-race-results.html#cb3-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&#39;Starting Position vs Finish Position&#39;</span>,</span>
<span id="cb3-10"><a href="modeling-race-results.html#cb3-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;All Grands Prix: (2014 - 2023)&#39;</span>) <span class="sc">+</span></span>
<span id="cb3-11"><a href="modeling-race-results.html#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb3-12"><a href="modeling-race-results.html#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-4-1.png" width="960" /></p>
<p>Clearly, there’s a linear relationship that supports our hypothesis. In chapter 4, we used a linear regression model to estimate the relationship between practice times and qualifying times. Linear regression is <em>typically</em> a fine choice to model a continuous response variable, so long as the assumptions of the model are met. There are four primary assumptions associated with simple linear regression (linear regression with only one predictor variable):</p>
<ul>
<li><strong>Linearity</strong>: The relationship between the predictor variable and the <em>mean</em> of the response variable is linear.</li>
<li><strong>Homoscedasticity</strong>: The variance of a residual is the same for any value of the predictor variable.</li>
<li><strong>Independence</strong>: Observations are independent of each other.</li>
<li><strong>Normality</strong>: For any fixed value of the predictor variable, the response variable is normally distributed.</li>
</ul>
<p>In the next section, I’ll fit a simple linear regression model to this data. I will perform some diagnostic checks to ensure that we meet our assumptions. Spoiler alert: we don’t!.</p>
</div>
<div id="shortcomings-of-a-simple-linear-regression-model" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Shortcomings of a simple linear regression model<a href="modeling-race-results.html#shortcomings-of-a-simple-linear-regression-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To start off, I’ll fit the linear regression with the following code:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="modeling-race-results.html#cb4-1" aria-hidden="true" tabindex="-1"></a>grid.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Position_race <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Position_grid, <span class="at">data =</span> grids_and_races)</span></code></pre></div>
<p>We can use this model to make predictions for each starting position. The red line represents the predictions. Notice how the code below produces the same figure that we created above.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="modeling-race-results.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make predictions</span></span>
<span id="cb5-2"><a href="modeling-race-results.html#cb5-2" aria-hidden="true" tabindex="-1"></a>grid.lm.predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(grid.lm, grids_and_races)</span>
<span id="cb5-3"><a href="modeling-race-results.html#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="modeling-race-results.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot data with predictions</span></span>
<span id="cb5-5"><a href="modeling-race-results.html#cb5-5" aria-hidden="true" tabindex="-1"></a>grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="modeling-race-results.html#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">pred =</span> grid.lm.predictions) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="modeling-race-results.html#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Position_grid, Position_race)) <span class="sc">+</span></span>
<span id="cb5-8"><a href="modeling-race-results.html#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(), <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb5-9"><a href="modeling-race-results.html#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred), <span class="at">col =</span> <span class="st">&#39;red&#39;</span>,</span>
<span id="cb5-10"><a href="modeling-race-results.html#cb5-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb5-11"><a href="modeling-race-results.html#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb5-12"><a href="modeling-race-results.html#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x  =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb5-13"><a href="modeling-race-results.html#cb5-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Finishing Position&#39;</span>,</span>
<span id="cb5-14"><a href="modeling-race-results.html#cb5-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&#39;Starting Position vs Finish Position&#39;</span>,</span>
<span id="cb5-15"><a href="modeling-race-results.html#cb5-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;All Grands Prix: (2014 - 2023)&#39;</span>) <span class="sc">+</span></span>
<span id="cb5-16"><a href="modeling-race-results.html#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb5-17"><a href="modeling-race-results.html#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-6-1.png" width="960" /></p>
<p>Now, we can begin checking our assumptions for the simple linear regression model.</p>
<div id="linearity" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Linearity<a href="modeling-race-results.html#linearity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The relationship between the predictor variable and the <em>mean</em> of the response variable should be linear. Judging by the graph above, it certainly <em>looks</em> like we meet this assumption. We can also use a test to check this assumption. One such test is the Ramsey Regression Equation Specification Error Test (RESET).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="modeling-race-results.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb6-2"><a href="modeling-race-results.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">resettest</span>(grid.lm)</span></code></pre></div>
<pre><code>## 
##  RESET test
## 
## data:  grid.lm
## RESET = 264.3, df1 = 2, df2 = 3348, p-value &lt; 2.2e-16</code></pre>
<p>The RESET performs a nested model comparison with the current model and the current model plus some polynomial terms. The results from this test on our model suggests that our model may be mis-specified. However, it is not recommended to begin thoughtlessly experimenting with additional terms. Let’s continue checking the other assumptions of the linear regression model.</p>
<p><br>
<br></p>
<div class="blackbox">
<div class="center">
<p><strong>How to test for linearity in R</strong></p>
</div>
<p>The Ramsey Regression Equation Specification Error Test (RESET) can be used to detect specification errors in a linear model model. The RESET performs a nested model comparison between:</p>
<ol style="list-style-type: decimal">
<li>the current model and,</li>
<li>the current model plus some polynomial terms</li>
</ol>
<p>The <code>resettest()</code> returns the result of an F-test. A significant result is <em>an indication that we need to further investigate the relationship between the predictors and the outcome.</em></p>
<p>For more information on checking for linearity and addressing mis-specified models, visit this link: <a href="https://sscc.wisc.edu/sscc/pubs/RegDiag-R/linearity.html" class="uri">https://sscc.wisc.edu/sscc/pubs/RegDiag-R/linearity.html</a></p>
</div>
<p><br>
<br></p>
</div>
<div id="homoscedasticity" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Homoscedasticity<a href="modeling-race-results.html#homoscedasticity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The variance of a residual should be constant for any value of the predictor variable.</p>
<p>To check this, we can first use a visualization. I’ll plot the residuals vs the starting grid positions for our model:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="modeling-race-results.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind the residuals and plot residuals vs predictor levels</span></span>
<span id="cb8-2"><a href="modeling-race-results.html#cb8-2" aria-hidden="true" tabindex="-1"></a>grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="modeling-race-results.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Position_grid),</span>
<span id="cb8-4"><a href="modeling-race-results.html#cb8-4" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(Position_race)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="modeling-race-results.html#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">res =</span> grid.lm<span class="sc">$</span>residuals) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="modeling-race-results.html#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Position_grid, res)) <span class="sc">+</span></span>
<span id="cb8-7"><a href="modeling-race-results.html#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb8-8"><a href="modeling-race-results.html#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb8-9"><a href="modeling-race-results.html#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb8-10"><a href="modeling-race-results.html#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x  =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb8-11"><a href="modeling-race-results.html#cb8-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Residual&#39;</span>,</span>
<span id="cb8-12"><a href="modeling-race-results.html#cb8-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&#39;Starting Position vs Residuals&#39;</span>) <span class="sc">+</span></span>
<span id="cb8-13"><a href="modeling-race-results.html#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb8-14"><a href="modeling-race-results.html#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>This does not look good! We clearly have a pattern in our residual variance. Notice how the residuals steadily decline with starting grid position. Ideally, the residuals should be centered around 0 (the horizontal red line) with approximately equal variance (in both directions) across the plot.</p>
<p>We can use a statistical test to quantify this violation. The Non-Constant Error Variance Test (ncvTest) is a useful test for the assumption of constant variance. Within the <strong>car</strong> package, there is a function called <code>ncvTest()</code> that will test whether the model demonstrates constant variance. I will use this function below:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="modeling-race-results.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb9-2"><a href="modeling-race-results.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="modeling-race-results.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ncvTest</span>(grid.lm)</span></code></pre></div>
<pre><code>## Non-constant Variance Score Test 
## Variance formula: ~ fitted.values 
## Chisquare = 26.98787, Df = 1, p = 2.0474e-07</code></pre>
<p><br>
<br></p>
<div class="blackbox">
<div class="center">
<p><strong>How to test for Homoscedasticity in R</strong></p>
</div>
<p>There are a few options available, depending on your data and model. Two of the most common functions that I use are:</p>
<ul>
<li>The <strong>car</strong> package includes the <code>ncvTest()</code> function that performs a Non-Constant Error Variance Test.</li>
<li>the <strong>lmtest</strong> packages includes the <code>bptest()</code> function that performs the Breusch-Pagan test against heteroskedasticity.</li>
</ul>
</div>
<p><br>
<br></p>
<p>The results from this test suggest a pretty severe violation of homoscedasticity.</p>
</div>
<div id="independence" class="section level3 hasAnchor" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Independence<a href="modeling-race-results.html#independence" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Observations should be <em>independent</em> of each other.</p>
<p>The assumption of independence should be carefully investigated. However, merely using data visualizations or statistical tests is insufficient. A thorough discussion about statistical independence is outside of the scope of this book, but to learn more I recommend starting here:</p>
<p><a href="https://sscc.wisc.edu/sscc/pubs/RegDiag-R/independence.html" class="uri">https://sscc.wisc.edu/sscc/pubs/RegDiag-R/independence.html</a></p>
</div>
<div id="normality" class="section level3 hasAnchor" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> Normality<a href="modeling-race-results.html#normality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For any fixed value of the predictor variable, the response variable should be normally distributed.</p>
<p>One way to create a visual check for normality is by using a qq-plot. We can easily create a qq-plot in ggplot using the following code:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="modeling-race-results.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-2"><a href="modeling-race-results.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>(<span class="fu">aes</span>(<span class="at">sample =</span> <span class="fu">rstandard</span>(grid.lm))) <span class="sc">+</span></span>
<span id="cb11-3"><a href="modeling-race-results.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb11-4"><a href="modeling-race-results.html#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb11-5"><a href="modeling-race-results.html#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Visually, there seems to be deviations at the upper and lower ends of our range.</p>
<p>The <code>ols_test_correlation()</code> function from the <strong>olsrr</strong> package tests the correlation between the observed residuals and expected residuals under normality. I’ll run that test here:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="modeling-race-results.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(olsrr)</span>
<span id="cb12-2"><a href="modeling-race-results.html#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="modeling-race-results.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_test_correlation</span>(grid.lm)</span></code></pre></div>
<pre><code>## [1] 0.9860785</code></pre>
<p><br>
<br></p>
<div class="blackbox">
<div class="center">
<p><strong>The olsrr package in R</strong></p>
</div>
<p>If you are new to R, the <strong>olsrr</strong> package can be very helpful. It is built with the aim of helping those users who are building models but are new to the R language.</p>
<p>To learn more about the <strong>olsrr</strong> package, visit this link:</p>
<p><a href="https://cran.r-project.org/web/packages/olsrr/vignettes/residual_diagnostics.html" class="uri">https://cran.r-project.org/web/packages/olsrr/vignettes/residual_diagnostics.html</a></p>
</div>
<p><br>
<br></p>
<p>That seems like a strong enough correlation, suggesting that the residuals are not normally distributed. But, let’s dive even deeper. If we look at the distribution of residuals at each starting position, we can see clear deviations from normality. I will plot the distribution of residuals for each starting grid position below. Each <em>facet</em> contains data for a given starting grid position. Notice that the distributional shapes at the front (P1, P2, P3) and back of the grid (P20, P21, P22) deviate considerably from a normal distribution.</p>
<p><br>
<br></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="modeling-race-results.html#cb14-1" aria-hidden="true" tabindex="-1"></a>grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="modeling-race-results.html#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Position_grid),</span>
<span id="cb14-3"><a href="modeling-race-results.html#cb14-3" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(Position_race)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="modeling-race-results.html#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">res =</span> grid.lm<span class="sc">$</span>residuals) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="modeling-race-results.html#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(res, <span class="at">y =</span> ..density..)) <span class="sc">+</span></span>
<span id="cb14-6"><a href="modeling-race-results.html#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb14-7"><a href="modeling-race-results.html#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb14-8"><a href="modeling-race-results.html#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb14-9"><a href="modeling-race-results.html#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x  =</span> <span class="st">&#39;Residual&#39;</span>,</span>
<span id="cb14-10"><a href="modeling-race-results.html#cb14-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb14-11"><a href="modeling-race-results.html#cb14-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&#39;Distribution of Residuals at each Starting Grid Position&#39;</span>) <span class="sc">+</span></span>
<span id="cb14-12"><a href="modeling-race-results.html#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb14-13"><a href="modeling-race-results.html#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb14-14"><a href="modeling-race-results.html#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Position_grid, <span class="at">scales =</span> <span class="st">&#39;free_y&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-12-1.png" width="960" /></p>
<p>To make this even easier to see, we can overlay a theoretical normal distribution over these plots.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="modeling-race-results.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggh4x)</span>
<span id="cb15-2"><a href="modeling-race-results.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fitdistrplus)</span>
<span id="cb15-3"><a href="modeling-race-results.html#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="modeling-race-results.html#cb15-4" aria-hidden="true" tabindex="-1"></a>grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="modeling-race-results.html#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Position_grid),</span>
<span id="cb15-6"><a href="modeling-race-results.html#cb15-6" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(Position_race)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="modeling-race-results.html#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">res =</span> grid.lm<span class="sc">$</span>residuals) <span class="sc">%&gt;%</span></span>
<span id="cb15-8"><a href="modeling-race-results.html#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(res, <span class="at">y =</span> ..density..)) <span class="sc">+</span></span>
<span id="cb15-9"><a href="modeling-race-results.html#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb15-10"><a href="modeling-race-results.html#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb15-11"><a href="modeling-race-results.html#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb15-12"><a href="modeling-race-results.html#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x  =</span> <span class="st">&#39;Residual&#39;</span>,</span>
<span id="cb15-13"><a href="modeling-race-results.html#cb15-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb15-14"><a href="modeling-race-results.html#cb15-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&#39;Distribution of Residuals at each Starting Grid Position&#39;</span>) <span class="sc">+</span></span>
<span id="cb15-15"><a href="modeling-race-results.html#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb15-16"><a href="modeling-race-results.html#cb15-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb15-17"><a href="modeling-race-results.html#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_theodensity</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(density)), <span class="at">distri =</span> <span class="st">&#39;norm&#39;</span>) <span class="sc">+</span> </span>
<span id="cb15-18"><a href="modeling-race-results.html#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Position_grid, <span class="at">scales =</span> <span class="st">&#39;free_y&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-13-1.png" width="960" /></p>
<p>After seeing all of these figures and the results from the statistical tests, I feel strongly that our data does not meet the assumptions for the simple linear regression model.</p>
<p><br>
<br></p>
<div class="blackbox">
<div class="center">
<p><strong>How to overlay a theoretical distribution in ggplot</strong></p>
</div>
<p>The <strong>ggh4x</strong> package has lots of fantastic functions for plotting. One of my favorites is the <code>stat_theodensity()</code> function. This function can be useful for comparing histograms or kernel density estimates against a theoretical distribution.</p>
<p>For more information on the function, visit this link:</p>
<p><a href="https://www.rdocumentation.org/packages/ggh4x/versions/0.2.1/topics/stat_theodensity" class="uri">https://www.rdocumentation.org/packages/ggh4x/versions/0.2.1/topics/stat_theodensity</a></p>
<p>The <strong>ggh4x</strong> package proviedes various <em>hacks</em> for ggplot. For more information on the package, visit this link:</p>
<p><a href="https://cran.r-project.org/web/packages/ggh4x/readme/README.html" class="uri">https://cran.r-project.org/web/packages/ggh4x/readme/README.html</a></p>
</div>
<p><br>
<br></p>
<p>If we can not use a linear regression model, what model should we use? When your data fails to meet the assumptions for a linear regression, it is common to consider a generalized linear model (GLM) as an alternative. Without going into too much detail, the choice of a particular GLM depends on the characteristics of the response variable. In our data, the response variable is Grand Prix final classification position (a.k.a. <em>what place you finished the race in</em>). This variable is not <em>continuous</em>, but is rather quite special. We could treat it as an integer, but it actually possesses a very special characteristic: it is an <strong><em>ordered factor</em></strong>, or ordinal variable.</p>
<p>An ordinal variable is a categorical factor in which the levels of that factor demonstrate an <em>ordering</em>. For example, taco salsa at a restaurant may be categorized as <em>mild</em>, <em>warm</em>, and <em>hot</em>. Survey responses may include <em>strongly disagree</em>, <em>disagree</em>, <em>neutral</em>, <em>agree</em>, and <em>strongly agree</em>. This is no different in our data. P1 finishes ahead of P2, who finishes ahead of P3, and so on. This ordered nature of the response variable requires a different approach to modeling. I’ll discuss further in the next section!</p>
</div>
</div>
<div id="ordinal-regression-model" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Ordinal regression model<a href="modeling-race-results.html#ordinal-regression-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Judging by our earlier plots at the beginning of this chapter, we can safely conclude that there is a pattern in the data; <em>starting and finishing positions are positively correlated</em>. However, we failed to meet the assumptions for a simple linear regression model. Luckily, there is a better suited model for this task: the <em>Ordinal regression model</em>.</p>
<p>Ordinal regression can be used to estimate the association between a predictor variable (or several) and an ordinal outcome (finishing position). Rather than predicting the finishing position explicitly, this model estimates the <em>odds</em> (and <em>probability</em>) of finishing in a particular position. For this reason, we would need to slightly modify our research question to:</p>
<p><em>What effect does starting grid position have on the probability of a finishing position in a Grand Prix?</em></p>
<p>Note: the odds of an outcome are the ratio of the probability that the outcome occurs to the probability that the outcome does not occur.</p>
<p><span class="math display">\[ Odds = \frac{Pr(outcome \ occurs)}{Pr(outcome \ does \ not \ occur)} \]</span></p>
<p><br>
<br></p>
<div class="blackbox">
<div class="center">
<p><strong>What is an Ordinal Regression model?</strong></p>
</div>
<p>An ordinal regression model estimates the probability of a given ordinal outcome, or a better outcome. Ordinal outcomes are ordered factors. In other words, an ordinal outcome is a categorical response variable that is ordered in some relevant way. For example, “Low/Medium/High” or “Bad/Good/Great” are both ordered factors with three levels. Finishing Place, “P1, P2, P3, etc.”, is also an ordered factor. We can use an ordinal regression model to estimate the probability of a driver finishing in a given position (or better).</p>
<p>A helpful introduction to ordinal regression models can be found here:</p>
<p><a href="https://towardsdatascience.com/implementing-and-interpreting-ordinal-logistic-regression-1ee699274cf5" class="uri">https://towardsdatascience.com/implementing-and-interpreting-ordinal-logistic-regression-1ee699274cf5</a></p>
<p>One of my favorite books that discusses ordinal regression models is <em>Modern Applied Regressions</em> by Jun Xu:</p>
<p><a href="https://a.co/d/dJgYJ5B" class="uri">https://a.co/d/dJgYJ5B</a></p>
<p>Another great book that covers the topic is <em>Applications of Regression for Categorical Outcomes Using R</em> by David Melamed and Long Doan:</p>
<p><a href="https://www.routledge.com/Applications-of-Regression-for-Categorical-Outcomes-Using-R/Melamed-Doan/p/book/9781032509518" class="uri">https://www.routledge.com/Applications-of-Regression-for-Categorical-Outcomes-Using-R/Melamed-Doan/p/book/9781032509518</a></p>
</div>
<p><br />
<br /></p>
<p>For a better understanding of ordinal regression models, I highly recommend the sources that I linked above. In my opinion, the best way to learn is through experimentation. So, I will go ahead and build an ordinal regression model, also known as a <em>proportional odds model</em>, to estimate the effect of starting grid position on the odds of a particular finishing position. This model will utilize all races across the ten year period (2014 to 2023). I removed DNFs (did not finish the race) from this data. In the code chunk below, I fit the model and print the summary output.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="modeling-race-results.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(VGAM)</span>
<span id="cb16-2"><a href="modeling-race-results.html#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="modeling-race-results.html#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="modeling-race-results.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the ordinal regression model</span></span>
<span id="cb16-5"><a href="modeling-race-results.html#cb16-5" aria-hidden="true" tabindex="-1"></a>overall_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb16-6"><a href="modeling-race-results.html#cb16-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb16-7"><a href="modeling-race-results.html#cb16-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races)</span>
<span id="cb16-8"><a href="modeling-race-results.html#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="modeling-race-results.html#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print summary of the model</span></span>
<span id="cb16-10"><a href="modeling-race-results.html#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(overall_model)</span></code></pre></div>
<pre><code>## 
## Call:
## vglm(formula = Position_race ~ Position_grid, family = cumulative(parallel = T, 
##     reverse = F), data = grids_and_races)
## 
## Coefficients: 
##                 Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept):1  -0.644045   0.087340  -7.374 1.66e-13 ***
## (Intercept):2   0.329305   0.071981   4.575 4.76e-06 ***
## (Intercept):3   1.022282   0.069060  14.803  &lt; 2e-16 ***
## (Intercept):4   1.598608   0.070211  22.769  &lt; 2e-16 ***
## (Intercept):5   2.114212   0.073265  28.857  &lt; 2e-16 ***
## (Intercept):6   2.592038   0.077363  33.505  &lt; 2e-16 ***
## (Intercept):7   3.046305   0.082086  37.111  &lt; 2e-16 ***
## (Intercept):8   3.483734   0.087173  39.964  &lt; 2e-16 ***
## (Intercept):9   3.918157   0.092562  42.330  &lt; 2e-16 ***
## (Intercept):10  4.349819   0.098091  44.345  &lt; 2e-16 ***
## (Intercept):11  4.778810   0.103624  46.117  &lt; 2e-16 ***
## (Intercept):12  5.213809   0.109165  47.761  &lt; 2e-16 ***
## (Intercept):13  5.666237   0.114784  49.364  &lt; 2e-16 ***
## (Intercept):14  6.151682   0.120650  50.988  &lt; 2e-16 ***
## (Intercept):15  6.687755   0.127085  52.624  &lt; 2e-16 ***
## (Intercept):16  7.278569   0.134653  54.054  &lt; 2e-16 ***
## (Intercept):17  8.030367   0.146859  54.681  &lt; 2e-16 ***
## (Intercept):18  8.922927   0.170686  52.277  &lt; 2e-16 ***
## (Intercept):19  9.993626   0.228059  43.820  &lt; 2e-16 ***
## (Intercept):20 11.286906   0.377899  29.868  &lt; 2e-16 ***
## (Intercept):21 12.548708   0.677595  18.519  &lt; 2e-16 ***
## Position_grid  -0.348591   0.007456 -46.753  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Number of linear predictors:  21 
## 
## Residual deviance: 16944.08 on 70349 degrees of freedom
## 
## Log-likelihood: -8472.041 on 70349 degrees of freedom
## 
## Number of Fisher scoring iterations: 7 
## 
## Warning: Hauck-Donner effect detected in the following estimate(s):
## &#39;(Intercept):17&#39;, &#39;(Intercept):18&#39;, &#39;(Intercept):19&#39;, &#39;(Intercept):20&#39;, &#39;(Intercept):21&#39;
## 
## 
## Exponentiated coefficients:
## Position_grid 
##     0.7056819</code></pre>
<p>How do I interpret these results? The interpretation can get a bit tedious. If you look at the bottom of the summary output, you will find an exponentiated coefficient for starting grid position (Position_grid = 0.7056819). We can interpret this value as:</p>
<p><em>For each place improvement in starting grid position, the odds of that driver finishing the race in a better position (i.e. P1 vs P2 or P19 vs P20) is 0.29 (1 - 0.71) times higher (than the driver starting the race one position lower on the grid.</em></p>
<p>The interpretation of the coefficient is not super intuitive. It makes sense, but it takes some effort to sort out.</p>
<p>Another way to visualize this model’s results is by making predictions with the model. Below, I’ll simulate a starting grid, and predict the final placing for each starting grid position. These predictions are actually <em>probabilities</em> of each finishing position. For example, this model estimates the probability that the pole-sitter finishes the race in P1, P2, P3, etc. These probabilities will include a 95% confidence interval.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="modeling-race-results.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a placeholder dataframe with all possible starting positions</span></span>
<span id="cb18-2"><a href="modeling-race-results.html#cb18-2" aria-hidden="true" tabindex="-1"></a>starting_grid <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">Position_grid =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb18-3"><a href="modeling-race-results.html#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="modeling-race-results.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a placeholder dataframe with names for predictions and standard errors. </span></span>
<span id="cb18-5"><a href="modeling-race-results.html#cb18-5" aria-hidden="true" tabindex="-1"></a>placing_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">prob =</span> <span class="fu">rep</span>(<span class="st">&#39;prob&#39;</span>, <span class="dv">21</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="modeling-race-results.html#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="modeling-race-results.html#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(prob, prob, y, <span class="at">remove =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb18-8"><a href="modeling-race-results.html#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se =</span> <span class="fu">rep</span>(<span class="st">&#39;se&#39;</span>, <span class="dv">21</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-9"><a href="modeling-race-results.html#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(se, se, y, <span class="at">remove =</span> F)</span>
<span id="cb18-10"><a href="modeling-race-results.html#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="modeling-race-results.html#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb18-12"><a href="modeling-race-results.html#cb18-12" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(overall_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb18-13"><a href="modeling-race-results.html#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="modeling-race-results.html#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb18-15"><a href="modeling-race-results.html#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob</span>
<span id="cb18-16"><a href="modeling-race-results.html#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="modeling-race-results.html#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb18-18"><a href="modeling-race-results.html#cb18-18" aria-hidden="true" tabindex="-1"></a>standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(overall_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb18-19"><a href="modeling-race-results.html#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="modeling-race-results.html#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb18-21"><a href="modeling-race-results.html#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se</span>
<span id="cb18-22"><a href="modeling-race-results.html#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="modeling-race-results.html#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="do">## As an example, I&#39;ll select the predictions and standard error for: Probability(P1 finish | P1 starting grid)</span></span>
<span id="cb18-24"><a href="modeling-race-results.html#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind the predictions and standard errors together, and convert the odds to probabilities. </span></span>
<span id="cb18-25"><a href="modeling-race-results.html#cb18-25" aria-hidden="true" tabindex="-1"></a>starting_grid_coef_finish1 <span class="ot">&lt;-</span> starting_grid <span class="sc">%&gt;%</span></span>
<span id="cb18-26"><a href="modeling-race-results.html#cb18-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">pr_1 =</span> predictions<span class="sc">$</span>prob_1,</span>
<span id="cb18-27"><a href="modeling-race-results.html#cb18-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">se_1 =</span> standard_errors<span class="sc">$</span>se_1) <span class="sc">%&gt;%</span></span>
<span id="cb18-28"><a href="modeling-race-results.html#cb18-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr =</span> <span class="fu">exp</span>(pr_1),</span>
<span id="cb18-29"><a href="modeling-race-results.html#cb18-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower =</span> <span class="fu">exp</span>(pr_1 <span class="sc">-</span> se_1 <span class="sc">*</span> <span class="fl">1.96</span>),</span>
<span id="cb18-30"><a href="modeling-race-results.html#cb18-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper =</span> <span class="fu">exp</span>(pr_1 <span class="sc">+</span> se_1 <span class="sc">*</span> <span class="fl">1.96</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-31"><a href="modeling-race-results.html#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">pr =</span> pr <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> pr),</span>
<span id="cb18-32"><a href="modeling-race-results.html#cb18-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">lower =</span> lower <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> lower),</span>
<span id="cb18-33"><a href="modeling-race-results.html#cb18-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> upper <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> upper))</span></code></pre></div>
<p><strong>What is the probability of winning a race?</strong></p>
<p>Now that the predictions are made, I will use <code>ggplot()</code> to plot the probability of winning a race given each potential starting position, <em>P(P1 finish | a starting grid position)</em>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="modeling-race-results.html#cb19-1" aria-hidden="true" tabindex="-1"></a>starting_grid_coef_finish1 <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="modeling-race-results.html#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Position_grid, <span class="at">y =</span> pr, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb19-3"><a href="modeling-race-results.html#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span></span>
<span id="cb19-4"><a href="modeling-race-results.html#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb19-5"><a href="modeling-race-results.html#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&#39;Probability of finishing P1&#39;</span>,</span>
<span id="cb19-6"><a href="modeling-race-results.html#cb19-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb19-7"><a href="modeling-race-results.html#cb19-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&#39;Ordinal Regression Model Predictions&#39;</span>,</span>
<span id="cb19-8"><a href="modeling-race-results.html#cb19-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;All Grands Prix: (2014 - 2023)&#39;</span>) <span class="sc">+</span></span>
<span id="cb19-9"><a href="modeling-race-results.html#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb19-10"><a href="modeling-race-results.html#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-16-1.png" width="960" /></p>
<p>If starting from P1, a driver has a 27% chance of winning the race, on average. If starting from P2, but still on the front row, a driver’s chance of winning drops to 21%.</p>
<p><strong>What is the probability of finishing on the podium?</strong></p>
<p>We can use the same approach to estimate the probability of a podium given a starting grid position.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="modeling-race-results.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## As an example, I&#39;ll select the predictions and standard error for: Probability(Podium | a starting grid)</span></span>
<span id="cb20-2"><a href="modeling-race-results.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind the predictions and standard errors together, and convert the odds to probabilities. </span></span>
<span id="cb20-3"><a href="modeling-race-results.html#cb20-3" aria-hidden="true" tabindex="-1"></a>starting_grid_coef_podium <span class="ot">&lt;-</span> starting_grid <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="modeling-race-results.html#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">pr_1 =</span> predictions<span class="sc">$</span>prob_3,</span>
<span id="cb20-5"><a href="modeling-race-results.html#cb20-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">se_1 =</span> standard_errors<span class="sc">$</span>se_3) <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="modeling-race-results.html#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr =</span> <span class="fu">exp</span>(pr_1),</span>
<span id="cb20-7"><a href="modeling-race-results.html#cb20-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower =</span> <span class="fu">exp</span>(pr_1 <span class="sc">-</span> se_1 <span class="sc">*</span> <span class="fl">1.96</span>),</span>
<span id="cb20-8"><a href="modeling-race-results.html#cb20-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper =</span> <span class="fu">exp</span>(pr_1 <span class="sc">+</span> se_1 <span class="sc">*</span> <span class="fl">1.96</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-9"><a href="modeling-race-results.html#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">pr =</span> pr <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> pr),</span>
<span id="cb20-10"><a href="modeling-race-results.html#cb20-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">lower =</span> lower <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> lower),</span>
<span id="cb20-11"><a href="modeling-race-results.html#cb20-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> upper <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> upper))</span>
<span id="cb20-12"><a href="modeling-race-results.html#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="modeling-race-results.html#cb20-13" aria-hidden="true" tabindex="-1"></a>starting_grid_coef_podium <span class="sc">%&gt;%</span></span>
<span id="cb20-14"><a href="modeling-race-results.html#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Position_grid, <span class="at">y =</span> pr, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb20-15"><a href="modeling-race-results.html#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span></span>
<span id="cb20-16"><a href="modeling-race-results.html#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb20-17"><a href="modeling-race-results.html#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&#39;Probability of a podium&#39;</span>,</span>
<span id="cb20-18"><a href="modeling-race-results.html#cb20-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb20-19"><a href="modeling-race-results.html#cb20-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&#39;Ordinal Regression Model Predictions&#39;</span>,</span>
<span id="cb20-20"><a href="modeling-race-results.html#cb20-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;All Grands Prix: (2014 - 2023)&#39;</span>) <span class="sc">+</span></span>
<span id="cb20-21"><a href="modeling-race-results.html#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb20-22"><a href="modeling-race-results.html#cb20-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-17-1.png" width="960" /></p>
<p>A driver starting from P1 has a 66% chance of finishing on the podium. I like those odds! A driver starting from P5 still has a 1 in 3 chance of finishing on the podium.</p>
<p>In my opinion, probabilities are more intuitive than odds. For that reason, I will use probabilities throughout the rest of the chapter.</p>
<div id="prediction-grid" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Prediction Grid<a href="modeling-race-results.html#prediction-grid" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>What if we wanted to know the probability of all finishing positions given each starting position? We can use a similar approach. I will plot the model predictions in a heat map below. Each tile represents the:
<em>Probability(a finishing position | a starting grid position)</em>.</p>
<p>To create this plot, I first need to re-shape the dataframe to a long format indexed by starting and finish position. I will also add a new column that contains the discrete probability of a given finish. Because the proportional odds model output is converted to a probabilistic statement like <em>Probability(finishing P3 or better | a starting position)</em>, the discrete probability column will give a statement like <em>Probability(finishing P3 | a starting position)</em>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="modeling-race-results.html#cb21-1" aria-hidden="true" tabindex="-1"></a>preds_se_full <span class="ot">&lt;-</span> predictions <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="modeling-race-results.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="modeling-race-results.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="modeling-race-results.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="modeling-race-results.html#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="modeling-race-results.html#cb21-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="modeling-race-results.html#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb21-8"><a href="modeling-race-results.html#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb21-9"><a href="modeling-race-results.html#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb21-10"><a href="modeling-race-results.html#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb21-11"><a href="modeling-race-results.html#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb21-12"><a href="modeling-race-results.html#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>Now that the data is re-shaped, I’ll plot the discrete and cumulative probability heatmaps.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="modeling-race-results.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Discrete Probability heatmap</span></span>
<span id="cb22-2"><a href="modeling-race-results.html#cb22-2" aria-hidden="true" tabindex="-1"></a>preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="modeling-race-results.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(starting, placing, <span class="at">fill =</span> discrete_prob)) <span class="sc">+</span></span>
<span id="cb22-4"><a href="modeling-race-results.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">col =</span> <span class="st">&#39;white&#39;</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb22-5"><a href="modeling-race-results.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte</span>(<span class="at">base_family=</span><span class="st">&quot;Helvetica&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-6"><a href="modeling-race-results.html#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&#39;magma&#39;</span>) <span class="sc">+</span></span>
<span id="cb22-7"><a href="modeling-race-results.html#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb22-8"><a href="modeling-race-results.html#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks=</span><span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb22-9"><a href="modeling-race-results.html#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Starting Grid&#39;</span>,</span>
<span id="cb22-10"><a href="modeling-race-results.html#cb22-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Final Placing&#39;</span>,</span>
<span id="cb22-11"><a href="modeling-race-results.html#cb22-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb22-12"><a href="modeling-race-results.html#cb22-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n])) <span class="sc">+</span></span>
<span id="cb22-13"><a href="modeling-race-results.html#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb22-14"><a href="modeling-race-results.html#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb22-15"><a href="modeling-race-results.html#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-19-1.png" width="960" /></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="modeling-race-results.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Cumulative Probability heatmap </span></span>
<span id="cb23-2"><a href="modeling-race-results.html#cb23-2" aria-hidden="true" tabindex="-1"></a>preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="modeling-race-results.html#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(starting, placing, <span class="at">fill =</span> prob)) <span class="sc">+</span></span>
<span id="cb23-4"><a href="modeling-race-results.html#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">col =</span> <span class="st">&#39;white&#39;</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb23-5"><a href="modeling-race-results.html#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte</span>(<span class="at">base_family=</span><span class="st">&quot;Helvetica&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-6"><a href="modeling-race-results.html#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&#39;magma&#39;</span>) <span class="sc">+</span></span>
<span id="cb23-7"><a href="modeling-race-results.html#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb23-8"><a href="modeling-race-results.html#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks=</span><span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb23-9"><a href="modeling-race-results.html#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Starting Grid&#39;</span>,</span>
<span id="cb23-10"><a href="modeling-race-results.html#cb23-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Final Placing&#39;</span>,</span>
<span id="cb23-11"><a href="modeling-race-results.html#cb23-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb23-12"><a href="modeling-race-results.html#cb23-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]<span class="sc">~</span>or<span class="sc">~</span>better)) <span class="sc">+</span></span>
<span id="cb23-13"><a href="modeling-race-results.html#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb23-14"><a href="modeling-race-results.html#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb23-15"><a href="modeling-race-results.html#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-19-2.png" width="960" /></p>
<p>The cumulative probability plot is helpful, but the discrete probability plot is a bit tough to follow. Let’s try plotting this information a different way. Rather than using a heat map, I will combine the probabilities into distributions using the code below.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="modeling-race-results.html#cb24-1" aria-hidden="true" tabindex="-1"></a>preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="modeling-race-results.html#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb24-3"><a href="modeling-race-results.html#cb24-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="modeling-race-results.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb24-5"><a href="modeling-race-results.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb24-6"><a href="modeling-race-results.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb24-7"><a href="modeling-race-results.html#cb24-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;cornflowerblue&#39;</span>) <span class="sc">+</span></span>
<span id="cb24-8"><a href="modeling-race-results.html#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-9"><a href="modeling-race-results.html#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb24-10"><a href="modeling-race-results.html#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb24-11"><a href="modeling-race-results.html#cb24-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb24-12"><a href="modeling-race-results.html#cb24-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb24-13"><a href="modeling-race-results.html#cb24-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;All races: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb24-14"><a href="modeling-race-results.html#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb24-15"><a href="modeling-race-results.html#cb24-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-20-1.png" width="960" /></p>
<p>The plot above shows the probability of finishing at any position given where the driver starts the race. In my opinion, this is a more interpretable representation of the data. You can track the shift in distributions as you move down the grid. It is important to keep in mind what data this model is built on. These predictions are generated solely from starting position. But, we know there is much more involved in where you finish. Otherwise, why even run the race?! Nonetheless, this data can be used to answer our hypothesis directly and it establishes a nice baseline to build upon. In the next section, I will try expanding this model to include additional variables.</p>
</div>
<div id="yearly-differences-in-ordinal-regression-results" class="section level3 hasAnchor" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Yearly Differences in Ordinal Regression Results<a href="modeling-race-results.html#yearly-differences-in-ordinal-regression-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Does this relationship between starting and finishing position vary over time? In the section, I will explore yearly differences in ordinal regression results. I will start by looking at changes occurring in 2022. After a forty-year ban, <strong>ground effect</strong> returned to Formula 1 in 2022. The goal for a Formula 1 design team is to optimize ground effect so that the bottom of the car generates low pressure, which will <em>suck</em> the car to the track. These new regulations in 2022 aimed to enable cars to follow more closely and overtake more easily. Theoretically, this change should decrease the correlation between starting position and finishing position. Is this represented in the data? Let’s model it and see!</p>
<p>I will fit an ordinal regression model for each year from 2014 to 2023. I will start with the pre-ground effect era. Here’s a model for each year from 2014 through 2021, which I will refer to as the <em>turbo-hybrid era</em>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="modeling-race-results.html#cb25-1" aria-hidden="true" tabindex="-1"></a>model14 <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb25-2"><a href="modeling-race-results.html#cb25-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb25-3"><a href="modeling-race-results.html#cb25-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="modeling-race-results.html#cb25-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2014</span>))</span>
<span id="cb25-5"><a href="modeling-race-results.html#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="modeling-race-results.html#cb25-6" aria-hidden="true" tabindex="-1"></a>model15 <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb25-7"><a href="modeling-race-results.html#cb25-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb25-8"><a href="modeling-race-results.html#cb25-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb25-9"><a href="modeling-race-results.html#cb25-9" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2015</span>))</span>
<span id="cb25-10"><a href="modeling-race-results.html#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="modeling-race-results.html#cb25-11" aria-hidden="true" tabindex="-1"></a>model16 <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb25-12"><a href="modeling-race-results.html#cb25-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb25-13"><a href="modeling-race-results.html#cb25-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb25-14"><a href="modeling-race-results.html#cb25-14" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2016</span>))</span>
<span id="cb25-15"><a href="modeling-race-results.html#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="modeling-race-results.html#cb25-16" aria-hidden="true" tabindex="-1"></a>model17 <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb25-17"><a href="modeling-race-results.html#cb25-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb25-18"><a href="modeling-race-results.html#cb25-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb25-19"><a href="modeling-race-results.html#cb25-19" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2017</span>))</span>
<span id="cb25-20"><a href="modeling-race-results.html#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="modeling-race-results.html#cb25-21" aria-hidden="true" tabindex="-1"></a>model18 <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb25-22"><a href="modeling-race-results.html#cb25-22" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb25-23"><a href="modeling-race-results.html#cb25-23" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb25-24"><a href="modeling-race-results.html#cb25-24" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2018</span>))</span>
<span id="cb25-25"><a href="modeling-race-results.html#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="modeling-race-results.html#cb25-26" aria-hidden="true" tabindex="-1"></a>model19 <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb25-27"><a href="modeling-race-results.html#cb25-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb25-28"><a href="modeling-race-results.html#cb25-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb25-29"><a href="modeling-race-results.html#cb25-29" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2019</span>))</span>
<span id="cb25-30"><a href="modeling-race-results.html#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="modeling-race-results.html#cb25-31" aria-hidden="true" tabindex="-1"></a>model20 <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb25-32"><a href="modeling-race-results.html#cb25-32" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb25-33"><a href="modeling-race-results.html#cb25-33" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb25-34"><a href="modeling-race-results.html#cb25-34" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2020</span>))</span>
<span id="cb25-35"><a href="modeling-race-results.html#cb25-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-36"><a href="modeling-race-results.html#cb25-36" aria-hidden="true" tabindex="-1"></a>model21 <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb25-37"><a href="modeling-race-results.html#cb25-37" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb25-38"><a href="modeling-race-results.html#cb25-38" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb25-39"><a href="modeling-race-results.html#cb25-39" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2021</span>))</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="modeling-race-results.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#exponentiate coefficient</span></span>
<span id="cb26-2"><a href="modeling-race-results.html#cb26-2" aria-hidden="true" tabindex="-1"></a>turbo_hybrid_coefs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Position_grid =</span> <span class="fu">rbind</span>(<span class="fu">summary</span>(model14)<span class="sc">@</span>post<span class="sc">$</span>expcoeffs,</span>
<span id="cb26-3"><a href="modeling-race-results.html#cb26-3" aria-hidden="true" tabindex="-1"></a>                                                       <span class="fu">summary</span>(model15)<span class="sc">@</span>post<span class="sc">$</span>expcoeffs,</span>
<span id="cb26-4"><a href="modeling-race-results.html#cb26-4" aria-hidden="true" tabindex="-1"></a>                                                       <span class="fu">summary</span>(model16)<span class="sc">@</span>post<span class="sc">$</span>expcoeffs,</span>
<span id="cb26-5"><a href="modeling-race-results.html#cb26-5" aria-hidden="true" tabindex="-1"></a>                                                       <span class="fu">summary</span>(model17)<span class="sc">@</span>post<span class="sc">$</span>expcoeffs,</span>
<span id="cb26-6"><a href="modeling-race-results.html#cb26-6" aria-hidden="true" tabindex="-1"></a>                                                       <span class="fu">summary</span>(model18)<span class="sc">@</span>post<span class="sc">$</span>expcoeffs,</span>
<span id="cb26-7"><a href="modeling-race-results.html#cb26-7" aria-hidden="true" tabindex="-1"></a>                                                       <span class="fu">summary</span>(model19)<span class="sc">@</span>post<span class="sc">$</span>expcoeffs,</span>
<span id="cb26-8"><a href="modeling-race-results.html#cb26-8" aria-hidden="true" tabindex="-1"></a>                                                       <span class="fu">summary</span>(model20)<span class="sc">@</span>post<span class="sc">$</span>expcoeffs,</span>
<span id="cb26-9"><a href="modeling-race-results.html#cb26-9" aria-hidden="true" tabindex="-1"></a>                                                       <span class="fu">summary</span>(model21)<span class="sc">@</span>post<span class="sc">$</span>expcoeffs),</span>
<span id="cb26-10"><a href="modeling-race-results.html#cb26-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Year =</span> <span class="fu">c</span>(<span class="dv">2014</span>, <span class="dv">2015</span>, <span class="dv">2016</span>, <span class="dv">2017</span>, <span class="dv">2018</span>, <span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>),</span>
<span id="cb26-11"><a href="modeling-race-results.html#cb26-11" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">era =</span> <span class="st">&#39;turbo-hybrid&#39;</span>)</span></code></pre></div>
<p>Now, I’ll fit two models for the recent ground effect era (2022 and 2023).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="modeling-race-results.html#cb27-1" aria-hidden="true" tabindex="-1"></a>model22 <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb27-2"><a href="modeling-race-results.html#cb27-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb27-3"><a href="modeling-race-results.html#cb27-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="modeling-race-results.html#cb27-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2022</span>))</span>
<span id="cb27-5"><a href="modeling-race-results.html#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="modeling-race-results.html#cb27-6" aria-hidden="true" tabindex="-1"></a>model23 <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb27-7"><a href="modeling-race-results.html#cb27-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb27-8"><a href="modeling-race-results.html#cb27-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="modeling-race-results.html#cb27-9" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2023</span>))</span></code></pre></div>
<p>Here, I will tidy up the model coefficient estimates and bind the two <em>eras</em> together.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="modeling-race-results.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#exponentiate coefficient</span></span>
<span id="cb28-2"><a href="modeling-race-results.html#cb28-2" aria-hidden="true" tabindex="-1"></a>ground_effects_coefs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Position_grid =</span> <span class="fu">rbind</span>(<span class="fu">summary</span>(model22)<span class="sc">@</span>post<span class="sc">$</span>expcoeffs,</span>
<span id="cb28-3"><a href="modeling-race-results.html#cb28-3" aria-hidden="true" tabindex="-1"></a>                                                       <span class="fu">summary</span>(model23)<span class="sc">@</span>post<span class="sc">$</span>expcoeffs),</span>
<span id="cb28-4"><a href="modeling-race-results.html#cb28-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">Year =</span> <span class="fu">c</span>(<span class="dv">2022</span>, <span class="dv">2023</span>),</span>
<span id="cb28-5"><a href="modeling-race-results.html#cb28-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">era =</span> <span class="st">&#39;ground effects&#39;</span>)</span>
<span id="cb28-6"><a href="modeling-race-results.html#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="modeling-race-results.html#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># combine the coefficients for these two eras</span></span>
<span id="cb28-8"><a href="modeling-race-results.html#cb28-8" aria-hidden="true" tabindex="-1"></a>all_coefs <span class="ot">&lt;-</span> turbo_hybrid_coefs <span class="sc">%&gt;%</span></span>
<span id="cb28-9"><a href="modeling-race-results.html#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(ground_effects_coefs) <span class="sc">%&gt;%</span></span>
<span id="cb28-10"><a href="modeling-race-results.html#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">era =</span> <span class="fu">factor</span>(era, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;turbo-hybrid&#39;</span>, <span class="st">&#39;ground effects&#39;</span>)))</span></code></pre></div>
<p>Finally, I can plot model coefficient estimates by year. In this plot, I use a color fill to distinguish the pre-ground effect turbo-hybrid era (a pink-red color is used for years 2014 - 2021) from the ground effect era (a cyan color is used for 2022 and 2023).</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="modeling-race-results.html#cb29-1" aria-hidden="true" tabindex="-1"></a>all_coefs <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="modeling-race-results.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Year, Position_grid)) <span class="sc">+</span></span>
<span id="cb29-3"><a href="modeling-race-results.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&#39;rect&#39;</span>, </span>
<span id="cb29-4"><a href="modeling-race-results.html#cb29-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xmax =</span> <span class="fl">2021.5</span>,</span>
<span id="cb29-5"><a href="modeling-race-results.html#cb29-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb29-6"><a href="modeling-race-results.html#cb29-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&#39;#F8766D&#39;</span>,</span>
<span id="cb29-7"><a href="modeling-race-results.html#cb29-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span> </span>
<span id="cb29-8"><a href="modeling-race-results.html#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&#39;rect&#39;</span>, </span>
<span id="cb29-9"><a href="modeling-race-results.html#cb29-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="fl">2021.5</span>, <span class="at">xmax =</span> <span class="cn">Inf</span>,</span>
<span id="cb29-10"><a href="modeling-race-results.html#cb29-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb29-11"><a href="modeling-race-results.html#cb29-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&#39;#00BFC4&#39;</span>,</span>
<span id="cb29-12"><a href="modeling-race-results.html#cb29-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span> </span>
<span id="cb29-13"><a href="modeling-race-results.html#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">2021.5</span>, <span class="at">col =</span> <span class="st">&#39;grey&#39;</span>) <span class="sc">+</span> </span>
<span id="cb29-14"><a href="modeling-race-results.html#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> era), <span class="at">pch =</span> <span class="dv">22</span>) <span class="sc">+</span></span>
<span id="cb29-15"><a href="modeling-race-results.html#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb29-16"><a href="modeling-race-results.html#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb29-17"><a href="modeling-race-results.html#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb29-18"><a href="modeling-race-results.html#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb29-19"><a href="modeling-race-results.html#cb29-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&#39;Year&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Coefficient Estimate for Starting Grid Position&#39;</span>,</span>
<span id="cb29-20"><a href="modeling-race-results.html#cb29-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&#39;Change in Ordinal Regression Model Coefficient Estimates&#39;</span>) <span class="sc">+</span></span>
<span id="cb29-21"><a href="modeling-race-results.html#cb29-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">2014</span>, <span class="dv">2023</span>, <span class="dv">1</span>),</span>
<span id="cb29-22"><a href="modeling-race-results.html#cb29-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2014</span>, <span class="dv">2023</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb29-23"><a href="modeling-race-results.html#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>,</span>
<span id="cb29-24"><a href="modeling-race-results.html#cb29-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-25-1.png" width="960" /></p>
<p>The plot above is not very easy to interpret. But, it is basically demonstrating that starting grid position matters <em>slightly less</em> in 2022 and 2023, relative to prior years. So, this does support the idea that the ground effect regulations increase a car’s ability to make up positions. However, the plot leaves much to be desired in terms of intuitiveness.</p>
<p>As an alternative, we can plot predicted probabilities for each year. This will require more effort to tidy up the probabilities and standard errors, but it gives us a much more granular insight into yearly differences. In the following code chunks, I will construct a dataframe for each year’s model that contains a predicted probability for each starting and finishing position combination. These probabilities are then ordered by starting position and grouped by finishing position to construct a distribution.</p>
<p>Here’s how I tidy up data for 2014 through 2021.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="modeling-race-results.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2014</span></span>
<span id="cb30-2"><a href="modeling-race-results.html#cb30-2" aria-hidden="true" tabindex="-1"></a>preds_2014 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predictvglm</span>(model14, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb30-3"><a href="modeling-race-results.html#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="modeling-race-results.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb30-5"><a href="modeling-race-results.html#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(preds_2014) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="sc">-</span><span class="dv">21</span>]</span>
<span id="cb30-6"><a href="modeling-race-results.html#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="modeling-race-results.html#cb30-7" aria-hidden="true" tabindex="-1"></a>preds_2014 <span class="ot">&lt;-</span> preds_2014  <span class="sc">%&gt;%</span> </span>
<span id="cb30-8"><a href="modeling-race-results.html#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2014</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-9"><a href="modeling-race-results.html#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb30-10"><a href="modeling-race-results.html#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="modeling-race-results.html#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb30-12"><a href="modeling-race-results.html#cb30-12" aria-hidden="true" tabindex="-1"></a>standard_errors_2014 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(model14, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb30-13"><a href="modeling-race-results.html#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="modeling-race-results.html#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb30-15"><a href="modeling-race-results.html#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(standard_errors_2014) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="sc">-</span><span class="dv">21</span>]</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="modeling-race-results.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2015</span></span>
<span id="cb31-2"><a href="modeling-race-results.html#cb31-2" aria-hidden="true" tabindex="-1"></a>preds_2015 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predictvglm</span>(model15, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb31-3"><a href="modeling-race-results.html#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="modeling-race-results.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb31-5"><a href="modeling-race-results.html#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(preds_2015) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb31-6"><a href="modeling-race-results.html#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="modeling-race-results.html#cb31-7" aria-hidden="true" tabindex="-1"></a>preds_2015 <span class="ot">&lt;-</span> preds_2015  <span class="sc">%&gt;%</span> </span>
<span id="cb31-8"><a href="modeling-race-results.html#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2015</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-9"><a href="modeling-race-results.html#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb31-10"><a href="modeling-race-results.html#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="modeling-race-results.html#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb31-12"><a href="modeling-race-results.html#cb31-12" aria-hidden="true" tabindex="-1"></a>standard_errors_2015 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(model15, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb31-13"><a href="modeling-race-results.html#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="modeling-race-results.html#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb31-15"><a href="modeling-race-results.html#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(standard_errors_2015) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="modeling-race-results.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2016</span></span>
<span id="cb32-2"><a href="modeling-race-results.html#cb32-2" aria-hidden="true" tabindex="-1"></a>preds_2016 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predictvglm</span>(model16, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb32-3"><a href="modeling-race-results.html#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="modeling-race-results.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb32-5"><a href="modeling-race-results.html#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(preds_2016) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob</span>
<span id="cb32-6"><a href="modeling-race-results.html#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="modeling-race-results.html#cb32-7" aria-hidden="true" tabindex="-1"></a>preds_2016 <span class="ot">&lt;-</span> preds_2016  <span class="sc">%&gt;%</span> </span>
<span id="cb32-8"><a href="modeling-race-results.html#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2016</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-9"><a href="modeling-race-results.html#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb32-10"><a href="modeling-race-results.html#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="modeling-race-results.html#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb32-12"><a href="modeling-race-results.html#cb32-12" aria-hidden="true" tabindex="-1"></a>standard_errors_2016 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(model16, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb32-13"><a href="modeling-race-results.html#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="modeling-race-results.html#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb32-15"><a href="modeling-race-results.html#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(standard_errors_2016) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="modeling-race-results.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2017</span></span>
<span id="cb33-2"><a href="modeling-race-results.html#cb33-2" aria-hidden="true" tabindex="-1"></a>preds_2017 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predictvglm</span>(model17, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb33-3"><a href="modeling-race-results.html#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="modeling-race-results.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb33-5"><a href="modeling-race-results.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(preds_2017) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>]</span>
<span id="cb33-6"><a href="modeling-race-results.html#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="modeling-race-results.html#cb33-7" aria-hidden="true" tabindex="-1"></a>preds_2017 <span class="ot">&lt;-</span> preds_2017  <span class="sc">%&gt;%</span> </span>
<span id="cb33-8"><a href="modeling-race-results.html#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-9"><a href="modeling-race-results.html#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb33-10"><a href="modeling-race-results.html#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="modeling-race-results.html#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb33-12"><a href="modeling-race-results.html#cb33-12" aria-hidden="true" tabindex="-1"></a>standard_errors_2017 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(model17, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit) <span class="sc">%&gt;%</span> </span>
<span id="cb33-13"><a href="modeling-race-results.html#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-14"><a href="modeling-race-results.html#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb33-15"><a href="modeling-race-results.html#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="modeling-race-results.html#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb33-17"><a href="modeling-race-results.html#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(standard_errors_2017) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="modeling-race-results.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2018</span></span>
<span id="cb34-2"><a href="modeling-race-results.html#cb34-2" aria-hidden="true" tabindex="-1"></a>preds_2018 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predictvglm</span>(model18, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb34-3"><a href="modeling-race-results.html#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="modeling-race-results.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb34-5"><a href="modeling-race-results.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(preds_2018) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb34-6"><a href="modeling-race-results.html#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="modeling-race-results.html#cb34-7" aria-hidden="true" tabindex="-1"></a>preds_2018 <span class="ot">&lt;-</span> preds_2018  <span class="sc">%&gt;%</span> </span>
<span id="cb34-8"><a href="modeling-race-results.html#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2018</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-9"><a href="modeling-race-results.html#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb34-10"><a href="modeling-race-results.html#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="modeling-race-results.html#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb34-12"><a href="modeling-race-results.html#cb34-12" aria-hidden="true" tabindex="-1"></a>standard_errors_2018 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(model18, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit) <span class="sc">%&gt;%</span> </span>
<span id="cb34-13"><a href="modeling-race-results.html#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2018</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-14"><a href="modeling-race-results.html#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb34-15"><a href="modeling-race-results.html#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="modeling-race-results.html#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb34-17"><a href="modeling-race-results.html#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(standard_errors_2018) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="modeling-race-results.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2019</span></span>
<span id="cb35-2"><a href="modeling-race-results.html#cb35-2" aria-hidden="true" tabindex="-1"></a>preds_2019 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predictvglm</span>(model19, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb35-3"><a href="modeling-race-results.html#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="modeling-race-results.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb35-5"><a href="modeling-race-results.html#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(preds_2019) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb35-6"><a href="modeling-race-results.html#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="modeling-race-results.html#cb35-7" aria-hidden="true" tabindex="-1"></a>preds_2019 <span class="ot">&lt;-</span> preds_2019  <span class="sc">%&gt;%</span> </span>
<span id="cb35-8"><a href="modeling-race-results.html#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-9"><a href="modeling-race-results.html#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb35-10"><a href="modeling-race-results.html#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="modeling-race-results.html#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb35-12"><a href="modeling-race-results.html#cb35-12" aria-hidden="true" tabindex="-1"></a>standard_errors_2019 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(model19, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit) <span class="sc">%&gt;%</span> </span>
<span id="cb35-13"><a href="modeling-race-results.html#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-14"><a href="modeling-race-results.html#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb35-15"><a href="modeling-race-results.html#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="modeling-race-results.html#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb35-17"><a href="modeling-race-results.html#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(standard_errors_2019) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="modeling-race-results.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2020</span></span>
<span id="cb36-2"><a href="modeling-race-results.html#cb36-2" aria-hidden="true" tabindex="-1"></a>preds_2020 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predictvglm</span>(model20, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb36-3"><a href="modeling-race-results.html#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="modeling-race-results.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb36-5"><a href="modeling-race-results.html#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(preds_2020) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span>
<span id="cb36-6"><a href="modeling-race-results.html#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="modeling-race-results.html#cb36-7" aria-hidden="true" tabindex="-1"></a>preds_2020 <span class="ot">&lt;-</span> preds_2020  <span class="sc">%&gt;%</span> </span>
<span id="cb36-8"><a href="modeling-race-results.html#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-9"><a href="modeling-race-results.html#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb36-10"><a href="modeling-race-results.html#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="modeling-race-results.html#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb36-12"><a href="modeling-race-results.html#cb36-12" aria-hidden="true" tabindex="-1"></a>standard_errors_2020 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(model20, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit) <span class="sc">%&gt;%</span> </span>
<span id="cb36-13"><a href="modeling-race-results.html#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-14"><a href="modeling-race-results.html#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb36-15"><a href="modeling-race-results.html#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="modeling-race-results.html#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb36-17"><a href="modeling-race-results.html#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(standard_errors_2020) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="modeling-race-results.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2021</span></span>
<span id="cb37-2"><a href="modeling-race-results.html#cb37-2" aria-hidden="true" tabindex="-1"></a>preds_2021 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predictvglm</span>(model21, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb37-3"><a href="modeling-race-results.html#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="modeling-race-results.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb37-5"><a href="modeling-race-results.html#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(preds_2021) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb37-6"><a href="modeling-race-results.html#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="modeling-race-results.html#cb37-7" aria-hidden="true" tabindex="-1"></a>preds_2021 <span class="ot">&lt;-</span> preds_2021  <span class="sc">%&gt;%</span> </span>
<span id="cb37-8"><a href="modeling-race-results.html#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2021</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-9"><a href="modeling-race-results.html#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb37-10"><a href="modeling-race-results.html#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="modeling-race-results.html#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb37-12"><a href="modeling-race-results.html#cb37-12" aria-hidden="true" tabindex="-1"></a>standard_errors_2021 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(model21, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit) <span class="sc">%&gt;%</span> </span>
<span id="cb37-13"><a href="modeling-race-results.html#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2021</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-14"><a href="modeling-race-results.html#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb37-15"><a href="modeling-race-results.html#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="modeling-race-results.html#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb37-17"><a href="modeling-race-results.html#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(standard_errors_2021) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span></code></pre></div>
<p>And, here’s tidied dataframes for 2022 and 2023.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="modeling-race-results.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2022</span></span>
<span id="cb38-2"><a href="modeling-race-results.html#cb38-2" aria-hidden="true" tabindex="-1"></a>preds_2022 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predictvglm</span>(model22, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb38-3"><a href="modeling-race-results.html#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="modeling-race-results.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb38-5"><a href="modeling-race-results.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(preds_2022) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb38-6"><a href="modeling-race-results.html#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="modeling-race-results.html#cb38-7" aria-hidden="true" tabindex="-1"></a>preds_2022 <span class="ot">&lt;-</span> preds_2022  <span class="sc">%&gt;%</span> </span>
<span id="cb38-8"><a href="modeling-race-results.html#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-9"><a href="modeling-race-results.html#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb38-10"><a href="modeling-race-results.html#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="modeling-race-results.html#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb38-12"><a href="modeling-race-results.html#cb38-12" aria-hidden="true" tabindex="-1"></a>standard_errors_2022 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(model22, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit) <span class="sc">%&gt;%</span> </span>
<span id="cb38-13"><a href="modeling-race-results.html#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-14"><a href="modeling-race-results.html#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb38-15"><a href="modeling-race-results.html#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="modeling-race-results.html#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb38-17"><a href="modeling-race-results.html#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(standard_errors_2022) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="modeling-race-results.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2023</span></span>
<span id="cb39-2"><a href="modeling-race-results.html#cb39-2" aria-hidden="true" tabindex="-1"></a>preds_2023 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predictvglm</span>(model23, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb39-3"><a href="modeling-race-results.html#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="modeling-race-results.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb39-5"><a href="modeling-race-results.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(preds_2023) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb39-6"><a href="modeling-race-results.html#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="modeling-race-results.html#cb39-7" aria-hidden="true" tabindex="-1"></a>preds_2023 <span class="ot">&lt;-</span> preds_2023  <span class="sc">%&gt;%</span> </span>
<span id="cb39-8"><a href="modeling-race-results.html#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-9"><a href="modeling-race-results.html#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb39-10"><a href="modeling-race-results.html#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="modeling-race-results.html#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb39-12"><a href="modeling-race-results.html#cb39-12" aria-hidden="true" tabindex="-1"></a>standard_errors_2023 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(model23, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit) <span class="sc">%&gt;%</span> </span>
<span id="cb39-13"><a href="modeling-race-results.html#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-14"><a href="modeling-race-results.html#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(starting_grid)</span>
<span id="cb39-15"><a href="modeling-race-results.html#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="modeling-race-results.html#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb39-17"><a href="modeling-race-results.html#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(standard_errors_2023) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span></code></pre></div>
<p><strong><em>How does starting position influence a driver’s probability of winning a race over the last 10 years?</em></strong></p>
<p>To answer this question, we can plot a yearly probability curve for finishing in P1 (across all starting grid positions).</p>
<p>In the code chunk below, I will bind together each year’s dataframe and plot the data.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="modeling-race-results.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(preds_2014[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], </span>
<span id="cb40-2"><a href="modeling-race-results.html#cb40-2" aria-hidden="true" tabindex="-1"></a>      preds_2015[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], </span>
<span id="cb40-3"><a href="modeling-race-results.html#cb40-3" aria-hidden="true" tabindex="-1"></a>      preds_2016[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], preds_2017[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], preds_2018[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)],</span>
<span id="cb40-4"><a href="modeling-race-results.html#cb40-4" aria-hidden="true" tabindex="-1"></a>      preds_2019[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)],</span>
<span id="cb40-5"><a href="modeling-race-results.html#cb40-5" aria-hidden="true" tabindex="-1"></a>      preds_2020[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], preds_2021[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], </span>
<span id="cb40-6"><a href="modeling-race-results.html#cb40-6" aria-hidden="true" tabindex="-1"></a>      preds_2022[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], preds_2023[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)]) <span class="sc">%&gt;%</span> </span>
<span id="cb40-7"><a href="modeling-race-results.html#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr =</span> <span class="fu">exp</span>(prob_1),</span>
<span id="cb40-8"><a href="modeling-race-results.html#cb40-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">Year =</span> <span class="fu">factor</span>(Year)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-9"><a href="modeling-race-results.html#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">pr =</span> pr <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> pr)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-10"><a href="modeling-race-results.html#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Position_grid, <span class="at">y =</span> pr, <span class="at">group  =</span> Year, <span class="at">col =</span> Year)) <span class="sc">+</span></span>
<span id="cb40-11"><a href="modeling-race-results.html#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb40-12"><a href="modeling-race-results.html#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>, <span class="fu">aes</span>(<span class="at">fill =</span> Year)) <span class="sc">+</span></span>
<span id="cb40-13"><a href="modeling-race-results.html#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb40-14"><a href="modeling-race-results.html#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&#39;Probability of finishing P1&#39;</span>,</span>
<span id="cb40-15"><a href="modeling-race-results.html#cb40-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb40-16"><a href="modeling-race-results.html#cb40-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&#39;Model Results by Year&#39;</span>) <span class="sc">+</span></span>
<span id="cb40-17"><a href="modeling-race-results.html#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">20</span>, <span class="dv">1</span>),</span>
<span id="cb40-18"><a href="modeling-race-results.html#cb40-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">20</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb40-19"><a href="modeling-race-results.html#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-36-1.png" width="960" /></p>
<p>This is tough to make sense of because the curves are so close to eachother. One possible solution is to use <code>facet_zoom()</code> to <em>zoom</em> in on podium places.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="modeling-race-results.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce)</span>
<span id="cb41-2"><a href="modeling-race-results.html#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="modeling-race-results.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(preds_2014[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], </span>
<span id="cb41-4"><a href="modeling-race-results.html#cb41-4" aria-hidden="true" tabindex="-1"></a>      preds_2015[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], </span>
<span id="cb41-5"><a href="modeling-race-results.html#cb41-5" aria-hidden="true" tabindex="-1"></a>      preds_2016[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], preds_2017[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], preds_2018[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)],</span>
<span id="cb41-6"><a href="modeling-race-results.html#cb41-6" aria-hidden="true" tabindex="-1"></a>      preds_2019[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)],</span>
<span id="cb41-7"><a href="modeling-race-results.html#cb41-7" aria-hidden="true" tabindex="-1"></a>      preds_2020[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], preds_2021[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], </span>
<span id="cb41-8"><a href="modeling-race-results.html#cb41-8" aria-hidden="true" tabindex="-1"></a>      preds_2022[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], preds_2023[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)]) <span class="sc">%&gt;%</span> </span>
<span id="cb41-9"><a href="modeling-race-results.html#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr =</span> <span class="fu">exp</span>(prob_1),</span>
<span id="cb41-10"><a href="modeling-race-results.html#cb41-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">Year =</span> <span class="fu">factor</span>(Year)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-11"><a href="modeling-race-results.html#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">pr =</span> pr <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> pr)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-12"><a href="modeling-race-results.html#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Position_grid, <span class="at">y =</span> pr, <span class="at">group  =</span> Year, <span class="at">col =</span> Year)) <span class="sc">+</span></span>
<span id="cb41-13"><a href="modeling-race-results.html#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb41-14"><a href="modeling-race-results.html#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>, <span class="fu">aes</span>(<span class="at">fill =</span> Year)) <span class="sc">+</span></span>
<span id="cb41-15"><a href="modeling-race-results.html#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb41-16"><a href="modeling-race-results.html#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&#39;Probability of finishing P1&#39;</span>,</span>
<span id="cb41-17"><a href="modeling-race-results.html#cb41-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb41-18"><a href="modeling-race-results.html#cb41-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&#39;Model Results by Year&#39;</span>,</span>
<span id="cb41-19"><a href="modeling-race-results.html#cb41-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">&#39;2021 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb41-20"><a href="modeling-race-results.html#cb41-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">20</span>, <span class="dv">1</span>),</span>
<span id="cb41-21"><a href="modeling-race-results.html#cb41-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">20</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb41-22"><a href="modeling-race-results.html#cb41-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb41-23"><a href="modeling-race-results.html#cb41-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb41-24"><a href="modeling-race-results.html#cb41-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>) <span class="sc">+</span></span>
<span id="cb41-25"><a href="modeling-race-results.html#cb41-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_zoom</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-37-1.png" width="960" /></p>
<p>Not much better! But, it was worth giving <code>facet_zoom()</code> a shot.</p>
<p><br>
<br></p>
<div class="blackbox">
<div class="center">
<p><strong>Zooming in on data with ggplot</strong></p>
</div>
<p>The <strong>ggforce</strong> package has a helpful function called <code>facet_zoom()</code>. This facetting function provides allows you to zoom in on a subset of the data, while keeping the view of the full dataset as a separate panel. The zoomed-in area will be indicated on the full dataset panel for reference.</p>
<p>For more information on <code>facet_zoom()</code>, check this out:</p>
<p><a href="https://ggforce.data-imaginist.com/reference/facet_zoom.html" class="uri">https://ggforce.data-imaginist.com/reference/facet_zoom.html</a></p>
<p>To learn about the <strong>ggforce</strong> package, see this link:</p>
<p><a href="https://ggforce.data-imaginist.com/index.html" class="uri">https://ggforce.data-imaginist.com/index.html</a></p>
</div>
<p><br>
<br></p>
<p>As an alternative, let’s filter the data by 2021, 2022, and 2023 only.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="modeling-race-results.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(preds_2021[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], </span>
<span id="cb42-2"><a href="modeling-race-results.html#cb42-2" aria-hidden="true" tabindex="-1"></a>      preds_2022[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], preds_2023[, <span class="fu">c</span>(<span class="st">&#39;prob_1&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)]) <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="modeling-race-results.html#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr =</span> <span class="fu">exp</span>(prob_1),</span>
<span id="cb42-4"><a href="modeling-race-results.html#cb42-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Year =</span> <span class="fu">factor</span>(Year)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-5"><a href="modeling-race-results.html#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">pr =</span> pr <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> pr)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-6"><a href="modeling-race-results.html#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Position_grid, <span class="at">y =</span> pr, <span class="at">group  =</span> Year, <span class="at">col =</span> Year)) <span class="sc">+</span></span>
<span id="cb42-7"><a href="modeling-race-results.html#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb42-8"><a href="modeling-race-results.html#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>, <span class="fu">aes</span>(<span class="at">fill =</span> Year)) <span class="sc">+</span></span>
<span id="cb42-9"><a href="modeling-race-results.html#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb42-10"><a href="modeling-race-results.html#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&#39;Probability of finishing P1&#39;</span>,</span>
<span id="cb42-11"><a href="modeling-race-results.html#cb42-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb42-12"><a href="modeling-race-results.html#cb42-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&#39;Model Results by Year&#39;</span>,</span>
<span id="cb42-13"><a href="modeling-race-results.html#cb42-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">&#39;2021 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb42-14"><a href="modeling-race-results.html#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">20</span>, <span class="dv">1</span>),</span>
<span id="cb42-15"><a href="modeling-race-results.html#cb42-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">20</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb42-16"><a href="modeling-race-results.html#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb42-17"><a href="modeling-race-results.html#cb42-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb42-18"><a href="modeling-race-results.html#cb42-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>) <span class="sc">+</span></span>
<span id="cb42-19"><a href="modeling-race-results.html#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_zoom</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-38-1.png" width="960" /></p>
<p>This is better. It looks like drivers in 2022 and 2023 had a better chance of winning a race from 5th or worse position on the starting grid. In 2021, drivers who started from the first two rows of the grid had a better chance of winning than they did in 2022. Are these differences due to the new regulations, or is this simply capturing the fact that Verstappen won from 7th, 10th, and 14th with the recent Red Bull car? Not sure!</p>
<p>What about podiums? Because this model estimates the <em>cumulative</em> probability, the model is already estimating a probability of a podium (i.e. Probability(finish &lt;= P3 | a starting position). So, I will plot these below.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="modeling-race-results.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(preds_2021[, <span class="fu">c</span>(<span class="st">&#39;prob_3&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], </span>
<span id="cb43-2"><a href="modeling-race-results.html#cb43-2" aria-hidden="true" tabindex="-1"></a>      preds_2022[, <span class="fu">c</span>(<span class="st">&#39;prob_3&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)], </span>
<span id="cb43-3"><a href="modeling-race-results.html#cb43-3" aria-hidden="true" tabindex="-1"></a>      preds_2023[, <span class="fu">c</span>(<span class="st">&#39;prob_3&#39;</span>, <span class="st">&#39;Year&#39;</span>, <span class="st">&#39;Position_grid&#39;</span>)]) <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="modeling-race-results.html#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr =</span> <span class="fu">exp</span>(prob_3),</span>
<span id="cb43-5"><a href="modeling-race-results.html#cb43-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Year =</span> <span class="fu">factor</span>(Year)) <span class="sc">%&gt;%</span></span>
<span id="cb43-6"><a href="modeling-race-results.html#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">pr =</span> pr <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> pr)) <span class="sc">%&gt;%</span></span>
<span id="cb43-7"><a href="modeling-race-results.html#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Position_grid, <span class="at">y =</span> pr, <span class="at">group  =</span> Year, <span class="at">col =</span> Year)) <span class="sc">+</span></span>
<span id="cb43-8"><a href="modeling-race-results.html#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb43-9"><a href="modeling-race-results.html#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>, <span class="fu">aes</span>(<span class="at">fill =</span> Year)) <span class="sc">+</span></span>
<span id="cb43-10"><a href="modeling-race-results.html#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb43-11"><a href="modeling-race-results.html#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&#39;Probability of finishing on the podium&#39;</span>,</span>
<span id="cb43-12"><a href="modeling-race-results.html#cb43-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb43-13"><a href="modeling-race-results.html#cb43-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&#39;Model Results by Year&#39;</span>,</span>
<span id="cb43-14"><a href="modeling-race-results.html#cb43-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">&#39;2021 - 2023&#39;</span>)  <span class="sc">+</span></span>
<span id="cb43-15"><a href="modeling-race-results.html#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb43-16"><a href="modeling-race-results.html#cb43-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb43-17"><a href="modeling-race-results.html#cb43-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-39-1.png" width="960" /></p>
<p>The podium probabilities are even more compelling. Drivers starting from 5th or lower have an even greater chance of finishing on the podium in 2022 and 2023. In the next section, we will look into circuit-specific models.</p>
</div>
</div>
<div id="explore-circuit-specific-models" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Explore Circuit Specific Models<a href="modeling-race-results.html#explore-circuit-specific-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It is generally accepted among racing teams, drivers, and enthusiasts that overtaking (or passing opponents) is easier at some circuits compared to others. Let’s explore whether there are indeed differences in our model coefficients across different circuits.</p>
<p>Note: Throughout this section, I will provide minimal commentary about the plots. This section is primarily for referencing and <em>gee-whiz</em> purposes.</p>
<div id="bahrain" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Bahrain<a href="modeling-race-results.html#bahrain" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Bahrain Grand Prix is the first race of the season. What type of finish might we expect, if only using starting grid position as a predictor? Let’s fit the same model to one track.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="modeling-race-results.html#cb44-1" aria-hidden="true" tabindex="-1"></a>bahrain_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb44-2"><a href="modeling-race-results.html#cb44-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb44-3"><a href="modeling-race-results.html#cb44-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="modeling-race-results.html#cb44-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;bahrain&#39;</span>))</span></code></pre></div>
<p>Now, we can make predictions for the grid.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="modeling-race-results.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb45-2"><a href="modeling-race-results.html#cb45-2" aria-hidden="true" tabindex="-1"></a>predictions_bahrain <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(bahrain_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb45-3"><a href="modeling-race-results.html#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="modeling-race-results.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb45-5"><a href="modeling-race-results.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(predictions_bahrain) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span>
<span id="cb45-6"><a href="modeling-race-results.html#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="modeling-race-results.html#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb45-8"><a href="modeling-race-results.html#cb45-8" aria-hidden="true" tabindex="-1"></a>standard_errors_bahrain <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(bahrain_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb45-9"><a href="modeling-race-results.html#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="modeling-race-results.html#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb45-11"><a href="modeling-race-results.html#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(standard_errors_bahrain) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span></code></pre></div>
<p>And, we can plot the data using this code:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="modeling-race-results.html#cb46-1" aria-hidden="true" tabindex="-1"></a>starting_grid <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="modeling-race-results.html#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">pr_1 =</span> predictions_bahrain<span class="sc">$</span>prob_1,</span>
<span id="cb46-3"><a href="modeling-race-results.html#cb46-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">se_1 =</span> standard_errors_bahrain<span class="sc">$</span>se_1) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="modeling-race-results.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr =</span> <span class="fu">exp</span>(pr_1),</span>
<span id="cb46-5"><a href="modeling-race-results.html#cb46-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower =</span> <span class="fu">exp</span>(pr_1 <span class="sc">-</span> se_1 <span class="sc">*</span> <span class="fl">1.96</span>),</span>
<span id="cb46-6"><a href="modeling-race-results.html#cb46-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper =</span> <span class="fu">exp</span>(pr_1 <span class="sc">+</span> se_1 <span class="sc">*</span> <span class="fl">1.96</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-7"><a href="modeling-race-results.html#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">pr =</span> pr <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> pr),</span>
<span id="cb46-8"><a href="modeling-race-results.html#cb46-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">lower =</span> lower <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> lower),</span>
<span id="cb46-9"><a href="modeling-race-results.html#cb46-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> upper <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> upper)) <span class="sc">%&gt;%</span></span>
<span id="cb46-10"><a href="modeling-race-results.html#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Position_grid, <span class="at">y =</span> pr, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb46-11"><a href="modeling-race-results.html#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span></span>
<span id="cb46-12"><a href="modeling-race-results.html#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb46-13"><a href="modeling-race-results.html#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&#39;Probability of finishing P1&#39;</span>,</span>
<span id="cb46-14"><a href="modeling-race-results.html#cb46-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb46-15"><a href="modeling-race-results.html#cb46-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&#39;Bahrain Grand Prix&#39;</span>,</span>
<span id="cb46-16"><a href="modeling-race-results.html#cb46-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">&#39;Probability of a win&#39;</span>) <span class="sc">+</span></span>
<span id="cb46-17"><a href="modeling-race-results.html#cb46-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb46-18"><a href="modeling-race-results.html#cb46-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb46-19"><a href="modeling-race-results.html#cb46-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-42-1.png" width="960" /></p>
<p>What’s the probability of a podium? We can extract these probabilities (and standard errors), and plot with ggplot.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="modeling-race-results.html#cb47-1" aria-hidden="true" tabindex="-1"></a>starting_grid <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="modeling-race-results.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">pr_3 =</span> predictions_bahrain<span class="sc">$</span>prob_3,</span>
<span id="cb47-3"><a href="modeling-race-results.html#cb47-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">se_3 =</span> standard_errors_bahrain<span class="sc">$</span>se_3) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="modeling-race-results.html#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr =</span> <span class="fu">exp</span>(pr_3),</span>
<span id="cb47-5"><a href="modeling-race-results.html#cb47-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower =</span> <span class="fu">exp</span>(pr_3 <span class="sc">-</span> se_3 <span class="sc">*</span> <span class="fl">1.96</span>),</span>
<span id="cb47-6"><a href="modeling-race-results.html#cb47-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper =</span> <span class="fu">exp</span>(pr_3 <span class="sc">+</span> se_3 <span class="sc">*</span> <span class="fl">1.96</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-7"><a href="modeling-race-results.html#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">pr =</span> pr <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> pr),</span>
<span id="cb47-8"><a href="modeling-race-results.html#cb47-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">lower =</span> lower <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> lower),</span>
<span id="cb47-9"><a href="modeling-race-results.html#cb47-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> upper <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> upper)) <span class="sc">%&gt;%</span></span>
<span id="cb47-10"><a href="modeling-race-results.html#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Position_grid, <span class="at">y =</span> pr, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb47-11"><a href="modeling-race-results.html#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span></span>
<span id="cb47-12"><a href="modeling-race-results.html#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb47-13"><a href="modeling-race-results.html#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&#39;Probability of a podium&#39;</span>,</span>
<span id="cb47-14"><a href="modeling-race-results.html#cb47-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb47-15"><a href="modeling-race-results.html#cb47-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&#39;Bahrain Gand Prix&#39;</span>,</span>
<span id="cb47-16"><a href="modeling-race-results.html#cb47-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">&#39;Probability of a podium&#39;</span>) <span class="sc">+</span></span>
<span id="cb47-17"><a href="modeling-race-results.html#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb47-18"><a href="modeling-race-results.html#cb47-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb47-19"><a href="modeling-race-results.html#cb47-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-43-1.png" width="960" /></p>
<p>And now, I’ll construct probability distributions for each finishing position given a starting a position at the Bahrain GP.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="modeling-race-results.html#cb48-1" aria-hidden="true" tabindex="-1"></a>bahrain_preds_se_full <span class="ot">&lt;-</span> predictions_bahrain <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="modeling-race-results.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="modeling-race-results.html#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-4"><a href="modeling-race-results.html#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(standard_errors_bahrain <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="modeling-race-results.html#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-6"><a href="modeling-race-results.html#cb48-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb48-7"><a href="modeling-race-results.html#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb48-8"><a href="modeling-race-results.html#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb48-9"><a href="modeling-race-results.html#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb48-10"><a href="modeling-race-results.html#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb48-11"><a href="modeling-race-results.html#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb48-12"><a href="modeling-race-results.html#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb48-13"><a href="modeling-race-results.html#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="modeling-race-results.html#cb48-14" aria-hidden="true" tabindex="-1"></a>bahrain_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb48-15"><a href="modeling-race-results.html#cb48-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb48-16"><a href="modeling-race-results.html#cb48-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb48-17"><a href="modeling-race-results.html#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb48-18"><a href="modeling-race-results.html#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb48-19"><a href="modeling-race-results.html#cb48-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb48-20"><a href="modeling-race-results.html#cb48-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">col =</span> <span class="st">&#39;maroon&#39;</span>) <span class="sc">+</span></span>
<span id="cb48-21"><a href="modeling-race-results.html#cb48-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb48-22"><a href="modeling-race-results.html#cb48-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb48-23"><a href="modeling-race-results.html#cb48-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb48-24"><a href="modeling-race-results.html#cb48-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb48-25"><a href="modeling-race-results.html#cb48-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb48-26"><a href="modeling-race-results.html#cb48-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Bahrain Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb48-27"><a href="modeling-race-results.html#cb48-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb48-28"><a href="modeling-race-results.html#cb48-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb48-29"><a href="modeling-race-results.html#cb48-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">18</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">18</span>)) <span class="sc">+</span></span>
<span id="cb48-30"><a href="modeling-race-results.html#cb48-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb48-31"><a href="modeling-race-results.html#cb48-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb48-32"><a href="modeling-race-results.html#cb48-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-44-1.png" width="960" /></p>
</div>
<div id="saudi-arabia" class="section level3 hasAnchor" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> Saudi Arabia<a href="modeling-race-results.html#saudi-arabia" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The second race of the 2023 season takes place in Saudi Arabia at the Jeddah Corniche Circuit. Jeddah is the fastest street circuit in Formula 1. How does it compare to other street circuits?</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="modeling-race-results.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb49-2"><a href="modeling-race-results.html#cb49-2" aria-hidden="true" tabindex="-1"></a>saudiarabia_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb49-3"><a href="modeling-race-results.html#cb49-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb49-4"><a href="modeling-race-results.html#cb49-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="modeling-race-results.html#cb49-5" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;saudi-arabia&#39;</span>))</span>
<span id="cb49-6"><a href="modeling-race-results.html#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="modeling-race-results.html#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb49-8"><a href="modeling-race-results.html#cb49-8" aria-hidden="true" tabindex="-1"></a>predictions_saudiarabia <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(saudiarabia_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb49-9"><a href="modeling-race-results.html#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="modeling-race-results.html#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb49-11"><a href="modeling-race-results.html#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(predictions_saudiarabia) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>]</span>
<span id="cb49-12"><a href="modeling-race-results.html#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="modeling-race-results.html#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb49-14"><a href="modeling-race-results.html#cb49-14" aria-hidden="true" tabindex="-1"></a>standard_errors_saudiarabia <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(saudiarabia_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb49-15"><a href="modeling-race-results.html#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="modeling-race-results.html#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb49-17"><a href="modeling-race-results.html#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(standard_errors_saudiarabia) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>]</span></code></pre></div>
<p>Here, I will plot the probability of a win at the Saudi Arabian Grand Prix.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="modeling-race-results.html#cb50-1" aria-hidden="true" tabindex="-1"></a>starting_grid <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="modeling-race-results.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">pr_1 =</span> predictions_saudiarabia<span class="sc">$</span>prob_1,</span>
<span id="cb50-3"><a href="modeling-race-results.html#cb50-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">se_1 =</span> standard_errors_saudiarabia<span class="sc">$</span>se_1) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="modeling-race-results.html#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr =</span> <span class="fu">exp</span>(pr_1),</span>
<span id="cb50-5"><a href="modeling-race-results.html#cb50-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower =</span> <span class="fu">exp</span>(pr_1 <span class="sc">-</span> se_1 <span class="sc">*</span> <span class="fl">1.96</span>),</span>
<span id="cb50-6"><a href="modeling-race-results.html#cb50-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper =</span> <span class="fu">exp</span>(pr_1 <span class="sc">+</span> se_1 <span class="sc">*</span> <span class="fl">1.96</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb50-7"><a href="modeling-race-results.html#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">pr =</span> pr <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> pr),</span>
<span id="cb50-8"><a href="modeling-race-results.html#cb50-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">lower =</span> lower <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> lower),</span>
<span id="cb50-9"><a href="modeling-race-results.html#cb50-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> upper <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> upper)) <span class="sc">%&gt;%</span></span>
<span id="cb50-10"><a href="modeling-race-results.html#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Position_grid, <span class="at">y =</span> pr, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb50-11"><a href="modeling-race-results.html#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span></span>
<span id="cb50-12"><a href="modeling-race-results.html#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb50-13"><a href="modeling-race-results.html#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&#39;Probability of finishing P1&#39;</span>,</span>
<span id="cb50-14"><a href="modeling-race-results.html#cb50-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb50-15"><a href="modeling-race-results.html#cb50-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&#39;Saudi Arabia&#39;</span>,</span>
<span id="cb50-16"><a href="modeling-race-results.html#cb50-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">&#39;Probability of a win&#39;</span>) <span class="sc">+</span></span>
<span id="cb50-17"><a href="modeling-race-results.html#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb50-18"><a href="modeling-race-results.html#cb50-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb50-19"><a href="modeling-race-results.html#cb50-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-46-1.png" width="960" /></p>
<p>And here are probabilities of a podium.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="modeling-race-results.html#cb51-1" aria-hidden="true" tabindex="-1"></a>starting_grid <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="modeling-race-results.html#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">pr_3 =</span> predictions_saudiarabia<span class="sc">$</span>prob_3,</span>
<span id="cb51-3"><a href="modeling-race-results.html#cb51-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">se_3 =</span> standard_errors_saudiarabia<span class="sc">$</span>se_3) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="modeling-race-results.html#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr =</span> <span class="fu">exp</span>(pr_3),</span>
<span id="cb51-5"><a href="modeling-race-results.html#cb51-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower =</span> <span class="fu">exp</span>(pr_3 <span class="sc">-</span> se_3 <span class="sc">*</span> <span class="fl">1.96</span>),</span>
<span id="cb51-6"><a href="modeling-race-results.html#cb51-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper =</span> <span class="fu">exp</span>(pr_3 <span class="sc">+</span> se_3 <span class="sc">*</span> <span class="fl">1.96</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-7"><a href="modeling-race-results.html#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">pr =</span> pr <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> pr),</span>
<span id="cb51-8"><a href="modeling-race-results.html#cb51-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">lower =</span> lower <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> lower),</span>
<span id="cb51-9"><a href="modeling-race-results.html#cb51-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> upper <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> upper)) <span class="sc">%&gt;%</span></span>
<span id="cb51-10"><a href="modeling-race-results.html#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Position_grid, <span class="at">y =</span> pr, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb51-11"><a href="modeling-race-results.html#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span></span>
<span id="cb51-12"><a href="modeling-race-results.html#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb51-13"><a href="modeling-race-results.html#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&#39;Probability of finishing on the podium&#39;</span>,</span>
<span id="cb51-14"><a href="modeling-race-results.html#cb51-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb51-15"><a href="modeling-race-results.html#cb51-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&#39;Saudi Arabia&#39;</span>,</span>
<span id="cb51-16"><a href="modeling-race-results.html#cb51-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">&#39;Probability of a podium&#39;</span>) <span class="sc">+</span></span>
<span id="cb51-17"><a href="modeling-race-results.html#cb51-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb51-18"><a href="modeling-race-results.html#cb51-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb51-19"><a href="modeling-race-results.html#cb51-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-47-1.png" width="960" /></p>
<p>Here’s the full distribution for each starting grid position.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="modeling-race-results.html#cb52-1" aria-hidden="true" tabindex="-1"></a>saudiarabia_preds_se_full <span class="ot">&lt;-</span> predictions_saudiarabia <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="modeling-race-results.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="modeling-race-results.html#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-4"><a href="modeling-race-results.html#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(standard_errors_saudiarabia <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb52-5"><a href="modeling-race-results.html#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-6"><a href="modeling-race-results.html#cb52-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb52-7"><a href="modeling-race-results.html#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb52-8"><a href="modeling-race-results.html#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb52-9"><a href="modeling-race-results.html#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb52-10"><a href="modeling-race-results.html#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb52-11"><a href="modeling-race-results.html#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb52-12"><a href="modeling-race-results.html#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb52-13"><a href="modeling-race-results.html#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="modeling-race-results.html#cb52-14" aria-hidden="true" tabindex="-1"></a>saudiarabia_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb52-15"><a href="modeling-race-results.html#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb52-16"><a href="modeling-race-results.html#cb52-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb52-17"><a href="modeling-race-results.html#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb52-18"><a href="modeling-race-results.html#cb52-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb52-19"><a href="modeling-race-results.html#cb52-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">col =</span> <span class="st">&#39;darkgreen&#39;</span>) <span class="sc">+</span></span>
<span id="cb52-20"><a href="modeling-race-results.html#cb52-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb52-21"><a href="modeling-race-results.html#cb52-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb52-22"><a href="modeling-race-results.html#cb52-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb52-23"><a href="modeling-race-results.html#cb52-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb52-24"><a href="modeling-race-results.html#cb52-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb52-25"><a href="modeling-race-results.html#cb52-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb52-26"><a href="modeling-race-results.html#cb52-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Saudi Arabian Grand Prix: 2021 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb52-27"><a href="modeling-race-results.html#cb52-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb52-28"><a href="modeling-race-results.html#cb52-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb52-29"><a href="modeling-race-results.html#cb52-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">18</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">18</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-48-1.png" width="960" /></p>
<p>There are only three races to construct this Saudi Arabian model, so there’s considerable variability in the estimated probabilities. That being said, we can still compare these point estimates to a much slower street circuit like Monaco.</p>
</div>
<div id="monaco" class="section level3 hasAnchor" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> Monaco<a href="modeling-race-results.html#monaco" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The most prestigious race on the Formula One calender takes place at the Circuit de Monaco. The Monaco Grand Prix takes place on the very narrow streets of Monte Carlo with plenty of elevation change and slow tight corners. In fact, it is the slowest circuit on the calender and includes the slowest corner of the entire season. These low speeds, tight quarters, and slow corners combine to produce the toughest circuit to overtake on. Over it’s history, this Grand Prix averages about a dozen overtakes per race. I’m interested in knowing if these characteristics will show up when we model this race. Theoretically, the Monaco Grand Prix should have the tightest distributions. Let’s see if the data support this!</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="modeling-race-results.html#cb53-1" aria-hidden="true" tabindex="-1"></a>monaco_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb53-2"><a href="modeling-race-results.html#cb53-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb53-3"><a href="modeling-race-results.html#cb53-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="modeling-race-results.html#cb53-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;monaco&#39;</span>))</span></code></pre></div>
<p>After fitting the model, I will make predictions with the following code:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="modeling-race-results.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb54-2"><a href="modeling-race-results.html#cb54-2" aria-hidden="true" tabindex="-1"></a>predictions_monaco <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(monaco_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb54-3"><a href="modeling-race-results.html#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="modeling-race-results.html#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb54-5"><a href="modeling-race-results.html#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(predictions_monaco) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span>
<span id="cb54-6"><a href="modeling-race-results.html#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="modeling-race-results.html#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb54-8"><a href="modeling-race-results.html#cb54-8" aria-hidden="true" tabindex="-1"></a>standard_errors_monaco <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(monaco_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb54-9"><a href="modeling-race-results.html#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="modeling-race-results.html#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb54-11"><a href="modeling-race-results.html#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(standard_errors_monaco) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span></code></pre></div>
<p>Now, I’ll plot the Probability(P1 finish | a starting grid) at Monaco:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="modeling-race-results.html#cb55-1" aria-hidden="true" tabindex="-1"></a>starting_grid <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="modeling-race-results.html#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">pr_1 =</span> predictions_monaco<span class="sc">$</span>prob_1,</span>
<span id="cb55-3"><a href="modeling-race-results.html#cb55-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">se_1 =</span> standard_errors_monaco<span class="sc">$</span>se_1) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="modeling-race-results.html#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr =</span> <span class="fu">exp</span>(pr_1),</span>
<span id="cb55-5"><a href="modeling-race-results.html#cb55-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower =</span> <span class="fu">exp</span>(pr_1 <span class="sc">-</span> se_1 <span class="sc">*</span> <span class="fl">1.96</span>),</span>
<span id="cb55-6"><a href="modeling-race-results.html#cb55-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper =</span> <span class="fu">exp</span>(pr_1 <span class="sc">+</span> se_1 <span class="sc">*</span> <span class="fl">1.96</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-7"><a href="modeling-race-results.html#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">pr =</span> pr <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> pr),</span>
<span id="cb55-8"><a href="modeling-race-results.html#cb55-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">lower =</span> lower <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> lower),</span>
<span id="cb55-9"><a href="modeling-race-results.html#cb55-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> upper <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> upper)) <span class="sc">%&gt;%</span></span>
<span id="cb55-10"><a href="modeling-race-results.html#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Position_grid, <span class="at">y =</span> pr, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb55-11"><a href="modeling-race-results.html#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span></span>
<span id="cb55-12"><a href="modeling-race-results.html#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb55-13"><a href="modeling-race-results.html#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&#39;Probability of finishing P1&#39;</span>,</span>
<span id="cb55-14"><a href="modeling-race-results.html#cb55-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb55-15"><a href="modeling-race-results.html#cb55-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&#39;Monaco&#39;</span>) <span class="sc">+</span></span>
<span id="cb55-16"><a href="modeling-race-results.html#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb55-17"><a href="modeling-race-results.html#cb55-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-51-1.png" width="960" /></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="modeling-race-results.html#cb56-1" aria-hidden="true" tabindex="-1"></a>monaco_preds_se_full <span class="ot">&lt;-</span> predictions_monaco <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="modeling-race-results.html#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="modeling-race-results.html#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-4"><a href="modeling-race-results.html#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(standard_errors_monaco <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb56-5"><a href="modeling-race-results.html#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-6"><a href="modeling-race-results.html#cb56-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb56-7"><a href="modeling-race-results.html#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb56-8"><a href="modeling-race-results.html#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb56-9"><a href="modeling-race-results.html#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb56-10"><a href="modeling-race-results.html#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb56-11"><a href="modeling-race-results.html#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb56-12"><a href="modeling-race-results.html#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>Here’s a plot of all the distributions for Monaco:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="modeling-race-results.html#cb57-1" aria-hidden="true" tabindex="-1"></a>monaco_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="modeling-race-results.html#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb57-3"><a href="modeling-race-results.html#cb57-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="modeling-race-results.html#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb57-5"><a href="modeling-race-results.html#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb57-6"><a href="modeling-race-results.html#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb57-7"><a href="modeling-race-results.html#cb57-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>) <span class="sc">+</span></span>
<span id="cb57-8"><a href="modeling-race-results.html#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb57-9"><a href="modeling-race-results.html#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb57-10"><a href="modeling-race-results.html#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb57-11"><a href="modeling-race-results.html#cb57-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb57-12"><a href="modeling-race-results.html#cb57-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb57-13"><a href="modeling-race-results.html#cb57-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Monaco Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb57-14"><a href="modeling-race-results.html#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb57-15"><a href="modeling-race-results.html#cb57-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-53-1.png" width="960" /></p>
<p>Let’s compare the fastest street circuit (Jeddah) to the slowest (Monaco).</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="modeling-race-results.html#cb58-1" aria-hidden="true" tabindex="-1"></a>saudiarabia_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="modeling-race-results.html#cb58-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(starting, placing, discrete_prob) <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="modeling-race-results.html#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(monaco_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb58-4"><a href="modeling-race-results.html#cb58-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(starting, placing, discrete_prob), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;starting&quot;</span>, <span class="st">&quot;placing&quot;</span>), <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_saudiarabia&quot;</span>, <span class="st">&quot;_monaco&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-5"><a href="modeling-race-results.html#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb58-6"><a href="modeling-race-results.html#cb58-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting),</span>
<span id="cb58-7"><a href="modeling-race-results.html#cb58-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">delta =</span> <span class="fu">ifelse</span>(discrete_prob_monaco <span class="sc">&gt;</span> discrete_prob_saudiarabia, <span class="st">&#39;monaco&#39;</span>, <span class="st">&#39;saudiarabia&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-8"><a href="modeling-race-results.html#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(starting_pos <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;P1&#39;</span>, <span class="st">&#39;P2&#39;</span>, <span class="st">&#39;P3&#39;</span>, <span class="st">&#39;P4&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-9"><a href="modeling-race-results.html#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb58-10"><a href="modeling-race-results.html#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> discrete_prob_saudiarabia, <span class="at">yend =</span> discrete_prob_monaco, <span class="at">col =</span> delta),</span>
<span id="cb58-11"><a href="modeling-race-results.html#cb58-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb58-12"><a href="modeling-race-results.html#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>, <span class="fu">aes</span>(placing, discrete_prob_saudiarabia, <span class="at">fill =</span> <span class="st">&#39;Saudi Arabia&#39;</span>), <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb58-13"><a href="modeling-race-results.html#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>, <span class="fu">aes</span>(placing, discrete_prob_monaco, <span class="at">fill =</span> <span class="st">&#39;Monaco&#39;</span>), <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb58-14"><a href="modeling-race-results.html#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;Saudi Arabia&#39;</span> <span class="ot">=</span> <span class="st">&#39;green&#39;</span>, <span class="st">&#39;Monaco&#39;</span> <span class="ot">=</span> <span class="st">&#39;red&#39;</span>)) <span class="sc">+</span></span>
<span id="cb58-15"><a href="modeling-race-results.html#cb58-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;Saudi Arabia&#39;</span> <span class="ot">=</span> <span class="st">&#39;green&#39;</span>, <span class="st">&#39;Monaco&#39;</span> <span class="ot">=</span> <span class="st">&#39;red&#39;</span>)) <span class="sc">+</span></span>
<span id="cb58-16"><a href="modeling-race-results.html#cb58-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb58-17"><a href="modeling-race-results.html#cb58-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb58-18"><a href="modeling-race-results.html#cb58-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb58-19"><a href="modeling-race-results.html#cb58-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb58-20"><a href="modeling-race-results.html#cb58-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb58-21"><a href="modeling-race-results.html#cb58-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Saudia Arabia (2021 - 2023) vs Monaco (2014 - 2023)&#39;</span>) <span class="sc">+</span></span>
<span id="cb58-22"><a href="modeling-race-results.html#cb58-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb58-23"><a href="modeling-race-results.html#cb58-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-54-1.png" width="960" /></p>
<p>If we focus on the first 2 rows of the starting grid, we do see those cars have higher podium probabilities in Monaco. Is it easier to win in Jeddah from further down the grid?</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="modeling-race-results.html#cb59-1" aria-hidden="true" tabindex="-1"></a>saudiarabia_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="modeling-race-results.html#cb59-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(starting, placing, discrete_prob) <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="modeling-race-results.html#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(monaco_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb59-4"><a href="modeling-race-results.html#cb59-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(starting, placing, discrete_prob), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;starting&quot;</span>, <span class="st">&quot;placing&quot;</span>), <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_saudiarabia&quot;</span>, <span class="st">&quot;_monaco&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb59-5"><a href="modeling-race-results.html#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb59-6"><a href="modeling-race-results.html#cb59-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting),</span>
<span id="cb59-7"><a href="modeling-race-results.html#cb59-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">delta =</span> <span class="fu">ifelse</span>(discrete_prob_monaco <span class="sc">&gt;</span> discrete_prob_saudiarabia, <span class="st">&#39;monaco&#39;</span>, <span class="st">&#39;saudiarabia&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb59-8"><a href="modeling-race-results.html#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(placing <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb59-9"><a href="modeling-race-results.html#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb59-10"><a href="modeling-race-results.html#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> starting, <span class="at">xend =</span> starting, <span class="at">y =</span> discrete_prob_saudiarabia, <span class="at">yend =</span> discrete_prob_monaco, <span class="at">col =</span> delta),</span>
<span id="cb59-11"><a href="modeling-race-results.html#cb59-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb59-12"><a href="modeling-race-results.html#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>, <span class="fu">aes</span>(starting, discrete_prob_saudiarabia), <span class="at">fill =</span> <span class="st">&#39;green&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb59-13"><a href="modeling-race-results.html#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>, <span class="fu">aes</span>(starting, discrete_prob_monaco), <span class="at">fill =</span> <span class="st">&#39;red&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb59-14"><a href="modeling-race-results.html#cb59-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb59-15"><a href="modeling-race-results.html#cb59-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;Saudi Arabia&#39;</span> <span class="ot">=</span> <span class="st">&#39;green&#39;</span>, <span class="st">&#39;Monaco&#39;</span> <span class="ot">=</span> <span class="st">&#39;red&#39;</span>)) <span class="sc">+</span></span>
<span id="cb59-16"><a href="modeling-race-results.html#cb59-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb59-17"><a href="modeling-race-results.html#cb59-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability of a win&#39;</span>,</span>
<span id="cb59-18"><a href="modeling-race-results.html#cb59-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[<span class="dv">1</span>]),</span>
<span id="cb59-19"><a href="modeling-race-results.html#cb59-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Saudi Arabia (2021 - 2023) vs Monaco (2014 - 2023)&#39;</span>) <span class="sc">+</span></span>
<span id="cb59-20"><a href="modeling-race-results.html#cb59-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb59-21"><a href="modeling-race-results.html#cb59-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb59-22"><a href="modeling-race-results.html#cb59-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">20</span>, <span class="dv">1</span>),</span>
<span id="cb59-23"><a href="modeling-race-results.html#cb59-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">20</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-55-1.png" width="960" /></p>
<p>It looks like that is likely the case. Cars at the front of the grid are rewarded more in Monaco, while cars further back in Saudi Arabia have a slightly better chance of a win than they do in Monaco. It looks like there is just a much stronger advantage to starting at the front of the grid in Monaco.</p>
</div>
<div id="brazil" class="section level3 hasAnchor" number="6.4.4">
<h3><span class="header-section-number">6.4.4</span> Brazil<a href="modeling-race-results.html#brazil" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Sao Paulo Grand Prix is perhaps the easiest circuit to overtake on. Let’s compare the model predictions and probabilities for Brazil to those of Monaco.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="modeling-race-results.html#cb60-1" aria-hidden="true" tabindex="-1"></a>brazil_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb60-2"><a href="modeling-race-results.html#cb60-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb60-3"><a href="modeling-race-results.html#cb60-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="modeling-race-results.html#cb60-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;brazil&#39;</span>))</span></code></pre></div>
<p>As before, I’ll make predictions for the grid:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="modeling-race-results.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb61-2"><a href="modeling-race-results.html#cb61-2" aria-hidden="true" tabindex="-1"></a>predictions_brazil<span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(brazil_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb61-3"><a href="modeling-race-results.html#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="modeling-race-results.html#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb61-5"><a href="modeling-race-results.html#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(predictions_brazil) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span>
<span id="cb61-6"><a href="modeling-race-results.html#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="modeling-race-results.html#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb61-8"><a href="modeling-race-results.html#cb61-8" aria-hidden="true" tabindex="-1"></a>standard_errors_brazil <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(brazil_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb61-9"><a href="modeling-race-results.html#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="modeling-race-results.html#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb61-11"><a href="modeling-race-results.html#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(standard_errors_brazil) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span></code></pre></div>
<p>Now, I’ll compute the probability(P1 finish | a starting grid) in Brazil:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="modeling-race-results.html#cb62-1" aria-hidden="true" tabindex="-1"></a>starting_grid <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="modeling-race-results.html#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">pr_1 =</span> predictions_brazil<span class="sc">$</span>prob_1,</span>
<span id="cb62-3"><a href="modeling-race-results.html#cb62-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">se_1 =</span> standard_errors_brazil<span class="sc">$</span>se_1) <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="modeling-race-results.html#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr =</span> <span class="fu">exp</span>(pr_1),</span>
<span id="cb62-5"><a href="modeling-race-results.html#cb62-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower =</span> <span class="fu">exp</span>(pr_1 <span class="sc">-</span> se_1 <span class="sc">*</span> <span class="fl">1.96</span>),</span>
<span id="cb62-6"><a href="modeling-race-results.html#cb62-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper =</span> <span class="fu">exp</span>(pr_1 <span class="sc">+</span> se_1 <span class="sc">*</span> <span class="fl">1.96</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb62-7"><a href="modeling-race-results.html#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">pr =</span> pr <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> pr),</span>
<span id="cb62-8"><a href="modeling-race-results.html#cb62-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">lower =</span> lower <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> lower),</span>
<span id="cb62-9"><a href="modeling-race-results.html#cb62-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> upper <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> upper)) <span class="sc">%&gt;%</span></span>
<span id="cb62-10"><a href="modeling-race-results.html#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Position_grid, <span class="at">y =</span> pr, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb62-11"><a href="modeling-race-results.html#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span></span>
<span id="cb62-12"><a href="modeling-race-results.html#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb62-13"><a href="modeling-race-results.html#cb62-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">y =</span> <span class="st">&#39;Probability of finishing P1&#39;</span>,</span>
<span id="cb62-14"><a href="modeling-race-results.html#cb62-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">&#39;Starting Grid Position&#39;</span>,</span>
<span id="cb62-15"><a href="modeling-race-results.html#cb62-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&#39;Brazil&#39;</span>,</span>
<span id="cb62-16"><a href="modeling-race-results.html#cb62-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">&#39;2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb62-17"><a href="modeling-race-results.html#cb62-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb62-18"><a href="modeling-race-results.html#cb62-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-58-1.png" width="960" /></p>
<p>And, I’ll plot the discrete probability distributions here:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="modeling-race-results.html#cb63-1" aria-hidden="true" tabindex="-1"></a>brazil_preds_se_full <span class="ot">&lt;-</span> predictions_brazil <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="modeling-race-results.html#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="modeling-race-results.html#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-4"><a href="modeling-race-results.html#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(standard_errors_brazil <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb63-5"><a href="modeling-race-results.html#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-6"><a href="modeling-race-results.html#cb63-6" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb63-7"><a href="modeling-race-results.html#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb63-8"><a href="modeling-race-results.html#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb63-9"><a href="modeling-race-results.html#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb63-10"><a href="modeling-race-results.html#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb63-11"><a href="modeling-race-results.html#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb63-12"><a href="modeling-race-results.html#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb63-13"><a href="modeling-race-results.html#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="modeling-race-results.html#cb63-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-15"><a href="modeling-race-results.html#cb63-15" aria-hidden="true" tabindex="-1"></a>brazil_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb63-16"><a href="modeling-race-results.html#cb63-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb63-17"><a href="modeling-race-results.html#cb63-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb63-18"><a href="modeling-race-results.html#cb63-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb63-19"><a href="modeling-race-results.html#cb63-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb63-20"><a href="modeling-race-results.html#cb63-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;green&#39;</span>) <span class="sc">+</span></span>
<span id="cb63-21"><a href="modeling-race-results.html#cb63-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb63-22"><a href="modeling-race-results.html#cb63-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb63-23"><a href="modeling-race-results.html#cb63-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb63-24"><a href="modeling-race-results.html#cb63-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb63-25"><a href="modeling-race-results.html#cb63-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb63-26"><a href="modeling-race-results.html#cb63-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb63-27"><a href="modeling-race-results.html#cb63-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Sao Paulo Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb63-28"><a href="modeling-race-results.html#cb63-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb63-29"><a href="modeling-race-results.html#cb63-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-59-1.png" width="960" /></p>
<p>How does Brazil compare to Monaco? Notice in the plot below that the red dots (Monaco) demonstrate higher probabilities for podium placings if a driver starts on the first 2 rows of the grid, compared to the green dots (Brazil).</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="modeling-race-results.html#cb64-1" aria-hidden="true" tabindex="-1"></a>brazil_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="modeling-race-results.html#cb64-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(starting, placing, discrete_prob) <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="modeling-race-results.html#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(monaco_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="modeling-race-results.html#cb64-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(starting, placing, discrete_prob), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;starting&quot;</span>, <span class="st">&quot;placing&quot;</span>), <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_brazil&quot;</span>, <span class="st">&quot;_monaco&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="modeling-race-results.html#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb64-6"><a href="modeling-race-results.html#cb64-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting),</span>
<span id="cb64-7"><a href="modeling-race-results.html#cb64-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">delta =</span> <span class="fu">ifelse</span>(discrete_prob_monaco <span class="sc">&gt;</span> discrete_prob_brazil, <span class="st">&#39;monaco&#39;</span>, <span class="st">&#39;brazil&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-8"><a href="modeling-race-results.html#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(starting_pos <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;P1&#39;</span>, <span class="st">&#39;P2&#39;</span>, <span class="st">&#39;P3&#39;</span>, <span class="st">&#39;P4&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-9"><a href="modeling-race-results.html#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb64-10"><a href="modeling-race-results.html#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> discrete_prob_brazil, <span class="at">yend =</span> discrete_prob_monaco, <span class="at">col =</span> delta),</span>
<span id="cb64-11"><a href="modeling-race-results.html#cb64-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb64-12"><a href="modeling-race-results.html#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>, <span class="fu">aes</span>(placing, discrete_prob_brazil, <span class="at">fill =</span> <span class="st">&#39;Brazil&#39;</span>), <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb64-13"><a href="modeling-race-results.html#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>, <span class="fu">aes</span>(placing, discrete_prob_monaco, <span class="at">fill =</span> <span class="st">&#39;Monaco&#39;</span>), <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb64-14"><a href="modeling-race-results.html#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;Brazil&#39;</span> <span class="ot">=</span> <span class="st">&#39;green&#39;</span>, <span class="st">&#39;Monaco&#39;</span> <span class="ot">=</span> <span class="st">&#39;red&#39;</span>)) <span class="sc">+</span></span>
<span id="cb64-15"><a href="modeling-race-results.html#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;Brazil&#39;</span> <span class="ot">=</span> <span class="st">&#39;green&#39;</span>, <span class="st">&#39;Monaco&#39;</span> <span class="ot">=</span> <span class="st">&#39;red&#39;</span>)) <span class="sc">+</span></span>
<span id="cb64-16"><a href="modeling-race-results.html#cb64-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb64-17"><a href="modeling-race-results.html#cb64-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb64-18"><a href="modeling-race-results.html#cb64-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb64-19"><a href="modeling-race-results.html#cb64-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb64-20"><a href="modeling-race-results.html#cb64-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb64-21"><a href="modeling-race-results.html#cb64-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">title_color_coder</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;Sao Paulo&quot;</span>, <span class="st">&#39;green&#39;</span>, <span class="st">&quot; vs &quot;</span>, <span class="st">&quot;Monaco&quot;</span>, <span class="st">&#39;red&#39;</span> ,<span class="st">&quot;: 2014 - 2023&quot;</span>)) <span class="sc">+</span></span>
<span id="cb64-22"><a href="modeling-race-results.html#cb64-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb64-23"><a href="modeling-race-results.html#cb64-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> ggtext<span class="sc">::</span><span class="fu">element_markdown</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-60-1.png" width="960" /></p>
<p>We can also compare the probability of finishing P1 given any starting grid position between these two Grands Prix.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="modeling-race-results.html#cb65-1" aria-hidden="true" tabindex="-1"></a>brazil_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="modeling-race-results.html#cb65-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(starting, placing, discrete_prob) <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="modeling-race-results.html#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(monaco_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="modeling-race-results.html#cb65-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(starting, placing, discrete_prob), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;starting&quot;</span>, <span class="st">&quot;placing&quot;</span>), <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_brazil&quot;</span>, <span class="st">&quot;_monaco&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-5"><a href="modeling-race-results.html#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb65-6"><a href="modeling-race-results.html#cb65-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting),</span>
<span id="cb65-7"><a href="modeling-race-results.html#cb65-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">delta =</span> <span class="fu">ifelse</span>(discrete_prob_monaco <span class="sc">&gt;</span> discrete_prob_brazil, <span class="st">&#39;monaco&#39;</span>, <span class="st">&#39;brazil&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-8"><a href="modeling-race-results.html#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(placing <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-9"><a href="modeling-race-results.html#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb65-10"><a href="modeling-race-results.html#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> starting, <span class="at">xend =</span> starting, <span class="at">y =</span> discrete_prob_brazil, <span class="at">yend =</span> discrete_prob_monaco, <span class="at">col =</span> delta),</span>
<span id="cb65-11"><a href="modeling-race-results.html#cb65-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb65-12"><a href="modeling-race-results.html#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>, <span class="fu">aes</span>(starting, discrete_prob_brazil), <span class="at">fill =</span> <span class="st">&#39;green&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb65-13"><a href="modeling-race-results.html#cb65-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>, <span class="fu">aes</span>(starting, discrete_prob_monaco), <span class="at">fill =</span> <span class="st">&#39;red&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb65-14"><a href="modeling-race-results.html#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb65-15"><a href="modeling-race-results.html#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;Brazil&#39;</span> <span class="ot">=</span> <span class="st">&#39;green&#39;</span>, <span class="st">&#39;Monaco&#39;</span> <span class="ot">=</span> <span class="st">&#39;red&#39;</span>)) <span class="sc">+</span></span>
<span id="cb65-16"><a href="modeling-race-results.html#cb65-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Starting Position&#39;</span>,</span>
<span id="cb65-17"><a href="modeling-race-results.html#cb65-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability of a race win&#39;</span>,</span>
<span id="cb65-18"><a href="modeling-race-results.html#cb65-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[<span class="dv">1</span>]),</span>
<span id="cb65-19"><a href="modeling-race-results.html#cb65-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">title_color_coder</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;Sao Paulo&quot;</span>, <span class="st">&#39;green&#39;</span>, <span class="st">&quot; vs &quot;</span>, <span class="st">&quot;Monaco&quot;</span>, <span class="st">&#39;red&#39;</span> ,<span class="st">&quot;: 2014 - 2023&quot;</span>)) <span class="sc">+</span></span>
<span id="cb65-20"><a href="modeling-race-results.html#cb65-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb65-21"><a href="modeling-race-results.html#cb65-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> ggtext<span class="sc">::</span><span class="fu">element_markdown</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-61-1.png" width="960" /></p>
<p>Relative to Brazil, there seems to be a distinct advantage in starting the Monaco Grand Prix from the front row. For example, starting from P1 at Monaco carries an approximately 33% chance of winning, while pole position in Brazil results in just a 26% win probability. Compared to Monaco, a driver has a higher likelihood of winning from any other row on the gird at the Sao Paulo Grand Prix.</p>
<p>Stated plainly… Qualifying on the front row in Monaco is very important! In Sao Paulo, a driver can make up positions.</p>
</div>
</div>
<div id="appendix-probability-distributions-for-every-grand-prix" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Appendix: Probability distributions for every Grand Prix<a href="modeling-race-results.html#appendix-probability-distributions-for-every-grand-prix" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In case you are interested in any particular circuit, I will build a model and plot results for each Grand Prix on the schedule using data from 2014 through 2023 (or whatever is available).</p>
<div id="bahrain-1" class="section level3 hasAnchor" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Bahrain<a href="modeling-race-results.html#bahrain-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="modeling-race-results.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These predictions were generated earlier in the chapter</span></span>
<span id="cb66-2"><a href="modeling-race-results.html#cb66-2" aria-hidden="true" tabindex="-1"></a>bahrain_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="modeling-race-results.html#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb66-4"><a href="modeling-race-results.html#cb66-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb66-5"><a href="modeling-race-results.html#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb66-6"><a href="modeling-race-results.html#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb66-7"><a href="modeling-race-results.html#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb66-8"><a href="modeling-race-results.html#cb66-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">col =</span> <span class="st">&#39;maroon&#39;</span>) <span class="sc">+</span></span>
<span id="cb66-9"><a href="modeling-race-results.html#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb66-10"><a href="modeling-race-results.html#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb66-11"><a href="modeling-race-results.html#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb66-12"><a href="modeling-race-results.html#cb66-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb66-13"><a href="modeling-race-results.html#cb66-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb66-14"><a href="modeling-race-results.html#cb66-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Bahrain Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb66-15"><a href="modeling-race-results.html#cb66-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb66-16"><a href="modeling-race-results.html#cb66-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb66-17"><a href="modeling-race-results.html#cb66-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">18</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">18</span>)) <span class="sc">+</span></span>
<span id="cb66-18"><a href="modeling-race-results.html#cb66-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb66-19"><a href="modeling-race-results.html#cb66-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb66-20"><a href="modeling-race-results.html#cb66-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-62-1.png" width="960" /></p>
</div>
<div id="saudi-arabia-1" class="section level3 hasAnchor" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> Saudi Arabia<a href="modeling-race-results.html#saudi-arabia-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="modeling-race-results.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These predictions were generated earlier in the chapter</span></span>
<span id="cb67-2"><a href="modeling-race-results.html#cb67-2" aria-hidden="true" tabindex="-1"></a>saudiarabia_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="modeling-race-results.html#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb67-4"><a href="modeling-race-results.html#cb67-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb67-5"><a href="modeling-race-results.html#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb67-6"><a href="modeling-race-results.html#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb67-7"><a href="modeling-race-results.html#cb67-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">col =</span> <span class="st">&#39;darkgreen&#39;</span>) <span class="sc">+</span></span>
<span id="cb67-8"><a href="modeling-race-results.html#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb67-9"><a href="modeling-race-results.html#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb67-10"><a href="modeling-race-results.html#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb67-11"><a href="modeling-race-results.html#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb67-12"><a href="modeling-race-results.html#cb67-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb67-13"><a href="modeling-race-results.html#cb67-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb67-14"><a href="modeling-race-results.html#cb67-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Saudi Arabian Grand Prix: 2021 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb67-15"><a href="modeling-race-results.html#cb67-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb67-16"><a href="modeling-race-results.html#cb67-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb67-17"><a href="modeling-race-results.html#cb67-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">18</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">15</span>, <span class="dv">18</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-63-1.png" width="960" /></p>
</div>
<div id="australia" class="section level3 hasAnchor" number="6.5.3">
<h3><span class="header-section-number">6.5.3</span> Australia<a href="modeling-race-results.html#australia" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="modeling-race-results.html#cb68-1" aria-hidden="true" tabindex="-1"></a>australia_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb68-2"><a href="modeling-race-results.html#cb68-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb68-3"><a href="modeling-race-results.html#cb68-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a href="modeling-race-results.html#cb68-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;australia&#39;</span>))</span>
<span id="cb68-5"><a href="modeling-race-results.html#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="modeling-race-results.html#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb68-7"><a href="modeling-race-results.html#cb68-7" aria-hidden="true" tabindex="-1"></a>australia_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(australia_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb68-8"><a href="modeling-race-results.html#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="modeling-race-results.html#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb68-10"><a href="modeling-race-results.html#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(australia_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>]</span>
<span id="cb68-11"><a href="modeling-race-results.html#cb68-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-12"><a href="modeling-race-results.html#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb68-13"><a href="modeling-race-results.html#cb68-13" aria-hidden="true" tabindex="-1"></a>australia_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(australia_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb68-14"><a href="modeling-race-results.html#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="modeling-race-results.html#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb68-16"><a href="modeling-race-results.html#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(australia_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>]</span>
<span id="cb68-17"><a href="modeling-race-results.html#cb68-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-18"><a href="modeling-race-results.html#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb68-19"><a href="modeling-race-results.html#cb68-19" aria-hidden="true" tabindex="-1"></a>australia_preds_se_full <span class="ot">&lt;-</span> australia_predictions <span class="sc">%&gt;%</span></span>
<span id="cb68-20"><a href="modeling-race-results.html#cb68-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb68-21"><a href="modeling-race-results.html#cb68-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb68-22"><a href="modeling-race-results.html#cb68-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(australia_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb68-23"><a href="modeling-race-results.html#cb68-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-24"><a href="modeling-race-results.html#cb68-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb68-25"><a href="modeling-race-results.html#cb68-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb68-26"><a href="modeling-race-results.html#cb68-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb68-27"><a href="modeling-race-results.html#cb68-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb68-28"><a href="modeling-race-results.html#cb68-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb68-29"><a href="modeling-race-results.html#cb68-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb68-30"><a href="modeling-race-results.html#cb68-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb68-31"><a href="modeling-race-results.html#cb68-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-32"><a href="modeling-race-results.html#cb68-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb68-33"><a href="modeling-race-results.html#cb68-33" aria-hidden="true" tabindex="-1"></a>australia_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb68-34"><a href="modeling-race-results.html#cb68-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb68-35"><a href="modeling-race-results.html#cb68-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb68-36"><a href="modeling-race-results.html#cb68-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb68-37"><a href="modeling-race-results.html#cb68-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb68-38"><a href="modeling-race-results.html#cb68-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb68-39"><a href="modeling-race-results.html#cb68-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;navy&#39;</span>) <span class="sc">+</span></span>
<span id="cb68-40"><a href="modeling-race-results.html#cb68-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb68-41"><a href="modeling-race-results.html#cb68-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb68-42"><a href="modeling-race-results.html#cb68-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb68-43"><a href="modeling-race-results.html#cb68-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb68-44"><a href="modeling-race-results.html#cb68-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb68-45"><a href="modeling-race-results.html#cb68-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Australian Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb68-46"><a href="modeling-race-results.html#cb68-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb68-47"><a href="modeling-race-results.html#cb68-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-64-1.png" width="960" /></p>
</div>
<div id="azerbaijan" class="section level3 hasAnchor" number="6.5.4">
<h3><span class="header-section-number">6.5.4</span> Azerbaijan<a href="modeling-race-results.html#azerbaijan" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="modeling-race-results.html#cb69-1" aria-hidden="true" tabindex="-1"></a>azerbaijan_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb69-2"><a href="modeling-race-results.html#cb69-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb69-3"><a href="modeling-race-results.html#cb69-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="modeling-race-results.html#cb69-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;azerbaijan&#39;</span>))</span>
<span id="cb69-5"><a href="modeling-race-results.html#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="modeling-race-results.html#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb69-7"><a href="modeling-race-results.html#cb69-7" aria-hidden="true" tabindex="-1"></a>azerbaijan_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(azerbaijan_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb69-8"><a href="modeling-race-results.html#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="modeling-race-results.html#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb69-10"><a href="modeling-race-results.html#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(azerbaijan_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>]</span>
<span id="cb69-11"><a href="modeling-race-results.html#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="modeling-race-results.html#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb69-13"><a href="modeling-race-results.html#cb69-13" aria-hidden="true" tabindex="-1"></a>azerbaijan_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(azerbaijan_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb69-14"><a href="modeling-race-results.html#cb69-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-15"><a href="modeling-race-results.html#cb69-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb69-16"><a href="modeling-race-results.html#cb69-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(azerbaijan_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>]</span>
<span id="cb69-17"><a href="modeling-race-results.html#cb69-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-18"><a href="modeling-race-results.html#cb69-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb69-19"><a href="modeling-race-results.html#cb69-19" aria-hidden="true" tabindex="-1"></a>azerbaijan_preds_se_full <span class="ot">&lt;-</span> azerbaijan_predictions <span class="sc">%&gt;%</span></span>
<span id="cb69-20"><a href="modeling-race-results.html#cb69-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb69-21"><a href="modeling-race-results.html#cb69-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb69-22"><a href="modeling-race-results.html#cb69-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(azerbaijan_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb69-23"><a href="modeling-race-results.html#cb69-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-24"><a href="modeling-race-results.html#cb69-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb69-25"><a href="modeling-race-results.html#cb69-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb69-26"><a href="modeling-race-results.html#cb69-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb69-27"><a href="modeling-race-results.html#cb69-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb69-28"><a href="modeling-race-results.html#cb69-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb69-29"><a href="modeling-race-results.html#cb69-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb69-30"><a href="modeling-race-results.html#cb69-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb69-31"><a href="modeling-race-results.html#cb69-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-32"><a href="modeling-race-results.html#cb69-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb69-33"><a href="modeling-race-results.html#cb69-33" aria-hidden="true" tabindex="-1"></a>azerbaijan_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb69-34"><a href="modeling-race-results.html#cb69-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb69-35"><a href="modeling-race-results.html#cb69-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb69-36"><a href="modeling-race-results.html#cb69-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb69-37"><a href="modeling-race-results.html#cb69-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb69-38"><a href="modeling-race-results.html#cb69-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb69-39"><a href="modeling-race-results.html#cb69-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;darkgreen&#39;</span>) <span class="sc">+</span></span>
<span id="cb69-40"><a href="modeling-race-results.html#cb69-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb69-41"><a href="modeling-race-results.html#cb69-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb69-42"><a href="modeling-race-results.html#cb69-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb69-43"><a href="modeling-race-results.html#cb69-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb69-44"><a href="modeling-race-results.html#cb69-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb69-45"><a href="modeling-race-results.html#cb69-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Azerbaijan Grand Prix: 2017 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb69-46"><a href="modeling-race-results.html#cb69-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb69-47"><a href="modeling-race-results.html#cb69-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-65-1.png" width="960" /></p>
</div>
<div id="miami" class="section level3 hasAnchor" number="6.5.5">
<h3><span class="header-section-number">6.5.5</span> Miami<a href="modeling-race-results.html#miami" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="modeling-race-results.html#cb70-1" aria-hidden="true" tabindex="-1"></a>miami_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb70-2"><a href="modeling-race-results.html#cb70-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb70-3"><a href="modeling-race-results.html#cb70-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb70-4"><a href="modeling-race-results.html#cb70-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;miami&#39;</span>))</span>
<span id="cb70-5"><a href="modeling-race-results.html#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="modeling-race-results.html#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb70-7"><a href="modeling-race-results.html#cb70-7" aria-hidden="true" tabindex="-1"></a>miami_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(miami_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb70-8"><a href="modeling-race-results.html#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="modeling-race-results.html#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb70-10"><a href="modeling-race-results.html#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(miami_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb70-11"><a href="modeling-race-results.html#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="modeling-race-results.html#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb70-13"><a href="modeling-race-results.html#cb70-13" aria-hidden="true" tabindex="-1"></a>miami_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(miami_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb70-14"><a href="modeling-race-results.html#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="modeling-race-results.html#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb70-16"><a href="modeling-race-results.html#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(miami_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb70-17"><a href="modeling-race-results.html#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="modeling-race-results.html#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb70-19"><a href="modeling-race-results.html#cb70-19" aria-hidden="true" tabindex="-1"></a>miami_preds_se_full <span class="ot">&lt;-</span> miami_predictions <span class="sc">%&gt;%</span></span>
<span id="cb70-20"><a href="modeling-race-results.html#cb70-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb70-21"><a href="modeling-race-results.html#cb70-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb70-22"><a href="modeling-race-results.html#cb70-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(miami_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb70-23"><a href="modeling-race-results.html#cb70-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-24"><a href="modeling-race-results.html#cb70-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb70-25"><a href="modeling-race-results.html#cb70-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb70-26"><a href="modeling-race-results.html#cb70-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb70-27"><a href="modeling-race-results.html#cb70-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb70-28"><a href="modeling-race-results.html#cb70-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb70-29"><a href="modeling-race-results.html#cb70-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb70-30"><a href="modeling-race-results.html#cb70-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb70-31"><a href="modeling-race-results.html#cb70-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-32"><a href="modeling-race-results.html#cb70-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb70-33"><a href="modeling-race-results.html#cb70-33" aria-hidden="true" tabindex="-1"></a>miami_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb70-34"><a href="modeling-race-results.html#cb70-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb70-35"><a href="modeling-race-results.html#cb70-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb70-36"><a href="modeling-race-results.html#cb70-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb70-37"><a href="modeling-race-results.html#cb70-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb70-38"><a href="modeling-race-results.html#cb70-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb70-39"><a href="modeling-race-results.html#cb70-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;darkorange&#39;</span>) <span class="sc">+</span></span>
<span id="cb70-40"><a href="modeling-race-results.html#cb70-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb70-41"><a href="modeling-race-results.html#cb70-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb70-42"><a href="modeling-race-results.html#cb70-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb70-43"><a href="modeling-race-results.html#cb70-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb70-44"><a href="modeling-race-results.html#cb70-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb70-45"><a href="modeling-race-results.html#cb70-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Miami Grand Prix: 2022 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb70-46"><a href="modeling-race-results.html#cb70-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb70-47"><a href="modeling-race-results.html#cb70-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-66-1.png" width="960" /></p>
</div>
<div id="emilia-romagna" class="section level3 hasAnchor" number="6.5.6">
<h3><span class="header-section-number">6.5.6</span> Emilia Romagna<a href="modeling-race-results.html#emilia-romagna" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="modeling-race-results.html#cb71-1" aria-hidden="true" tabindex="-1"></a>emilia_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb71-2"><a href="modeling-race-results.html#cb71-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb71-3"><a href="modeling-race-results.html#cb71-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="modeling-race-results.html#cb71-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;emilia&#39;</span>))</span>
<span id="cb71-5"><a href="modeling-race-results.html#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="modeling-race-results.html#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb71-7"><a href="modeling-race-results.html#cb71-7" aria-hidden="true" tabindex="-1"></a>emilia_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(emilia_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb71-8"><a href="modeling-race-results.html#cb71-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-9"><a href="modeling-race-results.html#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb71-10"><a href="modeling-race-results.html#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(emilia_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>]</span>
<span id="cb71-11"><a href="modeling-race-results.html#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="modeling-race-results.html#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb71-13"><a href="modeling-race-results.html#cb71-13" aria-hidden="true" tabindex="-1"></a>emilia_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(emilia_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb71-14"><a href="modeling-race-results.html#cb71-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-15"><a href="modeling-race-results.html#cb71-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb71-16"><a href="modeling-race-results.html#cb71-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(emilia_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>]</span>
<span id="cb71-17"><a href="modeling-race-results.html#cb71-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-18"><a href="modeling-race-results.html#cb71-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb71-19"><a href="modeling-race-results.html#cb71-19" aria-hidden="true" tabindex="-1"></a>emilia_preds_se_full <span class="ot">&lt;-</span> emilia_predictions <span class="sc">%&gt;%</span></span>
<span id="cb71-20"><a href="modeling-race-results.html#cb71-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb71-21"><a href="modeling-race-results.html#cb71-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb71-22"><a href="modeling-race-results.html#cb71-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(emilia_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb71-23"><a href="modeling-race-results.html#cb71-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-24"><a href="modeling-race-results.html#cb71-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb71-25"><a href="modeling-race-results.html#cb71-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb71-26"><a href="modeling-race-results.html#cb71-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb71-27"><a href="modeling-race-results.html#cb71-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb71-28"><a href="modeling-race-results.html#cb71-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb71-29"><a href="modeling-race-results.html#cb71-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb71-30"><a href="modeling-race-results.html#cb71-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb71-31"><a href="modeling-race-results.html#cb71-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-32"><a href="modeling-race-results.html#cb71-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb71-33"><a href="modeling-race-results.html#cb71-33" aria-hidden="true" tabindex="-1"></a>emilia_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb71-34"><a href="modeling-race-results.html#cb71-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb71-35"><a href="modeling-race-results.html#cb71-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb71-36"><a href="modeling-race-results.html#cb71-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb71-37"><a href="modeling-race-results.html#cb71-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb71-38"><a href="modeling-race-results.html#cb71-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb71-39"><a href="modeling-race-results.html#cb71-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>) <span class="sc">+</span></span>
<span id="cb71-40"><a href="modeling-race-results.html#cb71-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb71-41"><a href="modeling-race-results.html#cb71-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb71-42"><a href="modeling-race-results.html#cb71-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb71-43"><a href="modeling-race-results.html#cb71-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb71-44"><a href="modeling-race-results.html#cb71-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb71-45"><a href="modeling-race-results.html#cb71-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Emilia Romagna Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb71-46"><a href="modeling-race-results.html#cb71-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb71-47"><a href="modeling-race-results.html#cb71-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-67-1.png" width="960" /></p>
</div>
<div id="monaco-1" class="section level3 hasAnchor" number="6.5.7">
<h3><span class="header-section-number">6.5.7</span> Monaco<a href="modeling-race-results.html#monaco-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="modeling-race-results.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These predictions were generated earlier in the chapter</span></span>
<span id="cb72-2"><a href="modeling-race-results.html#cb72-2" aria-hidden="true" tabindex="-1"></a>monaco_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="modeling-race-results.html#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb72-4"><a href="modeling-race-results.html#cb72-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb72-5"><a href="modeling-race-results.html#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb72-6"><a href="modeling-race-results.html#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb72-7"><a href="modeling-race-results.html#cb72-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>) <span class="sc">+</span></span>
<span id="cb72-8"><a href="modeling-race-results.html#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb72-9"><a href="modeling-race-results.html#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb72-10"><a href="modeling-race-results.html#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb72-11"><a href="modeling-race-results.html#cb72-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb72-12"><a href="modeling-race-results.html#cb72-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb72-13"><a href="modeling-race-results.html#cb72-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb72-14"><a href="modeling-race-results.html#cb72-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Monaco Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb72-15"><a href="modeling-race-results.html#cb72-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb72-16"><a href="modeling-race-results.html#cb72-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-68-1.png" width="960" /></p>
</div>
<div id="spain" class="section level3 hasAnchor" number="6.5.8">
<h3><span class="header-section-number">6.5.8</span> Spain<a href="modeling-race-results.html#spain" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="modeling-race-results.html#cb73-1" aria-hidden="true" tabindex="-1"></a>spain_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb73-2"><a href="modeling-race-results.html#cb73-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb73-3"><a href="modeling-race-results.html#cb73-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb73-4"><a href="modeling-race-results.html#cb73-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;spain&#39;</span>))</span>
<span id="cb73-5"><a href="modeling-race-results.html#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="modeling-race-results.html#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb73-7"><a href="modeling-race-results.html#cb73-7" aria-hidden="true" tabindex="-1"></a>spain_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(spain_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb73-8"><a href="modeling-race-results.html#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="modeling-race-results.html#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb73-10"><a href="modeling-race-results.html#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(spain_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb73-11"><a href="modeling-race-results.html#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="modeling-race-results.html#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb73-13"><a href="modeling-race-results.html#cb73-13" aria-hidden="true" tabindex="-1"></a>spain_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(spain_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb73-14"><a href="modeling-race-results.html#cb73-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-15"><a href="modeling-race-results.html#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb73-16"><a href="modeling-race-results.html#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(spain_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb73-17"><a href="modeling-race-results.html#cb73-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-18"><a href="modeling-race-results.html#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb73-19"><a href="modeling-race-results.html#cb73-19" aria-hidden="true" tabindex="-1"></a>spain_preds_se_full <span class="ot">&lt;-</span> spain_predictions <span class="sc">%&gt;%</span></span>
<span id="cb73-20"><a href="modeling-race-results.html#cb73-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb73-21"><a href="modeling-race-results.html#cb73-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb73-22"><a href="modeling-race-results.html#cb73-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(spain_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb73-23"><a href="modeling-race-results.html#cb73-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-24"><a href="modeling-race-results.html#cb73-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb73-25"><a href="modeling-race-results.html#cb73-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb73-26"><a href="modeling-race-results.html#cb73-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb73-27"><a href="modeling-race-results.html#cb73-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb73-28"><a href="modeling-race-results.html#cb73-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb73-29"><a href="modeling-race-results.html#cb73-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb73-30"><a href="modeling-race-results.html#cb73-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb73-31"><a href="modeling-race-results.html#cb73-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-32"><a href="modeling-race-results.html#cb73-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb73-33"><a href="modeling-race-results.html#cb73-33" aria-hidden="true" tabindex="-1"></a>spain_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb73-34"><a href="modeling-race-results.html#cb73-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb73-35"><a href="modeling-race-results.html#cb73-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb73-36"><a href="modeling-race-results.html#cb73-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb73-37"><a href="modeling-race-results.html#cb73-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb73-38"><a href="modeling-race-results.html#cb73-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb73-39"><a href="modeling-race-results.html#cb73-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;darkred&#39;</span>) <span class="sc">+</span></span>
<span id="cb73-40"><a href="modeling-race-results.html#cb73-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb73-41"><a href="modeling-race-results.html#cb73-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb73-42"><a href="modeling-race-results.html#cb73-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb73-43"><a href="modeling-race-results.html#cb73-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb73-44"><a href="modeling-race-results.html#cb73-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb73-45"><a href="modeling-race-results.html#cb73-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Spanish Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb73-46"><a href="modeling-race-results.html#cb73-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb73-47"><a href="modeling-race-results.html#cb73-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-69-1.png" width="960" /></p>
</div>
<div id="canada" class="section level3 hasAnchor" number="6.5.9">
<h3><span class="header-section-number">6.5.9</span> Canada<a href="modeling-race-results.html#canada" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="modeling-race-results.html#cb74-1" aria-hidden="true" tabindex="-1"></a>canada_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb74-2"><a href="modeling-race-results.html#cb74-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb74-3"><a href="modeling-race-results.html#cb74-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="modeling-race-results.html#cb74-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;canada&#39;</span>))</span>
<span id="cb74-5"><a href="modeling-race-results.html#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="modeling-race-results.html#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb74-7"><a href="modeling-race-results.html#cb74-7" aria-hidden="true" tabindex="-1"></a>canada_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(canada_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb74-8"><a href="modeling-race-results.html#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="modeling-race-results.html#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb74-10"><a href="modeling-race-results.html#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(canada_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span>
<span id="cb74-11"><a href="modeling-race-results.html#cb74-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-12"><a href="modeling-race-results.html#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb74-13"><a href="modeling-race-results.html#cb74-13" aria-hidden="true" tabindex="-1"></a>canada_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(canada_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb74-14"><a href="modeling-race-results.html#cb74-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-15"><a href="modeling-race-results.html#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb74-16"><a href="modeling-race-results.html#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(canada_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span>
<span id="cb74-17"><a href="modeling-race-results.html#cb74-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-18"><a href="modeling-race-results.html#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb74-19"><a href="modeling-race-results.html#cb74-19" aria-hidden="true" tabindex="-1"></a>canada_preds_se_full <span class="ot">&lt;-</span> canada_predictions <span class="sc">%&gt;%</span></span>
<span id="cb74-20"><a href="modeling-race-results.html#cb74-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb74-21"><a href="modeling-race-results.html#cb74-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-22"><a href="modeling-race-results.html#cb74-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(canada_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb74-23"><a href="modeling-race-results.html#cb74-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-24"><a href="modeling-race-results.html#cb74-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb74-25"><a href="modeling-race-results.html#cb74-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb74-26"><a href="modeling-race-results.html#cb74-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb74-27"><a href="modeling-race-results.html#cb74-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb74-28"><a href="modeling-race-results.html#cb74-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb74-29"><a href="modeling-race-results.html#cb74-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb74-30"><a href="modeling-race-results.html#cb74-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb74-31"><a href="modeling-race-results.html#cb74-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-32"><a href="modeling-race-results.html#cb74-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb74-33"><a href="modeling-race-results.html#cb74-33" aria-hidden="true" tabindex="-1"></a>canada_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb74-34"><a href="modeling-race-results.html#cb74-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb74-35"><a href="modeling-race-results.html#cb74-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb74-36"><a href="modeling-race-results.html#cb74-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb74-37"><a href="modeling-race-results.html#cb74-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb74-38"><a href="modeling-race-results.html#cb74-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb74-39"><a href="modeling-race-results.html#cb74-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>) <span class="sc">+</span></span>
<span id="cb74-40"><a href="modeling-race-results.html#cb74-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb74-41"><a href="modeling-race-results.html#cb74-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb74-42"><a href="modeling-race-results.html#cb74-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb74-43"><a href="modeling-race-results.html#cb74-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb74-44"><a href="modeling-race-results.html#cb74-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb74-45"><a href="modeling-race-results.html#cb74-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Canadian Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb74-46"><a href="modeling-race-results.html#cb74-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb74-47"><a href="modeling-race-results.html#cb74-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-70-1.png" width="960" /></p>
</div>
<div id="austria" class="section level3 hasAnchor" number="6.5.10">
<h3><span class="header-section-number">6.5.10</span> Austria<a href="modeling-race-results.html#austria" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="modeling-race-results.html#cb75-1" aria-hidden="true" tabindex="-1"></a>austria_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb75-2"><a href="modeling-race-results.html#cb75-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb75-3"><a href="modeling-race-results.html#cb75-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="modeling-race-results.html#cb75-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;austria&#39;</span>))</span>
<span id="cb75-5"><a href="modeling-race-results.html#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="modeling-race-results.html#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb75-7"><a href="modeling-race-results.html#cb75-7" aria-hidden="true" tabindex="-1"></a>austria_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(austria_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb75-8"><a href="modeling-race-results.html#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="modeling-race-results.html#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb75-10"><a href="modeling-race-results.html#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(austria_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb75-11"><a href="modeling-race-results.html#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="modeling-race-results.html#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb75-13"><a href="modeling-race-results.html#cb75-13" aria-hidden="true" tabindex="-1"></a>austria_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(austria_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb75-14"><a href="modeling-race-results.html#cb75-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-15"><a href="modeling-race-results.html#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb75-16"><a href="modeling-race-results.html#cb75-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(austria_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb75-17"><a href="modeling-race-results.html#cb75-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-18"><a href="modeling-race-results.html#cb75-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb75-19"><a href="modeling-race-results.html#cb75-19" aria-hidden="true" tabindex="-1"></a>austria_preds_se_full <span class="ot">&lt;-</span> austria_predictions <span class="sc">%&gt;%</span></span>
<span id="cb75-20"><a href="modeling-race-results.html#cb75-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb75-21"><a href="modeling-race-results.html#cb75-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-22"><a href="modeling-race-results.html#cb75-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(austria_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb75-23"><a href="modeling-race-results.html#cb75-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-24"><a href="modeling-race-results.html#cb75-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb75-25"><a href="modeling-race-results.html#cb75-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb75-26"><a href="modeling-race-results.html#cb75-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb75-27"><a href="modeling-race-results.html#cb75-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb75-28"><a href="modeling-race-results.html#cb75-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb75-29"><a href="modeling-race-results.html#cb75-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb75-30"><a href="modeling-race-results.html#cb75-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-31"><a href="modeling-race-results.html#cb75-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-32"><a href="modeling-race-results.html#cb75-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb75-33"><a href="modeling-race-results.html#cb75-33" aria-hidden="true" tabindex="-1"></a>austria_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb75-34"><a href="modeling-race-results.html#cb75-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb75-35"><a href="modeling-race-results.html#cb75-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb75-36"><a href="modeling-race-results.html#cb75-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb75-37"><a href="modeling-race-results.html#cb75-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb75-38"><a href="modeling-race-results.html#cb75-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb75-39"><a href="modeling-race-results.html#cb75-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;darkred&#39;</span>) <span class="sc">+</span></span>
<span id="cb75-40"><a href="modeling-race-results.html#cb75-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb75-41"><a href="modeling-race-results.html#cb75-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb75-42"><a href="modeling-race-results.html#cb75-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb75-43"><a href="modeling-race-results.html#cb75-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb75-44"><a href="modeling-race-results.html#cb75-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb75-45"><a href="modeling-race-results.html#cb75-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Austrian Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb75-46"><a href="modeling-race-results.html#cb75-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb75-47"><a href="modeling-race-results.html#cb75-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-71-1.png" width="960" /></p>
</div>
<div id="great-britain" class="section level3 hasAnchor" number="6.5.11">
<h3><span class="header-section-number">6.5.11</span> Great Britain<a href="modeling-race-results.html#great-britain" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="modeling-race-results.html#cb76-1" aria-hidden="true" tabindex="-1"></a>british_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb76-2"><a href="modeling-race-results.html#cb76-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb76-3"><a href="modeling-race-results.html#cb76-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb76-4"><a href="modeling-race-results.html#cb76-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;great-britain&#39;</span>))</span>
<span id="cb76-5"><a href="modeling-race-results.html#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="modeling-race-results.html#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb76-7"><a href="modeling-race-results.html#cb76-7" aria-hidden="true" tabindex="-1"></a>british_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(british_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb76-8"><a href="modeling-race-results.html#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="modeling-race-results.html#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb76-10"><a href="modeling-race-results.html#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(british_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>]</span>
<span id="cb76-11"><a href="modeling-race-results.html#cb76-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-12"><a href="modeling-race-results.html#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb76-13"><a href="modeling-race-results.html#cb76-13" aria-hidden="true" tabindex="-1"></a>british_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(british_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb76-14"><a href="modeling-race-results.html#cb76-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-15"><a href="modeling-race-results.html#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb76-16"><a href="modeling-race-results.html#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(british_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>]</span>
<span id="cb76-17"><a href="modeling-race-results.html#cb76-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-18"><a href="modeling-race-results.html#cb76-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb76-19"><a href="modeling-race-results.html#cb76-19" aria-hidden="true" tabindex="-1"></a>british_preds_se_full <span class="ot">&lt;-</span> british_predictions <span class="sc">%&gt;%</span></span>
<span id="cb76-20"><a href="modeling-race-results.html#cb76-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb76-21"><a href="modeling-race-results.html#cb76-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-22"><a href="modeling-race-results.html#cb76-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(british_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb76-23"><a href="modeling-race-results.html#cb76-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-24"><a href="modeling-race-results.html#cb76-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb76-25"><a href="modeling-race-results.html#cb76-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb76-26"><a href="modeling-race-results.html#cb76-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb76-27"><a href="modeling-race-results.html#cb76-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb76-28"><a href="modeling-race-results.html#cb76-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb76-29"><a href="modeling-race-results.html#cb76-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb76-30"><a href="modeling-race-results.html#cb76-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb76-31"><a href="modeling-race-results.html#cb76-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-32"><a href="modeling-race-results.html#cb76-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb76-33"><a href="modeling-race-results.html#cb76-33" aria-hidden="true" tabindex="-1"></a>british_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb76-34"><a href="modeling-race-results.html#cb76-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb76-35"><a href="modeling-race-results.html#cb76-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb76-36"><a href="modeling-race-results.html#cb76-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb76-37"><a href="modeling-race-results.html#cb76-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb76-38"><a href="modeling-race-results.html#cb76-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb76-39"><a href="modeling-race-results.html#cb76-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;navy&#39;</span>) <span class="sc">+</span></span>
<span id="cb76-40"><a href="modeling-race-results.html#cb76-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb76-41"><a href="modeling-race-results.html#cb76-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb76-42"><a href="modeling-race-results.html#cb76-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb76-43"><a href="modeling-race-results.html#cb76-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb76-44"><a href="modeling-race-results.html#cb76-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb76-45"><a href="modeling-race-results.html#cb76-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;British Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb76-46"><a href="modeling-race-results.html#cb76-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb76-47"><a href="modeling-race-results.html#cb76-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-72-1.png" width="960" /></p>
</div>
<div id="hungary" class="section level3 hasAnchor" number="6.5.12">
<h3><span class="header-section-number">6.5.12</span> Hungary<a href="modeling-race-results.html#hungary" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="modeling-race-results.html#cb77-1" aria-hidden="true" tabindex="-1"></a>hungary_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb77-2"><a href="modeling-race-results.html#cb77-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb77-3"><a href="modeling-race-results.html#cb77-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="modeling-race-results.html#cb77-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;hungary&#39;</span>))</span>
<span id="cb77-5"><a href="modeling-race-results.html#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="modeling-race-results.html#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb77-7"><a href="modeling-race-results.html#cb77-7" aria-hidden="true" tabindex="-1"></a>hungary_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(hungary_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb77-8"><a href="modeling-race-results.html#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="modeling-race-results.html#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb77-10"><a href="modeling-race-results.html#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hungary_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span>
<span id="cb77-11"><a href="modeling-race-results.html#cb77-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-12"><a href="modeling-race-results.html#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb77-13"><a href="modeling-race-results.html#cb77-13" aria-hidden="true" tabindex="-1"></a>hungary_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(hungary_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb77-14"><a href="modeling-race-results.html#cb77-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-15"><a href="modeling-race-results.html#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb77-16"><a href="modeling-race-results.html#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hungary_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span>
<span id="cb77-17"><a href="modeling-race-results.html#cb77-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-18"><a href="modeling-race-results.html#cb77-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb77-19"><a href="modeling-race-results.html#cb77-19" aria-hidden="true" tabindex="-1"></a>hungary_preds_se_full <span class="ot">&lt;-</span> hungary_predictions <span class="sc">%&gt;%</span></span>
<span id="cb77-20"><a href="modeling-race-results.html#cb77-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb77-21"><a href="modeling-race-results.html#cb77-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-22"><a href="modeling-race-results.html#cb77-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(hungary_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb77-23"><a href="modeling-race-results.html#cb77-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-24"><a href="modeling-race-results.html#cb77-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb77-25"><a href="modeling-race-results.html#cb77-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb77-26"><a href="modeling-race-results.html#cb77-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb77-27"><a href="modeling-race-results.html#cb77-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb77-28"><a href="modeling-race-results.html#cb77-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb77-29"><a href="modeling-race-results.html#cb77-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb77-30"><a href="modeling-race-results.html#cb77-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb77-31"><a href="modeling-race-results.html#cb77-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-32"><a href="modeling-race-results.html#cb77-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb77-33"><a href="modeling-race-results.html#cb77-33" aria-hidden="true" tabindex="-1"></a>hungary_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb77-34"><a href="modeling-race-results.html#cb77-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb77-35"><a href="modeling-race-results.html#cb77-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb77-36"><a href="modeling-race-results.html#cb77-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb77-37"><a href="modeling-race-results.html#cb77-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb77-38"><a href="modeling-race-results.html#cb77-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb77-39"><a href="modeling-race-results.html#cb77-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;forestgreen&#39;</span>) <span class="sc">+</span></span>
<span id="cb77-40"><a href="modeling-race-results.html#cb77-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb77-41"><a href="modeling-race-results.html#cb77-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb77-42"><a href="modeling-race-results.html#cb77-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb77-43"><a href="modeling-race-results.html#cb77-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb77-44"><a href="modeling-race-results.html#cb77-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb77-45"><a href="modeling-race-results.html#cb77-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Hungarian Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb77-46"><a href="modeling-race-results.html#cb77-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb77-47"><a href="modeling-race-results.html#cb77-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-73-1.png" width="960" /></p>
</div>
<div id="belgium" class="section level3 hasAnchor" number="6.5.13">
<h3><span class="header-section-number">6.5.13</span> Belgium<a href="modeling-race-results.html#belgium" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="modeling-race-results.html#cb78-1" aria-hidden="true" tabindex="-1"></a>belgium_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb78-2"><a href="modeling-race-results.html#cb78-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb78-3"><a href="modeling-race-results.html#cb78-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb78-4"><a href="modeling-race-results.html#cb78-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;belgium&#39;</span>))</span>
<span id="cb78-5"><a href="modeling-race-results.html#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="modeling-race-results.html#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb78-7"><a href="modeling-race-results.html#cb78-7" aria-hidden="true" tabindex="-1"></a>belgium_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(belgium_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb78-8"><a href="modeling-race-results.html#cb78-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-9"><a href="modeling-race-results.html#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb78-10"><a href="modeling-race-results.html#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(belgium_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb78-11"><a href="modeling-race-results.html#cb78-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-12"><a href="modeling-race-results.html#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb78-13"><a href="modeling-race-results.html#cb78-13" aria-hidden="true" tabindex="-1"></a>belgium_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(belgium_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb78-14"><a href="modeling-race-results.html#cb78-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-15"><a href="modeling-race-results.html#cb78-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb78-16"><a href="modeling-race-results.html#cb78-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(belgium_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb78-17"><a href="modeling-race-results.html#cb78-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-18"><a href="modeling-race-results.html#cb78-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb78-19"><a href="modeling-race-results.html#cb78-19" aria-hidden="true" tabindex="-1"></a>belgium_preds_se_full <span class="ot">&lt;-</span> belgium_predictions <span class="sc">%&gt;%</span></span>
<span id="cb78-20"><a href="modeling-race-results.html#cb78-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb78-21"><a href="modeling-race-results.html#cb78-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb78-22"><a href="modeling-race-results.html#cb78-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(belgium_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb78-23"><a href="modeling-race-results.html#cb78-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-24"><a href="modeling-race-results.html#cb78-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb78-25"><a href="modeling-race-results.html#cb78-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb78-26"><a href="modeling-race-results.html#cb78-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb78-27"><a href="modeling-race-results.html#cb78-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb78-28"><a href="modeling-race-results.html#cb78-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb78-29"><a href="modeling-race-results.html#cb78-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb78-30"><a href="modeling-race-results.html#cb78-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb78-31"><a href="modeling-race-results.html#cb78-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-32"><a href="modeling-race-results.html#cb78-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb78-33"><a href="modeling-race-results.html#cb78-33" aria-hidden="true" tabindex="-1"></a>belgium_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb78-34"><a href="modeling-race-results.html#cb78-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb78-35"><a href="modeling-race-results.html#cb78-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb78-36"><a href="modeling-race-results.html#cb78-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb78-37"><a href="modeling-race-results.html#cb78-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb78-38"><a href="modeling-race-results.html#cb78-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb78-39"><a href="modeling-race-results.html#cb78-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>) <span class="sc">+</span></span>
<span id="cb78-40"><a href="modeling-race-results.html#cb78-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb78-41"><a href="modeling-race-results.html#cb78-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb78-42"><a href="modeling-race-results.html#cb78-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb78-43"><a href="modeling-race-results.html#cb78-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb78-44"><a href="modeling-race-results.html#cb78-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb78-45"><a href="modeling-race-results.html#cb78-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Belgian Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb78-46"><a href="modeling-race-results.html#cb78-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb78-47"><a href="modeling-race-results.html#cb78-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-74-1.png" width="960" /></p>
</div>
<div id="netherlands" class="section level3 hasAnchor" number="6.5.14">
<h3><span class="header-section-number">6.5.14</span> Netherlands<a href="modeling-race-results.html#netherlands" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="modeling-race-results.html#cb79-1" aria-hidden="true" tabindex="-1"></a>netherlands_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb79-2"><a href="modeling-race-results.html#cb79-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb79-3"><a href="modeling-race-results.html#cb79-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb79-4"><a href="modeling-race-results.html#cb79-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;netherlands&#39;</span>))</span>
<span id="cb79-5"><a href="modeling-race-results.html#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="modeling-race-results.html#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb79-7"><a href="modeling-race-results.html#cb79-7" aria-hidden="true" tabindex="-1"></a>netherlands_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(netherlands_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb79-8"><a href="modeling-race-results.html#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="modeling-race-results.html#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb79-10"><a href="modeling-race-results.html#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(netherlands_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>]</span>
<span id="cb79-11"><a href="modeling-race-results.html#cb79-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-12"><a href="modeling-race-results.html#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb79-13"><a href="modeling-race-results.html#cb79-13" aria-hidden="true" tabindex="-1"></a>netherlands_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(netherlands_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb79-14"><a href="modeling-race-results.html#cb79-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-15"><a href="modeling-race-results.html#cb79-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb79-16"><a href="modeling-race-results.html#cb79-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(netherlands_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>]</span>
<span id="cb79-17"><a href="modeling-race-results.html#cb79-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-18"><a href="modeling-race-results.html#cb79-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb79-19"><a href="modeling-race-results.html#cb79-19" aria-hidden="true" tabindex="-1"></a>netherlands_preds_se_full <span class="ot">&lt;-</span> netherlands_predictions <span class="sc">%&gt;%</span></span>
<span id="cb79-20"><a href="modeling-race-results.html#cb79-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb79-21"><a href="modeling-race-results.html#cb79-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb79-22"><a href="modeling-race-results.html#cb79-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(netherlands_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb79-23"><a href="modeling-race-results.html#cb79-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb79-24"><a href="modeling-race-results.html#cb79-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb79-25"><a href="modeling-race-results.html#cb79-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb79-26"><a href="modeling-race-results.html#cb79-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb79-27"><a href="modeling-race-results.html#cb79-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb79-28"><a href="modeling-race-results.html#cb79-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb79-29"><a href="modeling-race-results.html#cb79-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb79-30"><a href="modeling-race-results.html#cb79-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb79-31"><a href="modeling-race-results.html#cb79-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-32"><a href="modeling-race-results.html#cb79-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb79-33"><a href="modeling-race-results.html#cb79-33" aria-hidden="true" tabindex="-1"></a>netherlands_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb79-34"><a href="modeling-race-results.html#cb79-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb79-35"><a href="modeling-race-results.html#cb79-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb79-36"><a href="modeling-race-results.html#cb79-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb79-37"><a href="modeling-race-results.html#cb79-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb79-38"><a href="modeling-race-results.html#cb79-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb79-39"><a href="modeling-race-results.html#cb79-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;orange4&#39;</span>) <span class="sc">+</span></span>
<span id="cb79-40"><a href="modeling-race-results.html#cb79-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb79-41"><a href="modeling-race-results.html#cb79-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb79-42"><a href="modeling-race-results.html#cb79-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb79-43"><a href="modeling-race-results.html#cb79-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb79-44"><a href="modeling-race-results.html#cb79-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb79-45"><a href="modeling-race-results.html#cb79-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Dutch Grand Prix: 2021 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb79-46"><a href="modeling-race-results.html#cb79-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb79-47"><a href="modeling-race-results.html#cb79-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-75-1.png" width="960" /></p>
</div>
<div id="monza" class="section level3 hasAnchor" number="6.5.15">
<h3><span class="header-section-number">6.5.15</span> Monza<a href="modeling-race-results.html#monza" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="modeling-race-results.html#cb80-1" aria-hidden="true" tabindex="-1"></a>italy_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb80-2"><a href="modeling-race-results.html#cb80-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb80-3"><a href="modeling-race-results.html#cb80-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb80-4"><a href="modeling-race-results.html#cb80-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;italy&#39;</span>))</span>
<span id="cb80-5"><a href="modeling-race-results.html#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="modeling-race-results.html#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb80-7"><a href="modeling-race-results.html#cb80-7" aria-hidden="true" tabindex="-1"></a>italy_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(italy_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb80-8"><a href="modeling-race-results.html#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="modeling-race-results.html#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb80-10"><a href="modeling-race-results.html#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(italy_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span>
<span id="cb80-11"><a href="modeling-race-results.html#cb80-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-12"><a href="modeling-race-results.html#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb80-13"><a href="modeling-race-results.html#cb80-13" aria-hidden="true" tabindex="-1"></a>italy_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(italy_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb80-14"><a href="modeling-race-results.html#cb80-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-15"><a href="modeling-race-results.html#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb80-16"><a href="modeling-race-results.html#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(italy_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span>
<span id="cb80-17"><a href="modeling-race-results.html#cb80-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-18"><a href="modeling-race-results.html#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb80-19"><a href="modeling-race-results.html#cb80-19" aria-hidden="true" tabindex="-1"></a>italy_preds_se_full <span class="ot">&lt;-</span> italy_predictions <span class="sc">%&gt;%</span></span>
<span id="cb80-20"><a href="modeling-race-results.html#cb80-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb80-21"><a href="modeling-race-results.html#cb80-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-22"><a href="modeling-race-results.html#cb80-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(italy_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb80-23"><a href="modeling-race-results.html#cb80-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-24"><a href="modeling-race-results.html#cb80-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb80-25"><a href="modeling-race-results.html#cb80-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb80-26"><a href="modeling-race-results.html#cb80-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb80-27"><a href="modeling-race-results.html#cb80-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb80-28"><a href="modeling-race-results.html#cb80-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb80-29"><a href="modeling-race-results.html#cb80-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb80-30"><a href="modeling-race-results.html#cb80-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb80-31"><a href="modeling-race-results.html#cb80-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-32"><a href="modeling-race-results.html#cb80-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb80-33"><a href="modeling-race-results.html#cb80-33" aria-hidden="true" tabindex="-1"></a>italy_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb80-34"><a href="modeling-race-results.html#cb80-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb80-35"><a href="modeling-race-results.html#cb80-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb80-36"><a href="modeling-race-results.html#cb80-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb80-37"><a href="modeling-race-results.html#cb80-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb80-38"><a href="modeling-race-results.html#cb80-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb80-39"><a href="modeling-race-results.html#cb80-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;green4&#39;</span>) <span class="sc">+</span></span>
<span id="cb80-40"><a href="modeling-race-results.html#cb80-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb80-41"><a href="modeling-race-results.html#cb80-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb80-42"><a href="modeling-race-results.html#cb80-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb80-43"><a href="modeling-race-results.html#cb80-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb80-44"><a href="modeling-race-results.html#cb80-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb80-45"><a href="modeling-race-results.html#cb80-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Italian Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb80-46"><a href="modeling-race-results.html#cb80-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb80-47"><a href="modeling-race-results.html#cb80-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-76-1.png" width="960" /></p>
</div>
<div id="singapore" class="section level3 hasAnchor" number="6.5.16">
<h3><span class="header-section-number">6.5.16</span> Singapore<a href="modeling-race-results.html#singapore" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="modeling-race-results.html#cb81-1" aria-hidden="true" tabindex="-1"></a>singapore_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb81-2"><a href="modeling-race-results.html#cb81-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb81-3"><a href="modeling-race-results.html#cb81-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb81-4"><a href="modeling-race-results.html#cb81-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;singapore&#39;</span>))</span>
<span id="cb81-5"><a href="modeling-race-results.html#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="modeling-race-results.html#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb81-7"><a href="modeling-race-results.html#cb81-7" aria-hidden="true" tabindex="-1"></a>singapore_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(singapore_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb81-8"><a href="modeling-race-results.html#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="modeling-race-results.html#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb81-10"><a href="modeling-race-results.html#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(singapore_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span>
<span id="cb81-11"><a href="modeling-race-results.html#cb81-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-12"><a href="modeling-race-results.html#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb81-13"><a href="modeling-race-results.html#cb81-13" aria-hidden="true" tabindex="-1"></a>singapore_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(singapore_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb81-14"><a href="modeling-race-results.html#cb81-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-15"><a href="modeling-race-results.html#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb81-16"><a href="modeling-race-results.html#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(singapore_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>]</span>
<span id="cb81-17"><a href="modeling-race-results.html#cb81-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-18"><a href="modeling-race-results.html#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb81-19"><a href="modeling-race-results.html#cb81-19" aria-hidden="true" tabindex="-1"></a>singapore_preds_se_full <span class="ot">&lt;-</span> singapore_predictions <span class="sc">%&gt;%</span></span>
<span id="cb81-20"><a href="modeling-race-results.html#cb81-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb81-21"><a href="modeling-race-results.html#cb81-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-22"><a href="modeling-race-results.html#cb81-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(singapore_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb81-23"><a href="modeling-race-results.html#cb81-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-24"><a href="modeling-race-results.html#cb81-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb81-25"><a href="modeling-race-results.html#cb81-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb81-26"><a href="modeling-race-results.html#cb81-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb81-27"><a href="modeling-race-results.html#cb81-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb81-28"><a href="modeling-race-results.html#cb81-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb81-29"><a href="modeling-race-results.html#cb81-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb81-30"><a href="modeling-race-results.html#cb81-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb81-31"><a href="modeling-race-results.html#cb81-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-32"><a href="modeling-race-results.html#cb81-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb81-33"><a href="modeling-race-results.html#cb81-33" aria-hidden="true" tabindex="-1"></a>singapore_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb81-34"><a href="modeling-race-results.html#cb81-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb81-35"><a href="modeling-race-results.html#cb81-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb81-36"><a href="modeling-race-results.html#cb81-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb81-37"><a href="modeling-race-results.html#cb81-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb81-38"><a href="modeling-race-results.html#cb81-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb81-39"><a href="modeling-race-results.html#cb81-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>) <span class="sc">+</span></span>
<span id="cb81-40"><a href="modeling-race-results.html#cb81-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb81-41"><a href="modeling-race-results.html#cb81-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb81-42"><a href="modeling-race-results.html#cb81-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb81-43"><a href="modeling-race-results.html#cb81-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb81-44"><a href="modeling-race-results.html#cb81-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb81-45"><a href="modeling-race-results.html#cb81-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Singapore Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb81-46"><a href="modeling-race-results.html#cb81-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb81-47"><a href="modeling-race-results.html#cb81-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-77-1.png" width="960" /></p>
</div>
<div id="japan" class="section level3 hasAnchor" number="6.5.17">
<h3><span class="header-section-number">6.5.17</span> Japan<a href="modeling-race-results.html#japan" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="modeling-race-results.html#cb82-1" aria-hidden="true" tabindex="-1"></a>japan_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb82-2"><a href="modeling-race-results.html#cb82-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb82-3"><a href="modeling-race-results.html#cb82-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="modeling-race-results.html#cb82-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;japan&#39;</span>))</span>
<span id="cb82-5"><a href="modeling-race-results.html#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="modeling-race-results.html#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb82-7"><a href="modeling-race-results.html#cb82-7" aria-hidden="true" tabindex="-1"></a>japan_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(japan_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb82-8"><a href="modeling-race-results.html#cb82-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-9"><a href="modeling-race-results.html#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb82-10"><a href="modeling-race-results.html#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(japan_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>]</span>
<span id="cb82-11"><a href="modeling-race-results.html#cb82-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-12"><a href="modeling-race-results.html#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb82-13"><a href="modeling-race-results.html#cb82-13" aria-hidden="true" tabindex="-1"></a>japan_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(japan_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb82-14"><a href="modeling-race-results.html#cb82-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-15"><a href="modeling-race-results.html#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb82-16"><a href="modeling-race-results.html#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(japan_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>]</span>
<span id="cb82-17"><a href="modeling-race-results.html#cb82-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-18"><a href="modeling-race-results.html#cb82-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb82-19"><a href="modeling-race-results.html#cb82-19" aria-hidden="true" tabindex="-1"></a>japan_preds_se_full <span class="ot">&lt;-</span> japan_predictions <span class="sc">%&gt;%</span></span>
<span id="cb82-20"><a href="modeling-race-results.html#cb82-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb82-21"><a href="modeling-race-results.html#cb82-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-22"><a href="modeling-race-results.html#cb82-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(japan_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb82-23"><a href="modeling-race-results.html#cb82-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-24"><a href="modeling-race-results.html#cb82-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb82-25"><a href="modeling-race-results.html#cb82-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb82-26"><a href="modeling-race-results.html#cb82-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb82-27"><a href="modeling-race-results.html#cb82-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb82-28"><a href="modeling-race-results.html#cb82-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb82-29"><a href="modeling-race-results.html#cb82-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb82-30"><a href="modeling-race-results.html#cb82-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb82-31"><a href="modeling-race-results.html#cb82-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-32"><a href="modeling-race-results.html#cb82-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb82-33"><a href="modeling-race-results.html#cb82-33" aria-hidden="true" tabindex="-1"></a>japan_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb82-34"><a href="modeling-race-results.html#cb82-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb82-35"><a href="modeling-race-results.html#cb82-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb82-36"><a href="modeling-race-results.html#cb82-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb82-37"><a href="modeling-race-results.html#cb82-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb82-38"><a href="modeling-race-results.html#cb82-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb82-39"><a href="modeling-race-results.html#cb82-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;darkred&#39;</span>) <span class="sc">+</span></span>
<span id="cb82-40"><a href="modeling-race-results.html#cb82-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb82-41"><a href="modeling-race-results.html#cb82-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb82-42"><a href="modeling-race-results.html#cb82-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb82-43"><a href="modeling-race-results.html#cb82-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb82-44"><a href="modeling-race-results.html#cb82-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb82-45"><a href="modeling-race-results.html#cb82-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Japanese Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb82-46"><a href="modeling-race-results.html#cb82-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb82-47"><a href="modeling-race-results.html#cb82-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-78-1.png" width="960" /></p>
</div>
<div id="qatar" class="section level3 hasAnchor" number="6.5.18">
<h3><span class="header-section-number">6.5.18</span> Qatar<a href="modeling-race-results.html#qatar" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="modeling-race-results.html#cb83-1" aria-hidden="true" tabindex="-1"></a>qatar_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb83-2"><a href="modeling-race-results.html#cb83-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb83-3"><a href="modeling-race-results.html#cb83-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb83-4"><a href="modeling-race-results.html#cb83-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;qatar&#39;</span>))</span>
<span id="cb83-5"><a href="modeling-race-results.html#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="modeling-race-results.html#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb83-7"><a href="modeling-race-results.html#cb83-7" aria-hidden="true" tabindex="-1"></a>qatar_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(qatar_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb83-8"><a href="modeling-race-results.html#cb83-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-9"><a href="modeling-race-results.html#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb83-10"><a href="modeling-race-results.html#cb83-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(qatar_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>]</span>
<span id="cb83-11"><a href="modeling-race-results.html#cb83-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-12"><a href="modeling-race-results.html#cb83-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb83-13"><a href="modeling-race-results.html#cb83-13" aria-hidden="true" tabindex="-1"></a>qatar_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(qatar_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb83-14"><a href="modeling-race-results.html#cb83-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-15"><a href="modeling-race-results.html#cb83-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb83-16"><a href="modeling-race-results.html#cb83-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(qatar_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>]</span>
<span id="cb83-17"><a href="modeling-race-results.html#cb83-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-18"><a href="modeling-race-results.html#cb83-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb83-19"><a href="modeling-race-results.html#cb83-19" aria-hidden="true" tabindex="-1"></a>qatar_preds_se_full <span class="ot">&lt;-</span> qatar_predictions <span class="sc">%&gt;%</span></span>
<span id="cb83-20"><a href="modeling-race-results.html#cb83-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb83-21"><a href="modeling-race-results.html#cb83-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb83-22"><a href="modeling-race-results.html#cb83-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(qatar_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb83-23"><a href="modeling-race-results.html#cb83-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-24"><a href="modeling-race-results.html#cb83-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb83-25"><a href="modeling-race-results.html#cb83-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb83-26"><a href="modeling-race-results.html#cb83-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb83-27"><a href="modeling-race-results.html#cb83-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb83-28"><a href="modeling-race-results.html#cb83-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb83-29"><a href="modeling-race-results.html#cb83-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb83-30"><a href="modeling-race-results.html#cb83-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb83-31"><a href="modeling-race-results.html#cb83-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-32"><a href="modeling-race-results.html#cb83-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb83-33"><a href="modeling-race-results.html#cb83-33" aria-hidden="true" tabindex="-1"></a>qatar_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb83-34"><a href="modeling-race-results.html#cb83-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb83-35"><a href="modeling-race-results.html#cb83-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb83-36"><a href="modeling-race-results.html#cb83-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb83-37"><a href="modeling-race-results.html#cb83-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb83-38"><a href="modeling-race-results.html#cb83-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb83-39"><a href="modeling-race-results.html#cb83-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;maroon&#39;</span>) <span class="sc">+</span></span>
<span id="cb83-40"><a href="modeling-race-results.html#cb83-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb83-41"><a href="modeling-race-results.html#cb83-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb83-42"><a href="modeling-race-results.html#cb83-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb83-43"><a href="modeling-race-results.html#cb83-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb83-44"><a href="modeling-race-results.html#cb83-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb83-45"><a href="modeling-race-results.html#cb83-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Qatar Grand Prix: 2021 &amp; 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb83-46"><a href="modeling-race-results.html#cb83-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb83-47"><a href="modeling-race-results.html#cb83-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-79-1.png" width="960" /></p>
</div>
<div id="united-states-circuit-of-the-americas-in-austin-texas" class="section level3 hasAnchor" number="6.5.19">
<h3><span class="header-section-number">6.5.19</span> United States (Circuit of the Americas in Austin, Texas)<a href="modeling-race-results.html#united-states-circuit-of-the-americas-in-austin-texas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="modeling-race-results.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggstar)</span>
<span id="cb84-2"><a href="modeling-race-results.html#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="modeling-race-results.html#cb84-3" aria-hidden="true" tabindex="-1"></a>united_states_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb84-4"><a href="modeling-race-results.html#cb84-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb84-5"><a href="modeling-race-results.html#cb84-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb84-6"><a href="modeling-race-results.html#cb84-6" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;united-states&#39;</span>))</span>
<span id="cb84-7"><a href="modeling-race-results.html#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="modeling-race-results.html#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb84-9"><a href="modeling-race-results.html#cb84-9" aria-hidden="true" tabindex="-1"></a>united_states_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(united_states_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb84-10"><a href="modeling-race-results.html#cb84-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-11"><a href="modeling-race-results.html#cb84-11" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb84-12"><a href="modeling-race-results.html#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(united_states_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>]</span>
<span id="cb84-13"><a href="modeling-race-results.html#cb84-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-14"><a href="modeling-race-results.html#cb84-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb84-15"><a href="modeling-race-results.html#cb84-15" aria-hidden="true" tabindex="-1"></a>united_states_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(united_states_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb84-16"><a href="modeling-race-results.html#cb84-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-17"><a href="modeling-race-results.html#cb84-17" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb84-18"><a href="modeling-race-results.html#cb84-18" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(united_states_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>]</span>
<span id="cb84-19"><a href="modeling-race-results.html#cb84-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-20"><a href="modeling-race-results.html#cb84-20" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb84-21"><a href="modeling-race-results.html#cb84-21" aria-hidden="true" tabindex="-1"></a>united_states_preds_se_full <span class="ot">&lt;-</span> united_states_predictions <span class="sc">%&gt;%</span></span>
<span id="cb84-22"><a href="modeling-race-results.html#cb84-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb84-23"><a href="modeling-race-results.html#cb84-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-24"><a href="modeling-race-results.html#cb84-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(united_states_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb84-25"><a href="modeling-race-results.html#cb84-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb84-26"><a href="modeling-race-results.html#cb84-26" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb84-27"><a href="modeling-race-results.html#cb84-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb84-28"><a href="modeling-race-results.html#cb84-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb84-29"><a href="modeling-race-results.html#cb84-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb84-30"><a href="modeling-race-results.html#cb84-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb84-31"><a href="modeling-race-results.html#cb84-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb84-32"><a href="modeling-race-results.html#cb84-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb84-33"><a href="modeling-race-results.html#cb84-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-34"><a href="modeling-race-results.html#cb84-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb84-35"><a href="modeling-race-results.html#cb84-35" aria-hidden="true" tabindex="-1"></a>united_states_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb84-36"><a href="modeling-race-results.html#cb84-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb84-37"><a href="modeling-race-results.html#cb84-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb84-38"><a href="modeling-race-results.html#cb84-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb84-39"><a href="modeling-race-results.html#cb84-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb84-40"><a href="modeling-race-results.html#cb84-40" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>) <span class="sc">+</span></span>
<span id="cb84-41"><a href="modeling-race-results.html#cb84-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_star</span>(<span class="at">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">&#39;white&#39;</span>) <span class="sc">+</span></span>
<span id="cb84-42"><a href="modeling-race-results.html#cb84-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb84-43"><a href="modeling-race-results.html#cb84-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb84-44"><a href="modeling-race-results.html#cb84-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb84-45"><a href="modeling-race-results.html#cb84-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb84-46"><a href="modeling-race-results.html#cb84-46" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb84-47"><a href="modeling-race-results.html#cb84-47" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;United States Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb84-48"><a href="modeling-race-results.html#cb84-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb84-49"><a href="modeling-race-results.html#cb84-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-80-1.png" width="960" /></p>
<p><br>
<br></p>
<div class="blackbox">
<div class="center">
<p><strong>Plotting stars in ggplot</strong></p>
</div>
<p>The <strong>ggstar</strong> package provides different geometries for ggplot2 to create more easily discernible shapes. For instance, you can use this package to plot specific triangles (i.e. right triangles), hearts, or ellipses.</p>
<p>As an admittedly obnoxious American, I used the <code>geom_star()</code> function to plot stars for my data points.</p>
<p>For more information on the <strong>ggstar</strong> package, visit this link:</p>
<p><a href="https://cran.r-project.org/web/packages/ggstar/vignettes/ggstar.html" class="uri">https://cran.r-project.org/web/packages/ggstar/vignettes/ggstar.html</a></p>
</div>
<p><br>
<br></p>
</div>
<div id="mexico" class="section level3 hasAnchor" number="6.5.20">
<h3><span class="header-section-number">6.5.20</span> Mexico<a href="modeling-race-results.html#mexico" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="modeling-race-results.html#cb85-1" aria-hidden="true" tabindex="-1"></a>mexico_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb85-2"><a href="modeling-race-results.html#cb85-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb85-3"><a href="modeling-race-results.html#cb85-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb85-4"><a href="modeling-race-results.html#cb85-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;mexico&#39;</span>))</span>
<span id="cb85-5"><a href="modeling-race-results.html#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="modeling-race-results.html#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb85-7"><a href="modeling-race-results.html#cb85-7" aria-hidden="true" tabindex="-1"></a>mexico_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(mexico_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb85-8"><a href="modeling-race-results.html#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="modeling-race-results.html#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb85-10"><a href="modeling-race-results.html#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mexico_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb85-11"><a href="modeling-race-results.html#cb85-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-12"><a href="modeling-race-results.html#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb85-13"><a href="modeling-race-results.html#cb85-13" aria-hidden="true" tabindex="-1"></a>mexico_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(mexico_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb85-14"><a href="modeling-race-results.html#cb85-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-15"><a href="modeling-race-results.html#cb85-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb85-16"><a href="modeling-race-results.html#cb85-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mexico_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb85-17"><a href="modeling-race-results.html#cb85-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-18"><a href="modeling-race-results.html#cb85-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb85-19"><a href="modeling-race-results.html#cb85-19" aria-hidden="true" tabindex="-1"></a>mexico_preds_se_full <span class="ot">&lt;-</span> mexico_predictions <span class="sc">%&gt;%</span></span>
<span id="cb85-20"><a href="modeling-race-results.html#cb85-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb85-21"><a href="modeling-race-results.html#cb85-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb85-22"><a href="modeling-race-results.html#cb85-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(mexico_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb85-23"><a href="modeling-race-results.html#cb85-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-24"><a href="modeling-race-results.html#cb85-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb85-25"><a href="modeling-race-results.html#cb85-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb85-26"><a href="modeling-race-results.html#cb85-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb85-27"><a href="modeling-race-results.html#cb85-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb85-28"><a href="modeling-race-results.html#cb85-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb85-29"><a href="modeling-race-results.html#cb85-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb85-30"><a href="modeling-race-results.html#cb85-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb85-31"><a href="modeling-race-results.html#cb85-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-32"><a href="modeling-race-results.html#cb85-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb85-33"><a href="modeling-race-results.html#cb85-33" aria-hidden="true" tabindex="-1"></a>mexico_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb85-34"><a href="modeling-race-results.html#cb85-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb85-35"><a href="modeling-race-results.html#cb85-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb85-36"><a href="modeling-race-results.html#cb85-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb85-37"><a href="modeling-race-results.html#cb85-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb85-38"><a href="modeling-race-results.html#cb85-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb85-39"><a href="modeling-race-results.html#cb85-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;darkgreen&#39;</span>) <span class="sc">+</span></span>
<span id="cb85-40"><a href="modeling-race-results.html#cb85-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb85-41"><a href="modeling-race-results.html#cb85-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb85-42"><a href="modeling-race-results.html#cb85-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb85-43"><a href="modeling-race-results.html#cb85-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb85-44"><a href="modeling-race-results.html#cb85-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb85-45"><a href="modeling-race-results.html#cb85-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Mexican Grand Prix: 2015 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb85-46"><a href="modeling-race-results.html#cb85-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb85-47"><a href="modeling-race-results.html#cb85-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-81-1.png" width="960" /></p>
</div>
<div id="brazil-1" class="section level3 hasAnchor" number="6.5.21">
<h3><span class="header-section-number">6.5.21</span> Brazil<a href="modeling-race-results.html#brazil-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="modeling-race-results.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># These predictions were generated earlier in the chapter</span></span>
<span id="cb86-2"><a href="modeling-race-results.html#cb86-2" aria-hidden="true" tabindex="-1"></a>brazil_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb86-3"><a href="modeling-race-results.html#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb86-4"><a href="modeling-race-results.html#cb86-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb86-5"><a href="modeling-race-results.html#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb86-6"><a href="modeling-race-results.html#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb86-7"><a href="modeling-race-results.html#cb86-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&#39;green&#39;</span>) <span class="sc">+</span></span>
<span id="cb86-8"><a href="modeling-race-results.html#cb86-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb86-9"><a href="modeling-race-results.html#cb86-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb86-10"><a href="modeling-race-results.html#cb86-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb86-11"><a href="modeling-race-results.html#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb86-12"><a href="modeling-race-results.html#cb86-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb86-13"><a href="modeling-race-results.html#cb86-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb86-14"><a href="modeling-race-results.html#cb86-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Sao Paulo Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb86-15"><a href="modeling-race-results.html#cb86-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb86-16"><a href="modeling-race-results.html#cb86-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-82-1.png" width="960" /></p>
</div>
<div id="abu-dhabi" class="section level3 hasAnchor" number="6.5.22">
<h3><span class="header-section-number">6.5.22</span> Abu Dhabi<a href="modeling-race-results.html#abu-dhabi" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="modeling-race-results.html#cb87-1" aria-hidden="true" tabindex="-1"></a>abudhabi_model <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Position_race <span class="sc">~</span> Position_grid, </span>
<span id="cb87-2"><a href="modeling-race-results.html#cb87-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> T, <span class="at">reverse =</span> F),</span>
<span id="cb87-3"><a href="modeling-race-results.html#cb87-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> grids_and_races <span class="sc">%&gt;%</span></span>
<span id="cb87-4"><a href="modeling-race-results.html#cb87-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">filter</span>(Race <span class="sc">==</span> <span class="st">&#39;abu-dhabi&#39;</span>))</span>
<span id="cb87-5"><a href="modeling-race-results.html#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="modeling-race-results.html#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Make Predictions for each Finishing position (1:20), using each Starting Position (1:20)</span></span>
<span id="cb87-7"><a href="modeling-race-results.html#cb87-7" aria-hidden="true" tabindex="-1"></a>abudhabi_predictions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(abudhabi_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>fitted.values)</span>
<span id="cb87-8"><a href="modeling-race-results.html#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="modeling-race-results.html#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the columns</span></span>
<span id="cb87-10"><a href="modeling-race-results.html#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(abudhabi_predictions) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>prob[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb87-11"><a href="modeling-race-results.html#cb87-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-12"><a href="modeling-race-results.html#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the standard error for each prediction</span></span>
<span id="cb87-13"><a href="modeling-race-results.html#cb87-13" aria-hidden="true" tabindex="-1"></a>abudhabi_standard_errors <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predictvglm</span>(abudhabi_model, <span class="at">newdata =</span> starting_grid, <span class="at">se.fit =</span> T)<span class="sc">$</span>se.fit)</span>
<span id="cb87-14"><a href="modeling-race-results.html#cb87-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-15"><a href="modeling-race-results.html#cb87-15" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the standard error </span></span>
<span id="cb87-16"><a href="modeling-race-results.html#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(abudhabi_standard_errors) <span class="ot">&lt;-</span> placing_df<span class="sc">$</span>se[<span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>]</span>
<span id="cb87-17"><a href="modeling-race-results.html#cb87-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-18"><a href="modeling-race-results.html#cb87-18" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy up probabilities</span></span>
<span id="cb87-19"><a href="modeling-race-results.html#cb87-19" aria-hidden="true" tabindex="-1"></a>abudhabi_preds_se_full <span class="ot">&lt;-</span> abudhabi_predictions <span class="sc">%&gt;%</span></span>
<span id="cb87-20"><a href="modeling-race-results.html#cb87-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb87-21"><a href="modeling-race-results.html#cb87-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;prob&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb87-22"><a href="modeling-race-results.html#cb87-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(abudhabi_standard_errors <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">starting =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb87-23"><a href="modeling-race-results.html#cb87-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> starting, <span class="at">names_to =</span> <span class="st">&#39;placing&#39;</span>, <span class="at">values_to =</span> <span class="st">&#39;se&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-24"><a href="modeling-race-results.html#cb87-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(se)) <span class="sc">%&gt;%</span></span>
<span id="cb87-25"><a href="modeling-race-results.html#cb87-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">placing =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(placing, <span class="st">&#39;prob_&#39;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb87-26"><a href="modeling-race-results.html#cb87-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb87-27"><a href="modeling-race-results.html#cb87-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> prob <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> prob)) <span class="sc">%&gt;%</span></span>
<span id="cb87-28"><a href="modeling-race-results.html#cb87-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(starting) <span class="sc">%&gt;%</span> </span>
<span id="cb87-29"><a href="modeling-race-results.html#cb87-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">discrete_prob =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prob <span class="sc">-</span> <span class="fu">lag</span>(prob)), prob, (prob <span class="sc">-</span> <span class="fu">lag</span>(prob)))) <span class="sc">%&gt;%</span></span>
<span id="cb87-30"><a href="modeling-race-results.html#cb87-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb87-31"><a href="modeling-race-results.html#cb87-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-32"><a href="modeling-race-results.html#cb87-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb87-33"><a href="modeling-race-results.html#cb87-33" aria-hidden="true" tabindex="-1"></a>abudhabi_preds_se_full <span class="sc">%&gt;%</span></span>
<span id="cb87-34"><a href="modeling-race-results.html#cb87-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">starting_pos =</span> <span class="fu">as.factor</span>(<span class="fu">paste0</span>(<span class="st">&#39;P&#39;</span>,starting)),</span>
<span id="cb87-35"><a href="modeling-race-results.html#cb87-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">starting_pos =</span> <span class="fu">fct_reorder</span>(starting_pos, starting)) <span class="sc">%&gt;%</span></span>
<span id="cb87-36"><a href="modeling-race-results.html#cb87-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(placing, discrete_prob)) <span class="sc">+</span></span>
<span id="cb87-37"><a href="modeling-race-results.html#cb87-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb87-38"><a href="modeling-race-results.html#cb87-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> placing, <span class="at">xend =</span> placing, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> discrete_prob),</span>
<span id="cb87-39"><a href="modeling-race-results.html#cb87-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">col =</span> <span class="st">&#39;black&#39;</span>) <span class="sc">+</span></span>
<span id="cb87-40"><a href="modeling-race-results.html#cb87-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb87-41"><a href="modeling-race-results.html#cb87-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> starting, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb87-42"><a href="modeling-race-results.html#cb87-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Final Race Classification&#39;</span>,</span>
<span id="cb87-43"><a href="modeling-race-results.html#cb87-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Probability&#39;</span>,</span>
<span id="cb87-44"><a href="modeling-race-results.html#cb87-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="fu">expression</span>(Discrete<span class="sc">~</span>Probability<span class="sc">~</span>of<span class="sc">~</span>finishing<span class="sc">~</span>P[n]),</span>
<span id="cb87-45"><a href="modeling-race-results.html#cb87-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&#39;Abu Dhabi Grand Prix: 2014 - 2023&#39;</span>) <span class="sc">+</span></span>
<span id="cb87-46"><a href="modeling-race-results.html#cb87-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb87-47"><a href="modeling-race-results.html#cb87-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-83-1.png" width="960" /></p>
</div>
</div>
<div id="next-chapter-4" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> Next Chapter<a href="modeling-race-results.html#next-chapter-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In these models I excluded DNFs (cars that did not finish) from the dataset. In the next chapter, I will instead <em>focus</em> on DNFs. Specifically, I will use logistic regression models to better understand factors that may influence the rate of DNFs.</p>
<div style="page-break-after: always;"></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="drivers.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dnf-did-not-finish.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/05-races.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
